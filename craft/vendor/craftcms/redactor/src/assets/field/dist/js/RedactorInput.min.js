!function(t){Craft.RedactorInput=Garnish.Base.extend({id:null,linkOptions:null,volumes:null,elementSiteId:null,redactorConfig:null,$textarea:null,redactor:null,linkOptionModals:null,init:function(e){if(this.id=e.id,this.linkOptions=e.linkOptions,this.volumes=e.volumes,this.transforms=e.transforms,this.elementSiteId=e.elementSiteId,this.redactorConfig=e.redactorConfig,this.linkOptionModals=[],this.redactorConfig.lang||(this.redactorConfig.lang=e.redactorLang),this.redactorConfig.direction||(this.redactorConfig.direction=e.direction||Craft.orientation),this.redactorConfig.imageUpload=!0,this.redactorConfig.fileUpload=!0,this.redactorConfig.dragImageUpload=!1,this.redactorConfig.dragFileUpload=!1,this.redactorConfig.toolbarFixedTopOffset=72,typeof this.redactorConfig.plugins!=typeof[]&&(this.redactorConfig.plugins=[]),this.redactorConfig.buttons){var o;-1!==(o=t.inArray("html",this.redactorConfig.buttons))&&(this.redactorConfig.buttons.splice(o,1),this.redactorConfig.plugins.unshift("source")),-1!==(o=t.inArray("formatting",this.redactorConfig.buttons))&&this.redactorConfig.buttons.splice(o,1,"format");for(var i,r=["unorderedlist","orderedlist","undent","indent"],n=0;n<r.length;n++)-1!==(o=t.inArray(r[n],this.redactorConfig.buttons))&&(this.redactorConfig.buttons.splice(o,1),(void 0===i||o<i)&&(i=o));void 0!==i&&this.redactorConfig.buttons.splice(i,0,"lists")}this.redactorConfig.callbacks={init:Craft.RedactorInput.handleRedactorInit},this.$textarea=t("#"+this.id),this.initRedactor(),void 0!==Craft.livePreview&&(Craft.livePreview.on("beforeEnter beforeExit",t.proxy(function(){this.redactor.core.destroy()},this)),Craft.livePreview.on("enter slideOut",t.proxy(function(){this.initRedactor()},this)))},mergeCallbacks:function(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}},initRedactor:function(){Craft.RedactorInput.currentInstance=this,this.$textarea.redactor(this.redactorConfig),delete Craft.RedactorInput.currentInstance},onInitRedactor:function(e){this.redactor=e,this.redactor.$box.addClass("focusable-input"),this.redactor.opts.toolbar&&this.customizeToolbar(),this.leaveFullscreetOnSaveShortcut(),this.redactor.core.editor().on("focus",t.proxy(this,"onEditorFocus")).on("blur",t.proxy(this,"onEditorBlur")),this.redactor.opts.toolbarFixed&&!Craft.RedactorInput.scrollPageOnReady&&(Garnish.$doc.ready(function(){Garnish.$doc.trigger("scroll")}),Craft.RedactorInput.scrollPageOnReady=!0)},customizeToolbar:function(){if(this.volumes.length){var e=this.replaceRedactorButton("image",this.redactor.lang.get("image")),o=this.replaceRedactorButton("file",this.redactor.lang.get("file"));e&&this.redactor.button.addCallback(e,t.proxy(this,"onImageButtonClick")),o&&this.redactor.button.addCallback(o,t.proxy(this,"onFileButtonClick"))}else this.redactor.button.remove("image"),this.redactor.button.remove("file");if(this.linkOptions.length){var i=this.replaceRedactorButton("link",this.redactor.lang.get("link"));if(i){for(var r={},n=0;n<this.linkOptions.length;n++)r["link_option"+n]={title:this.linkOptions[n].optionTitle,func:t.proxy(this,"onLinkOptionClick",n)};t.extend(r,{link:{title:this.redactor.lang.get("link-insert"),func:"link.show",observe:{element:"a",in:{title:this.redactor.lang.get("link-edit")},out:{title:this.redactor.lang.get("link-insert")}}},unlink:{title:this.redactor.lang.get("unlink"),func:"link.unlink",observe:{element:"a",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}}}),this.redactor.button.addDropdown(i,r)}}},onImageButtonClick:function(){this.redactor.selection.save(),void 0===this.assetSelectionModal?this.assetSelectionModal=Craft.createElementSelectorModal("craft\\elements\\Asset",{storageKey:"RedactorInput.ChooseImage",multiSelect:!0,sources:this.volumes,criteria:{siteId:this.elementSiteId,kind:"image"},onSelect:t.proxy(function(e,o){if(e.length){this.redactor.selection.restore();for(var i=0;i<e.length;i++){var r=e[i],n=r.url+"#asset:"+r.id;o&&(n+=":transform:"+o),this.redactor.insert.node(t('<figure><img src="'+n+'" /></figure>')[0]),this.redactor.code.sync()}this.redactor.observe.images()}},this),closeOtherModals:!1,transforms:this.transforms}):this.assetSelectionModal.show()},onFileButtonClick:function(){this.redactor.selection.save(),void 0===this.assetLinkSelectionModal?this.assetLinkSelectionModal=Craft.createElementSelectorModal("craft\\elements\\Asset",{storageKey:"RedactorInput.LinkToAsset",sources:this.volumes,criteria:{siteId:this.elementSiteId},onSelect:t.proxy(function(e){if(e.length){this.redactor.selection.restore();var o=e[0],i=o.url+"#asset:"+o.id,r=this.redactor.selection.text(),n=r.length>0?r:o.label;this.redactor.insert.node(t('<a href="'+i+'">'+n+"</a>")[0]),this.redactor.code.sync()}},this),closeOtherModals:!1,transforms:this.transforms}):this.assetLinkSelectionModal.show()},onLinkOptionClick:function(e){if(this.redactor.selection.save(),void 0===this.linkOptionModals[e]){var o=this.linkOptions[e];this.linkOptionModals[e]=Craft.createElementSelectorModal(o.elementType,{storageKey:o.storageKey||"RedactorInput.LinkTo."+o.elementType,sources:o.sources,criteria:t.extend({siteId:this.elementSiteId},o.criteria),onSelect:t.proxy(function(e){if(e.length){this.redactor.selection.restore();var i=e[0],r=i.url+"#"+o.refHandle+":"+i.id,n=this.redactor.selection.text(),s=n.length>0?n:i.label;this.redactor.insert.node(t('<a href="'+r+'">'+s+"</a>")[0]),this.redactor.code.sync()}},this),closeOtherModals:!1})}else this.linkOptionModals[e].show()},onEditorFocus:function(){this.redactor.core.box().addClass("focus"),this.redactor.core.box().trigger("focus")},onEditorBlur:function(){this.redactor.core.box().removeClass("focus"),this.redactor.core.box().trigger("blur")},leaveFullscreetOnSaveShortcut:function(){void 0!==this.redactor.fullscreen&&"function"==typeof this.redactor.fullscreen.disable&&Craft.cp.on("beforeSaveShortcut",t.proxy(function(){this.redactor.fullscreen.isOpen&&this.redactor.fullscreen.disable()},this))},replaceRedactorButton:function(e,o){if(this.redactor.button.get(e).length){var i=this.redactor.button.addAfter(e,e+"_placeholder");this.redactor.button.remove(e);var r=this.redactor.button.build(e,{title:o,icon:!0});return i.parent().after(t("<li>").append(r)),i.remove(),r}}},{handleRedactorInit:function(){Craft.RedactorInput.currentInstance.onInitRedactor(this)}})}(jQuery);
//# sourceMappingURL=RedactorInput.min.js.map
