{"version":3,"sources":["redactor.js"],"names":["$","Redactor","el","options","prototype","init","Function","bind","scope","fn","this","apply","uuid","redactor","val","args","Array","slice","call","arguments","each","func","instance","data","search","split","isFunction","methodVal","undefined","push","error","length","VERSION","modules","settings","opts","animation","lang","direction","spellcheck","overrideStyles","scrollTarget","document","focus","focusEnd","clickToEdit","structure","tabindex","minHeight","maxHeight","maxWidth","plugins","callbacks","placeholder","linkify","enterKey","pastePlainText","pasteImages","pasteLinks","pasteBlockTags","pasteInlineTags","preClass","preSpaces","tabAsSpaces","tabKey","autosave","autosaveName","autosaveFields","imageUpload","imageUploadParam","imageUploadFields","imageUploadForms","imageTag","imageEditable","imageCaption","imagePosition","imageResizable","imageFloatMargin","dragImageUpload","multipleImageUpload","clipboardImageUpload","fileUpload","fileUploadParam","fileUploadFields","fileUploadForms","dragFileUpload","s3","linkNewTab","linkTooltip","linkNofollow","linkSize","pasteLinkTarget","videoContainerClass","toolbar","toolbarFixed","toolbarFixedTarget","toolbarFixedTopOffset","toolbarExternal","toolbarOverflow","air","airWidth","formatting","formattingAdd","buttons","buttonsTextLabeled","buttonsHide","buttonsHideOnMobile","script","removeNewlines","removeComments","replaceTags","b","i","strike","keepStyleAttr","shortcuts","ctrl+shift+m, meta+shift+m","ctrl+b, meta+b","params","ctrl+i, meta+i","ctrl+h, meta+h","ctrl+l, meta+l","ctrl+k, meta+k","ctrl+shift+7","ctrl+shift+8","shortcutsAdd","activeButtons","activeButtonsStates","strong","em","del","langs","en","format","image","file","link","bold","italic","deleted","underline","bold-abbr","italic-abbr","deleted-abbr","underline-abbr","lists","link-insert","link-edit","link-in-new-tab","unlink","cancel","close","insert","save","delete","text","edit","title","paragraph","quote","code","heading1","heading2","heading3","heading4","heading5","heading6","filename","optional","unorderedlist","orderedlist","outdent","indent","horizontalrule","upload-label","caption","bulletslist","numberslist","image-position","none","left","right","center","accessibility-help-label","type","inline","buffer","rebuffer","inlineTags","blockTags","paragraphize","paragraphizeBlocks","emptyHtml","invisibleSpace","emptyHtmlRendered","html","imageTypes","userAgent","navigator","toLowerCase","observe","dropdowns","regexps","linkyoutube","linkvimeo","linkimage","url","keyCode","BACKSPACE","DELETE","UP","DOWN","ENTER","SPACE","ESC","TAB","CTRL","META","SHIFT","ALT","RIGHT","LEFT","LEFT_WIN","$element","loadOptions","loadModules","hasClass","loadToEdit","removeClass","reIsBlock","RegExp","join","toUpperCase","reIsInline","load","extend","$editor","detectType","core","callback","start","build","isInline","isTag","on","proxy","initToEdit","addClass","startToEdit","node","marker","get","selection","restore","clickToCancelStorage","clickToCancel","off","show","e","preventDefault","destroy","events","syncFire","hide","clickToSave","namespace","getModuleMethods","object","Object","getOwnPropertyNames","filter","property","len","bindModuleMethods","module","methods","z","enabled","collapsed","collapseToStart","collapsedEnd","collapseToEnd","detect","isMobile","button","hideButtons","hideButtonsOnMobile","$air","createContainer","css","append","$toolbar","setFormatting","editor","appendTo","attr","id","role","saveInstant","leftFix","width","innerWidth","window","clientX","top","clientY","scrollTop","bindHide","dropdown","target","closest","remove","key","which","utils","isRedactorParent","sel","range","deleteContents","ctrlKey","metaKey","shiftKey","altKey","setInactiveAll","fadeOut","name","$textarea","is","send","source","getHiddenFields","ajax","done","success","k","v","toString","indexOf","json","JSON","parse","callbackName","disable","clearInterval","autosaveTimeout","block","tag","value","tags","inArray","set","isCollapsed","formatCollapsed","formatUncollapsed","currentTag","tagName","clearAllAttrs","removeAllClass","removeAllAttr","replaced","isEndOfElement","createElement","innerHTML","after","caret","$last","children","last","replaceToTag","setAttr","trim","removeInlineTags","blocks","find","first","s","index","splice","not","contents","unwrap","getBlocks","replaceClass","removeAttr","toggleClass","replaceAttr","toggleAttr","self","returned","addAttr","attributes","$el","clear","setUndo","setRedo","saved","current","add","undo","pop","restoreInstant","redo","startTextarea","setIn","setId","enableEditor","setOptions","callEditor","createContainerBox","$box","getName","loadFromTextarea","insertAfter","prepend","aria-labelledby","textarea","clean","onSync","contenteditable","toolbarMobile","box","max-width","margin","disableBrowsersEditing","setHelpers","toolbarsButtons","element","modal","templates","cleaned","storage","setTimeout","end","execCommand","RedactorPlugins","curLang","icon","p","blockquote","pre","h1","h2","h3","h4","h5","h6","label","out","class","aria-disabled","ul","ol","in","hideButtonsSlicer","btnName","buildButtonTooltip","$btn","$tooltip","btnObject","$button","aria-label","$icon","command","setEvent","$dropdown","getButtons","getButtonsKeys","toggle","isIe","isDesktop","freezeScroll","returnValue","clickCallback","hideAll","unfreezeScroll","all","isAdded","btn","addFirst","addAfter","afterkey","parent","addBefore","beforekey","before","setIcon","changeIcon","newIconClass","addCallback","addDropdown","setActive","setInactive","$btns","enable","disableAll","enableAll","node1","node2","cs","setStart","setEnd","update","prepare","isFirefox","$first","isInlineTag","setStartEmptyOrInline","getSelection","removeAllRanges","createRange","selectNodeContents","collapse","addRange","textNode","createTextNode","insertNode","setStartAfter","space","className","setStartBefore","setEndBefore","replaceWith","lastChild","nodeType","getRangeAt","rangeCount","isBlockTag","next","prev","$next","$prev","offset","onSet","savePreCode","saveFormTags","replace","$div","parseHTML","replacement","keys","stripTags","onGet","restoreFormTags","chars","™","©","…","—","‐","onPaste","isHtmlMsWord","cleanMsWord","replaceBrToNl","removeTagsInsidePre","removeEmptyInlineTags","encode","convertTags","getPlainText","reconvertTags","replaceNbspToSpaces","encodeHtml","getCurrentType","line","isHtmlLine","isHtmlBlocked","links","images","isCurrentOrParent","match1","match","match2","matchBR","matchNL","$spans","$tags","tagHtml","isEmpty","lastList","lastLevel","listsIds","matches","currentList","parseInt","currentLevel","listType","$li","$list","data-level","data-list","$lastList","$prevList","replaceNlToBr","$links","href","tmp","j","item","outerHTML","concat","spanMarker","cleanPre","str","textContent","innerText","savePreFormatting","saveCodeFormatting","restoreSelectionMarkers","attr1","attr2","arr","codeTag","encodeEntities","String","input","denied","$0","$1","removeMarkers","removeSpaces","removeSpacesHard","normalizeCurrentHeading","heading","isCurrentOrParentHeader","normalize","stopDetectChanges","startDetectChanges","sync","htmlCleaned","isSync","startSync","addEvent","event","getEvent","_data","handler","destroyed","progress","removeData","$modalBox","$modalOverlay","isWebkit","test","documentMode","ie","isNaN","isIpad","active","position","getDropdown","dropdownObject","buildFormatting","$item","buildItem","$itemContainer","classname","$itemSpan","buildClick","buildCommand","body","getButtonPosition","showIsFixedToolbar","showIsUnFixedToolbar","disableBodyScroll","enableBodyScroll","stopPropagation","innerHeight","redactorAnimation","duration","enableCallback","enableEvents","closeHandler","dropdownWidth","Math","max","$buttons","$elements","hideOut","focused","blured","dropImage","stopChanges","dragover","dragleave","drop","originalEvent","FormData","dataTransfer","files","onDrop","onDropUpload","click","disableSelectAll","rtePaste","isCallback","blur","touchImageEditing","scrollTimer","imageEditing","clearTimeout","paste","keydown","keyup","createObserver","setupObserver","observer","MutationObserver","mutations","forEach","iterateObserver","mutation","stop","attributeName","changeHandler","subtree","childList","characterData","characterDataOldValue","upload","directUpload","stopDetect","startDetect","direct","release","$link","nodeToPoint","lastNode","activeElement","$img","src","$figure","nextNode","nextSibling","$nextFigure","isNextEmpty","isNextFigureEmpty","setEditable","$image","resizer","loadEditableControls","hideResize","setResizable","showEdit","resizeHandle","x","pageX","y","pageY","ratio","height","h","targetTouches","startResize","moveResize","stopResize","round","handle","imageBox","marginTop","style","marginBottom","marginLeft","marginRight","loadResizableControls","imageResizer","display","editter","editerWidth","$container","buttonDelete","getDeleteButton","buttonSave","getActionButton","$ficaption","floatValue","prop","setFloating","pattern","re","re2","linkProtocol","a","getOuterHtml","addCaption","imageFloat","imageDisplay","imageMargin","textAlign","float","text-align","$target","$figcaption","restoreScroll","increase","list","$current","listTag","$newList","$ol","removeEmpty","decrease","repositionItem","parents","$parent","$lists","$items","removeItemEmpty","getParams","arrangeTag","newInline","insertBreakpoint","insertInline","setParams","nodes","getClearedNodes","setNodesStriked","$inside","$parentAround","cleanInsideOrParent","removeSpecificAttr","newNodes","started","isConvertableAttr","nodeAttrValue","rules","count","ruleName","ruleValue","rgb2hex","isConvertable","nodeTag","parentNode","parentTag","convertable","breakpoint","endTag","$code","cloneAttributes","getStyleParams","result","rule","$node","eachInline","inlines","removeEmptyAttr","hasParentStyle","addParentStyle","replaceStyle","toggleStyle","newVal","oldVal","isRgb","addStyle","removeStyle","removeAllStyle","removeStyleRule","removeStyleRuleAttr","removeFormat","endNode","appendLists","isSelectAll","breaked","breakBlockTag","placeHtml","$block","wrap","raw","frag","createDocumentFragment","firstChild","appendChild","cloneRange","deleteContent","gap","placeNode","isStartOfElement","endOfNode","extractEndOfNode","isBlock","caretPositionFromPoint","pos","offsetNode","caretRangeFromPoint","createTextRange","moveToPoint","endRange","duplicate","setEndPoint","select","nodeToCaretPositionFromPoint","arrow","ctrl","figcaption","figure","checkEvents","setupBuffer","addArrowsEvent","setupSelectAll","onArrowDown","onArrowUp","wrapToParagraph","lastShiftKey","onShiftSpace","onShiftEnter","onEnter","onTab","onBackspaceAndDeleteBefore","$nextList","removeOnBackspace","combineAfterAndBefore","removeInvisibleSpace","removeEmptyListInTable","onBackspaceAndDeleteAfter","insertNewLine","saveScroll","removeEmptyLists","formatEmpty","exitFromBlockquote","insertBreakLine","replaceToParagraph","insertParagraph","checkKeyEvents","insertAfterLastElement","insertBeforeFirstElement","isList","isListStart","enableSelectAll","insertBreakLineProcessing","insertDblBreakLine","dbl","br1","br2","clone","blockElem","blockHtml","setCaretToParagraph","td","removeIt","$newTag","setUnfixed","$marker","animate","isContainImage","isKey","getLineHtml","$hr","replaceLinksToText","closeAllTooltip","buildLinkFromObject","buildModal","buildLinkFromElement","removeSelfHostFromUrl","setModalValues","buildLinkFromModal","cleanUrl","cleanText","getText","truncateUrl","isUrl","re1","re3","re4","re5","substring","isMailto","buildTarget","location","$unlinked","isLink","nodeValue","isFiltered","convertVideoLinks","convertImages","convertLinks","addBack","$objects","$newBlock","iframeStart","iframeEnd","grep","decodeURIComponent","regexB","regexp","cmd","inBlocks","parentsUntil","$insertedList","$listParent","isEmptyBlock","isBlockWrapped","num","iterateRemove","image-edit","addTemplate","template","getTemplate","getModal","$modalBody","getCancelButton","templateName","setTitle","setDraggable","setContent","buildTabber","buildWidth","$modal","timing","setEnter","windowHeight","windowWidth","number","margin-bottom","outerHeight","tabs","$tabsBox","showTab","eq","$modalHeader","draggable","buildOverlay","$modalClose","disableEvents","bodyOveflow","isCurrent","parentEl","currentEl","toggleActive","finded","isRedactor","inValues","outValues","setDropdownProperties","addProperties","deleteProperties","setDropdownAttr","properties","isDelete","img","showTooltip","getTooltipPosition","tooltip","aLink","aEdit","aUnlink","lineHeight","lineClicked","ceil","closeTooltip","cloned","div","cloneContents","endContainer","endOffset","walker","createTreeWalker","NodeFilter","SHOW_TEXT","Infinity","safes","getSafes","convert","restoreSafes","detectClipboardUpload","clipboardUpload","createPasteBox","saveBodyScroll","getPasteBoxCode","$pasteBox","appendPasteBox","$visibleModals","clipboard","clipboardData","types","items","getAsFile","reader","FileReader","readAsDataURL","onload","insertFromClipboard","imgs","formData","blob","dataURItoBlob","isEditorEmpty","isEditorRelative","setEditorRelative","buildPosition","isAttr","$style","getPosition","states","$bar","startContainer","anchorNode","previousSibling","isArray","resultNodes","commonAncestorContainer","unshift","hasChildNodes","savedSel","ownerDocument","defaultView","selectionRange","startOffset","doc","win","charIndex","nodeStack","foundStart","nextCharIndex","childNodes","container","clonedRange","extractContents","markerHtml","hotkeysSpecialKeys","8","9","10","13","16","17","18","19","20","27","32","33","34","35","36","37","38","39","40","45","46","59","61","96","97","98","99","100","101","102","103","104","105","106","107","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","144","145","173","186","187","188","189","190","191","192","219","220","221","222","hotkeysShiftNums","`","1","2","3","4","5","6","7","0","-","=",";","'",",",".","/","\\","buildHandler","origHandler","special","character","fromCharCode","modif","possible","specialKey","status","decodeURI","_this","changes","setOverflow","setFixed","toolbarOffsetTop","late","observeScroll","observeScrollDisable","getBoxTop","tolerance","boxTop","observeScrollEnable","observeScrollResize","fullscreen","isOpened","setDropdownsFixed","visibility","unsetDropdownsFixed","setDropdownPosition","$droparea","$placeholdler","$input","onDrag","onDragLeave","traverseFile","setConfig","uploads3","getType","obj","fd","appendFields","appendForms","imageFields","fileFields","xhr","XMLHttpRequest","open","setRequestHeader","onreadystatechange","readyState","responseText","err","clearImageFields","addImageFields","removeImageFields","clearFileFields","addFileFields","removeFileFields","executeOnSignedUrl","signedURL","sendToS3","mark","overrideMimeType","that","createCORSRequest","method","XDomainRequest","s3file","onerror","onprogress","isElement","HTMLElement","strpos","haystack","needle","dataURI","byteString","atob","unescape","mimeString","ia","Uint8Array","charCodeAt","Blob","from","to","attrs","$nextPart","contains","inInlines","matched","isCurrentOrParentOne","getScrollTarget","$scrollTarget","freezeScrollTop","tmpScrollTop","selectAll","$body","documentElementRect","documentElement","getBoundingClientRect","abs","isOverflowing","clientWidth","scrollbarWidth","measureScrollbar","scrollDiv","offsetWidth","removeChild","overflow","padding-right","$fields","$forms","serializeArray","f","rgb","isPad","browser","webkit","ff","jQuery","iterate","delay","prefix","slide","prefixes","queue","_callback","complete","shift","make","one","effects"],"mappings":"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","file":"redactor.min.js","sourcesContent":["/*\n\tRedactor II\n\tVersion 2.7\n\tUpdated: June 17, 2017\n\n\thttp://imperavi.com/redactor/\n\n\tCopyright (c) 2009-2017, Imperavi LLC.\n\tLicense: http://imperavi.com/redactor/license/\n\n\tUsage: $('#content').redactor();\n*/\n\n(function($)\n{\n\t'use strict';\n\n\tif (!Function.prototype.bind)\n\t{\n\t\tFunction.prototype.bind = function(scope)\n\t\t{\n\t\t\tvar fn = this;\n\t\t\treturn function()\n\t\t\t{\n\t\t\t\treturn fn.apply(scope);\n\t\t\t};\n\t\t};\n\t}\n\n\tvar uuid = 0;\n\n\t// Plugin\n\t$.fn.redactor = function(options)\n\t{\n\t\tvar val = [];\n\t\tvar args = Array.prototype.slice.call(arguments, 1);\n\n\t\tif (typeof options === 'string')\n\t\t{\n\t\t\tthis.each(function()\n\t\t\t{\n\t\t\t\tvar instance = $.data(this, 'redactor');\n\t\t\t\tvar func;\n\n\t\t\t\tif (options.search(/\\./) !== '-1')\n\t\t\t\t{\n\t\t\t\t\tfunc = options.split('.');\n\t\t\t\t\tif (typeof instance[func[0]] !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tfunc = instance[func[0]][func[1]];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tfunc = instance[options];\n\t\t\t\t}\n\n\t\t\t\tif (typeof instance !== 'undefined' && $.isFunction(func))\n\t\t\t\t{\n\t\t\t\t\tvar methodVal = func.apply(instance, args);\n\t\t\t\t\tif (methodVal !== undefined && methodVal !== instance)\n\t\t\t\t\t{\n\t\t\t\t\t\tval.push(methodVal);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$.error('No such method \"' + options + '\" for Redactor');\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.each(function()\n\t\t\t{\n\t\t\t\t$.data(this, 'redactor', {});\n\t\t\t\t$.data(this, 'redactor', Redactor(this, options));\n\t\t\t});\n\t\t}\n\n\t\tif (val.length === 0)\n\t\t{\n\t\t\treturn this;\n\t\t}\n\t\telse if (val.length === 1)\n\t\t{\n\t\t\treturn val[0];\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn val;\n\t\t}\n\n\t};\n\n\t// Initialization\n\tfunction Redactor(el, options)\n\t{\n\t\treturn new Redactor.prototype.init(el, options);\n\t}\n\n\t// Options\n\t$.Redactor = Redactor;\n\t$.Redactor.VERSION = '2.7';\n\t$.Redactor.modules = ['air', 'autosave', 'block', 'buffer', 'build', 'button', 'caret', 'clean', 'code', 'core', 'detect', 'dropdown',\n\t\t\t\t\t\t  'events', 'file', 'focus', 'image', 'indent', 'inline', 'insert', 'keydown', 'keyup',\n\t\t\t\t\t\t  'lang', 'line', 'link', 'linkify', 'list', 'marker', 'modal', 'observe', 'offset', 'paragraphize', 'paste', 'placeholder',\n\t\t\t\t\t\t  'progress', 'selection', 'shortcuts', 'storage', 'toolbar', 'upload', 'uploads3', 'utils',\n\n\t\t\t\t\t\t  'browser' // deprecated\n\t\t\t\t\t\t  ];\n\n\t$.Redactor.settings = {};\n\t$.Redactor.opts = {\n\n\t\t// settings\n\t\tanimation: false,\n\t\tlang: 'en',\n\t\tdirection: 'ltr',\n\t\tspellcheck: true,\n\t\toverrideStyles: true,\n\t\tscrollTarget: document,\n\n\t\tfocus: false,\n\t\tfocusEnd: false,\n\n\t\tclickToEdit: false,\n\t\tstructure: false,\n\n\t\ttabindex: false,\n\n\t\tminHeight: false, // string\n\t\tmaxHeight: false, // string\n\n\t\tmaxWidth: false, // string\n\n\t\tplugins: false, // array\n\t\tcallbacks: {},\n\n\t\tplaceholder: false,\n\n\t\tlinkify: true,\n\t\tenterKey: true,\n\n\t\tpastePlainText: false,\n\t\tpasteImages: true,\n\t\tpasteLinks: true,\n\t\tpasteBlockTags: ['pre', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'table', 'tbody', 'thead', 'tfoot', 'th', 'tr', 'td', 'ul', 'ol', 'li', 'blockquote', 'p', 'figure', 'figcaption'],\n\t\tpasteInlineTags: ['br', 'strong', 'ins', 'code', 'del', 'span', 'samp', 'kbd', 'sup', 'sub', 'mark', 'var', 'cite', 'small', 'b', 'u', 'em', 'i'],\n\n\t\tpreClass: false, // string\n\t\tpreSpaces: 4, // or false\n\t\ttabAsSpaces: false, // true or number of spaces\n\t\ttabKey: true,\n\n\t\tautosave: false, // false or url\n\t\tautosaveName: false,\n\t\tautosaveFields: false,\n\n\t\timageUpload: null,\n\t\timageUploadParam: 'file',\n\t\timageUploadFields: false,\n\t\timageUploadForms: false,\n        imageTag: 'figure',\n        imageEditable: true,\n\t\timageCaption: true,\n\n\t\timagePosition: false,\n\t\timageResizable: false,\n\t\timageFloatMargin: '10px',\n\n\t\tdragImageUpload: true,\n\t\tmultipleImageUpload: true,\n\t\tclipboardImageUpload: true,\n\n\t\tfileUpload: null,\n\t\tfileUploadParam: 'file',\n\t\tfileUploadFields: false,\n\t\tfileUploadForms: false,\n\t\tdragFileUpload: true,\n\n\t\ts3: false,\n\n        linkNewTab: false,\n\t\tlinkTooltip: true,\n\t\tlinkNofollow: false,\n\t\tlinkSize: 30,\n\t\tpasteLinkTarget: false,\n\n\t\tvideoContainerClass: 'video-container',\n\n\t\ttoolbar: true,\n\t\ttoolbarFixed: true,\n\t\ttoolbarFixedTarget: document,\n\t\ttoolbarFixedTopOffset: 0, // pixels\n\t\ttoolbarExternal: false, // ID selector\n\t\ttoolbarOverflow: false,\n\n\t\tair: false,\n\t\tairWidth: false,\n\n\t\tformatting: ['p', 'blockquote', 'pre', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'],\n\t\tformattingAdd: false,\n\n\t\tbuttons: ['format', 'bold', 'italic', 'deleted', 'lists', 'image', 'file', 'link', 'horizontalrule'], // + 'horizontalrule', 'underline', 'ol', 'ul', 'indent', 'outdent'\n        buttonsTextLabeled: false,\n\t\tbuttonsHide: [],\n\t\tbuttonsHideOnMobile: [],\n\n\t\tscript: true,\n\t\tremoveNewlines: false,\n\t\tremoveComments: true,\n\t\treplaceTags: {\n\t\t\t'b': 'strong',\n\t\t\t'i': 'em',\n\t\t\t'strike': 'del'\n\t\t},\n\n        keepStyleAttr: [], // tag name array\n\n\t\t// shortcuts\n\t\tshortcuts: {\n\t\t\t'ctrl+shift+m, meta+shift+m': { func: 'inline.removeFormat' },\n\t\t\t'ctrl+b, meta+b': { func: 'inline.format', params: ['bold'] },\n\t\t\t'ctrl+i, meta+i': { func: 'inline.format', params: ['italic'] },\n\t\t\t'ctrl+h, meta+h': { func: 'inline.format', params: ['superscript'] },\n\t\t\t'ctrl+l, meta+l': { func: 'inline.format', params: ['subscript'] },\n\t\t\t'ctrl+k, meta+k': { func: 'link.show' },\n\t\t\t'ctrl+shift+7':   { func: 'list.toggle', params: ['orderedlist'] },\n\t\t\t'ctrl+shift+8':   { func: 'list.toggle', params: ['unorderedlist'] }\n\t\t},\n\t\tshortcutsAdd: false,\n\n\t\tactiveButtons: ['deleted', 'italic', 'bold'],\n\t\tactiveButtonsStates: {\n\t\t\tb: 'bold',\n\t\t\tstrong: 'bold',\n\t\t\ti: 'italic',\n\t\t\tem: 'italic',\n\t\t\tdel: 'deleted',\n\t\t\tstrike: 'deleted'\n\t\t},\n\n\t\t// private lang\n\t\tlangs: {\n\t\t\ten: {\n\n\t\t\t\t\"format\": \"Format\",\n\t\t\t\t\"image\": \"Image\",\n\t\t\t\t\"file\": \"File\",\n\t\t\t\t\"link\": \"Link\",\n\t\t\t\t\"bold\": \"Bold\",\n\t\t\t\t\"italic\": \"Italic\",\n\t\t\t\t\"deleted\": \"Strikethrough\",\n\t\t\t\t\"underline\": \"Underline\",\n\t\t\t\t\"bold-abbr\": \"B\",\n\t\t\t\t\"italic-abbr\": \"I\",\n\t\t\t\t\"deleted-abbr\": \"S\",\n\t\t\t\t\"underline-abbr\": \"U\",\n\t\t\t\t\"lists\": \"Lists\",\n\t\t\t\t\"link-insert\": \"Insert link\",\n\t\t\t\t\"link-edit\": \"Edit link\",\n\t\t\t\t\"link-in-new-tab\": \"Open link in new tab\",\n\t\t\t\t\"unlink\": \"Unlink\",\n\t\t\t\t\"cancel\": \"Cancel\",\n\t\t\t\t\"close\": \"Close\",\n\t\t\t\t\"insert\": \"Insert\",\n\t\t\t\t\"save\": \"Save\",\n\t\t\t\t\"delete\": \"Delete\",\n\t\t\t\t\"text\": \"Text\",\n\t\t\t\t\"edit\": \"Edit\",\n\t\t\t\t\"title\": \"Title\",\n\t\t\t\t\"paragraph\": \"Normal text\",\n\t\t\t\t\"quote\": \"Quote\",\n\t\t\t\t\"code\": \"Code\",\n\t\t\t\t\"heading1\": \"Heading 1\",\n\t\t\t\t\"heading2\": \"Heading 2\",\n\t\t\t\t\"heading3\": \"Heading 3\",\n\t\t\t\t\"heading4\": \"Heading 4\",\n\t\t\t\t\"heading5\": \"Heading 5\",\n\t\t\t\t\"heading6\": \"Heading 6\",\n\t\t\t\t\"filename\": \"Name\",\n\t\t\t\t\"optional\": \"optional\",\n\t\t\t\t\"unorderedlist\": \"Unordered List\",\n\t\t\t\t\"orderedlist\": \"Ordered List\",\n\t\t\t\t\"outdent\": \"Outdent\",\n\t\t\t\t\"indent\": \"Indent\",\n\t\t\t\t\"horizontalrule\": \"Line\",\n\t\t\t\t\"upload-label\": \"Drop file here or \",\n\t\t\t\t\"caption\": \"Caption\",\n\n\t\t\t\t\"bulletslist\": \"Bullets\",\n\t\t\t\t\"numberslist\": \"Numbers\",\n\n\t\t\t\t\"image-position\": \"Position\",\n\t\t\t\t\"none\": \"None\",\n\t\t\t\t\"left\": \"Left\",\n\t\t\t\t\"right\": \"Right\",\n\t\t\t\t\"center\": \"Center\",\n\n\t\t\t\t\"accessibility-help-label\": \"Rich text editor\"\n\t\t\t}\n\t\t},\n\n\t\t// private\n\t\ttype: 'textarea', // textarea, div, inline, pre\n\t\tinline: false,\n\t\tbuffer: [],\n\t\trebuffer: [],\n\t\tinlineTags: ['a', 'span', 'strong', 'strike', 'b', 'u', 'em', 'i', 'code', 'del', 'ins', 'samp', 'kbd', 'sup', 'sub', 'mark', 'var', 'cite', 'small'],\n\t\tblockTags: ['pre', 'ul', 'ol', 'li', 'p', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6',  'dl', 'dt', 'dd', 'div', 'td', 'blockquote', 'output', 'figcaption', 'figure', 'address', 'section', 'header', 'footer', 'aside', 'article', 'iframe'],\n\t\tparagraphize: true,\n\t\tparagraphizeBlocks: ['table', 'div', 'pre', 'form', 'ul', 'ol', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'dl', 'blockquote', 'figcaption',\n\t\t\t\t\t\t\t'address', 'section', 'header', 'footer', 'aside', 'article', 'object', 'style', 'script', 'iframe', 'select', 'input', 'textarea',\n\t\t\t\t\t\t\t'button', 'option', 'map', 'area', 'math', 'hr', 'fieldset', 'legend', 'hgroup', 'nav', 'figure', 'details', 'menu', 'summary', 'p'],\n\t\temptyHtml: '<p>&#x200b;</p>',\n\t\tinvisibleSpace: '&#x200b;',\n\t\temptyHtmlRendered: $('').html('​').html(),\n\t\timageTypes: ['image/png', 'image/jpeg', 'image/gif'],\n\t\tuserAgent: navigator.userAgent.toLowerCase(),\n\t\tobserve: {\n\t\t\tdropdowns: []\n\t\t},\n\t\tregexps: {\n\t\t\tlinkyoutube: /https?:\\/\\/(?:[0-9A-Z-]+\\.)?(?:youtu\\.be\\/|youtube\\.com\\S*[^\\w\\-\\s])([\\w\\-]{11})(?=[^\\w\\-]|$)(?![?=&+%\\w.\\-]*(?:['\"][^<>]*>|<\\/a>))[?=&+%\\w.-]*/ig,\n\t\t\tlinkvimeo: /https?:\\/\\/(www\\.)?vimeo.com\\/(\\d+)($|\\/)/,\n\t\t\tlinkimage: /((https?|www)[^\\s]+\\.)(jpe?g|png|gif)(\\?[^\\s-]+)?/ig,\n\t\t\turl: /(https?:\\/\\/(?:www\\.|(?!www))[^\\s\\.]+\\.[^\\s]{2,}|www\\.[^\\s]+\\.[^\\s]{2,})/ig\n\t\t}\n\n\t};\n\n\t// Functionality\n\tRedactor.fn = $.Redactor.prototype = {\n\n\t\tkeyCode: {\n\t\t\tBACKSPACE: 8,\n\t\t\tDELETE: 46,\n\t\t\tUP: 38,\n\t\t\tDOWN: 40,\n\t\t\tENTER: 13,\n\t\t\tSPACE: 32,\n\t\t\tESC: 27,\n\t\t\tTAB: 9,\n\t\t\tCTRL: 17,\n\t\t\tMETA: 91,\n\t\t\tSHIFT: 16,\n\t\t\tALT: 18,\n\t\t\tRIGHT: 39,\n\t\t\tLEFT: 37,\n\t\t\tLEFT_WIN: 91\n\t\t},\n\n\t\t// =init\n\t\tinit: function(el, options)\n\t\t{\n\t\t\tthis.$element = $(el);\n\t\t\tthis.uuid = uuid++;\n\n\t\t\tthis.loadOptions(options);\n\t\t\tthis.loadModules();\n\n\t\t\t// click to edit\n\t\t\tif (this.opts.clickToEdit && !this.$element.hasClass('redactor-click-to-edit'))\n\t\t\t{\n\t\t\t\treturn this.loadToEdit(options);\n\t\t\t}\n\t\t\telse if (this.$element.hasClass('redactor-click-to-edit'))\n\t\t\t{\n\t\t\t\tthis.$element.removeClass('redactor-click-to-edit');\n\t\t\t}\n\n\t\t\t// block & inline test tag regexp\n\t\t\tthis.reIsBlock = new RegExp('^(' + this.opts.blockTags.join('|' ).toUpperCase() + ')$', 'i');\n\t\t\tthis.reIsInline = new RegExp('^(' + this.opts.inlineTags.join('|' ).toUpperCase() + ')$', 'i');\n\n\t\t\t// set up drag upload\n\t\t\tthis.opts.dragImageUpload = (this.opts.imageUpload === null) ? false : this.opts.dragImageUpload;\n\t\t\tthis.opts.dragFileUpload = (this.opts.fileUpload === null) ? false : this.opts.dragFileUpload;\n\n\t\t\t// formatting storage\n\t\t\tthis.formatting = {};\n\n\t\t\t// load lang\n\t\t\tthis.lang.load();\n\n\t\t\t// extend shortcuts\n\t\t\t$.extend(this.opts.shortcuts, this.opts.shortcutsAdd);\n\n\t\t\t// set editor\n\t\t\tthis.$editor = this.$element;\n\n\t\t\t// detect type of editor\n\t\t\tthis.detectType();\n\n\t\t\t// start callback\n\t\t\tthis.core.callback('start');\n\t\t\tthis.core.callback('startToEdit');\n\n\t\t\t// build\n\t\t\tthis.start = true;\n\t\t\tthis.build.start();\n\n\t\t},\n\t\tdetectType: function()\n\t\t{\n\t\t\tif (this.build.isInline() || this.opts.inline)\n\t\t\t{\n\t\t\t\tthis.opts.type = 'inline';\n\t\t\t}\n\t\t\telse if (this.build.isTag('DIV'))\n\t\t\t{\n\t\t\t\tthis.opts.type = 'div';\n\t\t\t}\n\t\t\telse if (this.build.isTag('PRE'))\n\t\t\t{\n\t\t\t\tthis.opts.type = 'pre';\n\t\t\t}\n\t\t},\n\t\tloadToEdit: function(options)\n\t\t{\n\n\t\t\tthis.$element.on('click.redactor-click-to-edit', $.proxy(function()\n\t\t\t{\n\t\t\t\tthis.initToEdit(options);\n\n\t\t\t}, this));\n\n\t\t\tthis.$element.addClass('redactor-click-to-edit');\n\n\t\t\treturn;\n\t\t},\n\t\tinitToEdit: function(options)\n\t\t{\n\t\t\t$.extend(options.callbacks,  {\n\t\t\t\tstartToEdit: function()\n\t\t\t\t{\n\t\t\t\t\tthis.insert.node(this.marker.get(), false);\n\t\t\t\t},\n\t\t\t\tinitToEdit: function()\n\t\t\t\t{\n\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\tthis.clickToCancelStorage = this.code.get();\n\n\t\t\t\t\t// cancel\n\t\t\t\t\t$(this.opts.clickToCancel).off('.redactor-click-to-edit');\n\t\t\t\t\t$(this.opts.clickToCancel).show().on('click.redactor-click-to-edit', $.proxy(function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\tthis.core.destroy();\n\t\t\t\t\t\tthis.events.syncFire = false;\n\t\t\t\t\t\tthis.$element.html(this.clickToCancelStorage);\n\t\t\t\t\t\tthis.core.callback('cancel', this.clickToCancelStorage);\n\t\t\t\t\t\tthis.events.syncFire = true;\n\t\t\t\t\t\tthis.clickToCancelStorage = '';\n\t\t\t\t\t\t$(this.opts.clickToCancel).hide();\n\t\t\t\t\t\t$(this.opts.clickToSave).hide();\n\n\t\t\t\t\t\tthis.$element.on('click.redactor-click-to-edit', $.proxy(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.initToEdit(options);\n\t\t\t\t\t\t}, this));\n\n\t\t\t\t\t\tthis.$element.addClass('redactor-click-to-edit');\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\t// save\n\t\t\t\t\t$(this.opts.clickToSave).off('.redactor-click-to-edit');\n\t\t\t\t\t$(this.opts.clickToSave).show().on('click.redactor-click-to-edit', $.proxy(function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\tthis.core.destroy();\n\t\t\t\t\t\tthis.core.callback('save', this.code.get());\n\t\t\t\t\t\t$(this.opts.clickToCancel).hide();\n\t\t\t\t\t\t$(this.opts.clickToSave).hide();\n\t\t\t\t\t\tthis.$element.on('click.redactor-click-to-edit', $.proxy(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.initToEdit(options);\n\t\t\t\t\t\t}, this));\n\t\t\t\t\t\tthis.$element.addClass('redactor-click-to-edit');\n\n\t\t\t\t\t}, this));\n\t\t\t\t}\n\n\t\t\t});\n\n\t\t\tthis.$element.redactor(options);\n\t\t\tthis.$element.off('.redactor-click-to-edit');\n\n\t\t},\n\t\tloadOptions: function(options)\n\t\t{\n\t\t\tvar settings = {};\n\n\t\t\t// check namespace\n\t\t\tif (typeof $.Redactor.settings.namespace !== 'undefined')\n\t\t\t{\n\t\t\t\t if (this.$element.hasClass($.Redactor.settings.namespace))\n\t\t\t\t {\n\t\t\t\t\t settings = $.Redactor.settings;\n\t\t\t\t }\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tsettings = $.Redactor.settings;\n\t\t\t}\n\n\t\t\tthis.opts = $.extend(\n\t\t\t\t{},\n\t\t\t\t$.Redactor.opts,\n\t\t\t\tthis.$element.data(),\n\t\t\t\toptions\n\t\t\t);\n\n\t\t\tthis.opts = $.extend(true, this.opts, settings);\n\n\t\t},\n\t\tgetModuleMethods: function(object)\n\t\t{\n\t\t\treturn Object.getOwnPropertyNames(object).filter(function(property)\n\t\t\t{\n\t\t\t\treturn typeof object[property] === 'function';\n\t\t\t});\n\t\t},\n\t\tloadModules: function()\n\t\t{\n\t\t\tvar len = $.Redactor.modules.length;\n\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t{\n\t\t\t\tthis.bindModuleMethods($.Redactor.modules[i]);\n\t\t\t}\n\t\t},\n\t\tbindModuleMethods: function(module)\n\t\t{\n\t\t\tif (typeof this[module] === 'undefined')\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// init module\n\t\t\tthis[module] = this[module]();\n\n\t\t\tvar methods = this.getModuleMethods(this[module]);\n\t\t\tvar len = methods.length;\n\n\t\t\t// bind methods\n\t\t\tfor (var z = 0; z < len; z++)\n\t\t\t{\n\t\t\t\tthis[module][methods[z]] = this[module][methods[z]].bind(this);\n\t\t\t}\n\t\t},\n\n\t\t// =air\n\t\tair: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tenabled: false,\n\t\t\t\tcollapsed: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.air)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.selection.get().collapseToStart();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tcollapsedEnd: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.air)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.selection.get().collapseToEnd();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tbuild: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.detect.isMobile())\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.button.hideButtons();\n\t\t\t\t\tthis.button.hideButtonsOnMobile();\n\n\t\t\t\t\tif (this.opts.buttons.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.$air = this.air.createContainer();\n\n\t\t\t\t\tif (this.opts.airWidth !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$air.css('width', this.opts.airWidth);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.air.append();\n\t\t\t\t\tthis.button.$toolbar = this.$air;\n\t\t\t\t\tthis.button.setFormatting();\n\t\t\t\t\tthis.button.load(this.$air);\n\n\t\t\t\t\tthis.core.editor().on('mouseup.redactor', this, $.proxy(function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.selection.text() !== '')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.air.show(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}, this));\n\n\t\t\t\t},\n\t\t\t\tappend: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$air.appendTo('body');\n\t\t\t\t},\n\t\t\t\tcreateContainer: function()\n\t\t\t\t{\n\t\t\t\t\treturn $('<ul>').addClass('redactor-air').attr({ 'id': 'redactor-air-' + this.uuid, 'role': 'toolbar' }).hide();\n\t\t\t\t},\n\t\t\t\tshow: function (e)\n\t\t\t\t{\n\t\t\t\t\t//this.marker.remove();\n\t\t\t\t\tthis.selection.saveInstant();\n\t\t\t\t\t//this.selection.restore(false);\n\n\t\t\t\t\t$('.redactor-air').hide();\n\n\t\t\t\t\tvar leftFix = 0;\n\t\t\t\t\tvar width = this.$air.innerWidth();\n\n\t\t\t\t\tif ($(window).width() < (e.clientX + width))\n\t\t\t\t\t{\n\t\t\t\t\t\tleftFix = 200;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.$air.css({\n\t\t\t\t\t\tleft: (e.clientX - leftFix) + 'px',\n\t\t\t\t\t\ttop: (e.clientY + 10 + $(document).scrollTop()) + 'px'\n\t\t\t\t\t}).show();\n\n\t\t\t\t\tthis.air.enabled = true;\n\t\t\t\t\tthis.air.bindHide();\n\t\t\t\t},\n\t\t\t\tbindHide: function()\n\t\t\t\t{\n\t\t\t\t\t$(document).on('mousedown.redactor-air.' + this.uuid, $.proxy(function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar dropdown = $(e.target).closest('.redactor-dropdown').length;\n\n\t\t\t\t\t\tif ($(e.target).closest(this.$air).length === 0 && dropdown === 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar hide = this.air.hide(e);\n\t\t\t\t\t\t\tif (hide !== false)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.marker.remove();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}, this)).on('keydown.redactor-air.' + this.uuid, $.proxy(function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar key = e.which;\n\t\t\t\t\t\tif ((!this.utils.isRedactorParent(e.target) && !$(e.target).hasClass('redactor-in')) || $(e.target).closest('#redactor-modal').length !== 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (key === this.keyCode.ESC)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.selection.get().collapseToStart();\n\t\t\t\t\t\t\t//this.marker.remove();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (key === this.keyCode.BACKSPACE || key === this.keyCode.DELETE)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\t\t\tvar range = this.selection.range(sel);\n\t\t\t\t\t\t\trange.deleteContents();\n\t\t\t\t\t\t\t//this.marker.remove();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (key === this.keyCode.ENTER)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.selection.get().collapseToEnd();\n\t\t\t\t\t\t\t//this.marker.remove();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.air.enabled)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.air.hide(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.selection.get().collapseToStart();\n\t\t\t\t\t\t\t//this.marker.remove();\n\t\t\t\t\t\t}\n\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\thide: function(e)\n\t\t\t\t{\n\t\t\t\t\tvar ctrl = e.ctrlKey || e.metaKey || (e.shiftKey && e.altKey);\n\t\t\t\t\tif (ctrl)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.button.setInactiveAll();\n\t\t\t\t\tthis.$air.fadeOut(100);\n\t\t\t\t\tthis.air.enabled = false;\n\t\t\t\t\t$(document).off('mousedown.redactor-air.' + this.uuid);\n\t\t\t\t\t$(document).off('keydown.redactor-air.' + this.uuid);\n\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =autosave\n\t\tautosave: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tenabled: false,\n\t\t\t\thtml: false,\n\t\t\t\tinit: function()\n\t\t\t\t{\n\t\t\t\t\tif (!this.opts.autosave)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.autosave.enabled = true;\n\t\t\t\t\tthis.autosave.name = (this.opts.autosaveName) ? this.opts.autosaveName : this.$textarea.attr('name');\n\n\t\t\t\t},\n\t\t\t\tis: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.autosave.enabled;\n\t\t\t\t},\n\t\t\t\tsend: function()\n\t\t\t\t{\n\t\t\t\t\tif (!this.opts.autosave)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.autosave.source = this.code.get();\n\n\t\t\t\t\tif (this.autosave.html === this.autosave.source)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// data\n\t\t\t\t\tvar data = {};\n\t\t\t\t\tdata.name = this.autosave.name;\n\t\t\t\t\tdata[this.autosave.name] = this.autosave.source;\n\t\t\t\t\tdata = this.autosave.getHiddenFields(data);\n\n\t\t\t\t\t// ajax\n\t\t\t\t\tvar jsxhr = $.ajax({\n\t\t\t\t\t\turl: this.opts.autosave,\n\t\t\t\t\t\ttype: 'post',\n\t\t\t\t\t\tdata: data\n\t\t\t\t\t});\n\n\t\t\t\t\tjsxhr.done(this.autosave.success);\n\t\t\t\t},\n\t\t\t\tgetHiddenFields: function(data)\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.autosaveFields === false || typeof this.opts.autosaveFields !== 'object')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn data;\n\t\t\t\t\t}\n\n\t\t\t\t\t$.each(this.opts.autosaveFields, $.proxy(function(k, v)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (v !== null && v.toString().indexOf('#') === 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tv = $(v).val();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdata[k] = v;\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\treturn data;\n\n\t\t\t\t},\n\t\t\t\tsuccess: function(data)\n\t\t\t\t{\n\t\t\t\t\tvar json;\n\t\t\t\t\ttry\n\t\t\t\t\t{\n\t\t\t\t\t\tjson = JSON.parse(data);\n\t\t\t\t\t}\n\t\t\t\t\tcatch(e)\n\t\t\t\t\t{\n\t\t\t\t\t\t//data has already been parsed\n\t\t\t\t\t\tjson = data;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar callbackName = (typeof json.error === 'undefined') ? 'autosave' :  'autosaveError';\n\n\t\t\t\t\tthis.core.callback(callbackName, this.autosave.name, json);\n\t\t\t\t\tthis.autosave.html = this.autosave.source;\n\t\t\t\t},\n\t\t\t\tdisable: function()\n\t\t\t\t{\n\t\t\t\t\tthis.autosave.enabled = false;\n\n\t\t\t\t\tclearInterval(this.autosaveTimeout);\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =block\n\t\tblock: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tformat: function(tag, attr, value, type)\n\t\t\t\t{\n\t\t\t\t\ttag = (tag === 'quote') ? 'blockquote' : tag;\n\n\t\t\t\t\tthis.block.tags = ['p', 'blockquote', 'pre', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'div', 'figure'];\n\t\t\t\t\tif ($.inArray(tag, this.block.tags) === -1)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (tag === 'p' && typeof attr === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\t// remove all\n\t\t\t\t\t\tattr = 'class';\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.placeholder.hide();\n\t\t\t\t\tthis.buffer.set();\n\n\t\t\t\t\treturn (this.utils.isCollapsed()) ? this.block.formatCollapsed(tag, attr, value, type) : this.block.formatUncollapsed(tag, attr, value, type);\n\t\t\t\t},\n\t\t\t\tformatCollapsed: function(tag, attr, value, type)\n\t\t\t\t{\n\t\t\t\t\tthis.selection.save();\n\n\t\t\t\t\tvar block = this.selection.block();\n\t\t\t\t\tvar currentTag = block.tagName.toLowerCase();\n\t\t\t\t\tif ($.inArray(currentTag, this.block.tags) === -1)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n                    var clearAllAttrs = false;\n\t\t\t\t\tif (currentTag === tag && attr === undefined)\n\t\t\t\t\t{\n\t\t\t\t\t\ttag = 'p';\n\t\t\t\t\t\tclearAllAttrs = true;\n\t\t\t\t\t}\n\n\n                    if (clearAllAttrs)\n                    {\n                        this.block.removeAllClass();\n                        this.block.removeAllAttr();\n                    }\n\n\n                    var replaced;\n                    if (currentTag === 'blockquote' && this.utils.isEndOfElement(block))\n                    {\n                        this.marker.remove();\n\n                        replaced = document.createElement('p');\n                        replaced.innerHTML = this.opts.invisibleSpace;\n\n                        $(block).after(replaced);\n                        this.caret.start(replaced);\n                        var $last = $(block).children().last();\n\n                        if ($last.length !== 0 && $last[0].tagName === 'BR')\n                        {\n                            $last.remove();\n                        }\n                    }\n                    else\n                    {\n\t\t\t\t\t    replaced = this.utils.replaceToTag(block, tag);\n                    }\n\n\n\t\t\t\t\tif (typeof attr === 'object')\n\t\t\t\t\t{\n\t\t\t\t\t\ttype = value;\n\t\t\t\t\t\tfor (var key in attr)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treplaced = this.block.setAttr(replaced, key, attr[key], type);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\treplaced = this.block.setAttr(replaced, attr, value, type);\n\t\t\t\t\t}\n\n\n\t\t\t\t\t// trim pre\n\t\t\t\t\tif (tag === 'pre' && replaced.length === 1)\n\t\t\t\t\t{\n\t\t\t\t\t\t$(replaced).html($.trim($(replaced).html()));\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\tthis.block.removeInlineTags(replaced);\n\n\t\t\t\t\treturn replaced;\n\t\t\t\t},\n\t\t\t\tformatUncollapsed: function(tag, attr, value, type)\n\t\t\t\t{\n\t\t\t\t\tthis.selection.save();\n\n\t\t\t\t\tvar replaced = [];\n\t\t\t\t\tvar blocks = this.selection.blocks();\n\n                    if (blocks[0] && ($(blocks[0]).hasClass('redactor-in') || $(blocks[0]).hasClass('redactor-box')))\n                    {\n                        blocks = this.core.editor().find(this.opts.blockTags.join(', '));\n\t\t\t\t\t}\n\n\t\t\t\t\tvar len = blocks.length;\n\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar currentTag = blocks[i].tagName.toLowerCase();\n\t\t\t\t\t\tif ($.inArray(currentTag, this.block.tags) !== -1 && currentTag !== 'figure')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar block = this.utils.replaceToTag(blocks[i], tag);\n\n\t\t\t\t\t\t\tif (typeof attr === 'object')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttype = value;\n\t\t\t\t\t\t\t\tfor (var key in attr)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tblock = this.block.setAttr(block, key, attr[key], type);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tblock = this.block.setAttr(block, attr, value, type);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treplaced.push(block);\n\t\t\t\t\t\t\tthis.block.removeInlineTags(block);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.selection.restore();\n\n\t\t\t\t\t// combine pre\n\t\t\t\t\tif (tag === 'pre' && replaced.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar first = replaced[0];\n\t\t\t\t\t\t$.each(replaced, function(i,s)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (i !== 0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$(first).append(\"\\n\" + $.trim(s.html()));\n\t\t\t\t\t\t\t\t$(s).remove();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treplaced = [];\n\t\t\t\t\t\treplaced.push(first);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn replaced;\n\t\t\t\t},\n\t\t\t\tremoveInlineTags: function(node)\n\t\t\t\t{\n\t\t\t\t\tnode = node[0] || node;\n\n\t\t\t\t\tvar tags = this.opts.inlineTags;\n\t\t\t\t\tvar blocks = ['PRE', 'H1', 'H2', 'H3', 'H4', 'H5', 'H6'];\n\n\t\t\t\t\tif ($.inArray(node.tagName, blocks) === - 1)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (node.tagName !== 'PRE')\n\t\t\t\t\t{\n\t\t\t\t\t\tvar index = tags.indexOf('a');\n\t\t\t\t\t\ttags.splice(index, 1);\n\t\t\t\t\t}\n\n\t\t\t\t\t$(node).find(tags.join(',')).not('.redactor-selection-marker').contents().unwrap();\n\t\t\t\t},\n\t\t\t\tsetAttr: function(block, attr, value, type)\n\t\t\t\t{\n\t\t\t\t\tif (typeof attr === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn block;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar func = (typeof type === 'undefined') ? 'replace' : type;\n\n\t\t\t\t\tif (attr === 'class')\n\t\t\t\t\t{\n\t\t\t\t\t\tblock = this.block[func + 'Class'](value, block);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tif (func === 'remove')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tblock = this.block[func + 'Attr'](attr, block);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (func === 'removeAll')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tblock = this.block[func + 'Attr'](attr, block);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tblock = this.block[func + 'Attr'](attr, value, block);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn block;\n\n\t\t\t\t},\n\t\t\t\tgetBlocks: function(block)\n\t\t\t\t{\n\t\t\t\t\treturn (typeof block === 'undefined') ? this.selection.blocks() : block;\n\t\t\t\t},\n\t\t\t\treplaceClass: function(value, block)\n\t\t\t\t{\n\t\t\t\t\treturn $(this.block.getBlocks(block)).removeAttr('class').addClass(value)[0];\n\t\t\t\t},\n\t\t\t\ttoggleClass: function(value, block)\n\t\t\t\t{\n\t\t\t\t\treturn $(this.block.getBlocks(block)).toggleClass(value)[0];\n\t\t\t\t},\n\t\t\t\taddClass: function(value, block)\n\t\t\t\t{\n\t\t\t\t\treturn $(this.block.getBlocks(block)).addClass(value)[0];\n\t\t\t\t},\n\t\t\t\tremoveClass: function(value, block)\n\t\t\t\t{\n\t\t\t\t\treturn $(this.block.getBlocks(block)).removeClass(value)[0];\n\t\t\t\t},\n\t\t\t\tremoveAllClass: function(block)\n\t\t\t\t{\n\t\t\t\t\treturn $(this.block.getBlocks(block)).removeAttr('class')[0];\n\t\t\t\t},\n\t\t\t\treplaceAttr: function(attr, value, block)\n\t\t\t\t{\n\t\t\t\t\tblock = this.block.removeAttr(attr, block);\n\n\t\t\t\t\treturn $(block).attr(attr, value)[0];\n\t\t\t\t},\n\t\t\t\ttoggleAttr: function(attr, value, block)\n\t\t\t\t{\n\t\t\t\t\tblock = this.block.getBlocks(block);\n\n\t\t\t\t\tvar self = this;\n\t\t\t\t\tvar returned = [];\n\t\t\t\t\t$.each(block, function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $el = $(s);\n\t\t\t\t\t\tif ($el.attr(attr))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturned.push(self.block.removeAttr(attr, s));\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturned.push(self.block.addAttr(attr, value, s));\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\treturn returned;\n\n\t\t\t\t},\n\t\t\t\taddAttr: function(attr, value, block)\n\t\t\t\t{\n\t\t\t\t\treturn $(this.block.getBlocks(block)).attr(attr, value)[0];\n\t\t\t\t},\n\t\t\t\tremoveAttr: function(attr, block)\n\t\t\t\t{\n\t\t\t\t\treturn $(this.block.getBlocks(block)).removeAttr(attr)[0];\n\t\t\t\t},\n\t\t\t\tremoveAllAttr: function(block)\n\t\t\t\t{\n\t\t\t\t\tblock = this.block.getBlocks(block);\n\n\t\t\t\t\tvar returned = [];\n\t\t\t\t\t$.each(block, function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (typeof s.attributes === 'undefined')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturned.push(s);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar $el = $(s);\n\t\t\t\t\t\tvar len = s.attributes.length;\n\t\t\t\t\t\tfor (var z = 0; z < len; z++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$el.removeAttr(s.attributes[z].name);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturned.push($el[0]);\n\t\t\t\t\t});\n\n\t\t\t\t\treturn returned;\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// buffer\n\t\tbuffer: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tset: function(type)\n\t\t\t\t{\n    \t\t\t\tif (typeof type === 'undefined')\n                    {\n                        this.buffer.clear();\n                    }\n\n\t\t\t\t\tif (typeof type === 'undefined' || type === 'undo')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buffer.setUndo();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buffer.setRedo();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsetUndo: function()\n\t\t\t\t{\n                    var saved = this.selection.saveInstant();\n\n\t\t\t\t\tvar last = this.opts.buffer[this.opts.buffer.length-1];\n\t\t\t\t\tvar current = this.core.editor().html();\n\n\t\t\t\t\tvar save = (typeof last !== 'undefined' && (last[0] === current)) ? false : true;\n    \t\t\t\tif (save)\n    \t\t\t\t{\n\t\t\t\t\t\tthis.opts.buffer.push([current, saved]);\n\t\t\t\t\t}\n\n\t\t\t\t\t//this.selection.restoreInstant();\n\t\t\t\t},\n\t\t\t\tsetRedo: function()\n\t\t\t\t{\n\t\t\t\t\tvar saved = this.selection.saveInstant();\n\t\t\t\t\tthis.opts.rebuffer.push([this.core.editor().html(), saved]);\n\t\t\t\t\t//this.selection.restoreInstant();\n\t\t\t\t},\n\t\t\t\tadd: function()\n\t\t\t\t{\n\t\t\t\t\tthis.opts.buffer.push([this.core.editor().html(), 0]);\n\t\t\t\t},\n\t\t\t\tundo: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.buffer.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar buffer = this.opts.buffer.pop();\n\n\t\t\t\t\tthis.buffer.set('redo');\n\t\t\t\t\tthis.core.editor().html(buffer[0]);\n\n\t\t\t\t\tthis.selection.restoreInstant(buffer[1]);\n\t\t\t\t\tthis.observe.load();\n\t\t\t\t},\n\t\t\t\tredo: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.rebuffer.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar buffer = this.opts.rebuffer.pop();\n\n\t\t\t\t\tthis.buffer.set('undo');\n\t\t\t\t\tthis.core.editor().html(buffer[0]);\n\n\t\t\t\t\tthis.selection.restoreInstant(buffer[1]);\n\t\t\t\t\tthis.observe.load();\n\t\t\t\t},\n\t\t\t\tclear: function()\n\t\t\t\t{\n    \t\t\t\tthis.opts.rebuffer = [];\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =build\n\t\tbuild: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tstart: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.type === 'inline')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.opts.type = 'inline';\n\t\t\t\t\t}\n\t\t\t\t\telse if (this.opts.type === 'div')\n\t\t\t\t\t{\n\t\t\t\t\t\t// empty\n\t\t\t\t\t\tvar html = $.trim(this.$editor.html());\n\t\t\t\t\t\tif (html === '')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.$editor.html(this.opts.emptyHtml);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (this.opts.type === 'textarea')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.build.startTextarea();\n\t\t\t\t\t}\n\n\t\t\t\t\t// set in\n\t\t\t\t\tthis.build.setIn();\n\n\t\t\t\t\t// set id\n\t\t\t\t\tthis.build.setId();\n\n\t\t\t\t\t// enable\n\t\t\t\t\tthis.build.enableEditor();\n\n\t\t\t\t\t// options\n\t\t\t\t\tthis.build.setOptions();\n\n\t\t\t\t\t// call\n\t\t\t\t\tthis.build.callEditor();\n\n\n\t\t\t\t},\n\t\t\t\tcreateContainerBox: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$box = $('<div class=\"redactor-box\" role=\"application\" />');\n\t\t\t\t},\n\t\t\t\tsetIn: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().addClass('redactor-in');\n\t\t\t\t},\n\t\t\t\tsetId: function()\n\t\t\t\t{\n\t\t\t\t\tvar id = (this.opts.type === 'textarea') ? 'redactor-uuid-' + this.uuid : this.$element.attr('id');\n\n\t\t\t\t\tthis.core.editor().attr('id', (typeof id === 'undefined') ? 'redactor-uuid-' + this.uuid : id);\n\t\t\t\t},\n\t\t\t\tgetName: function()\n\t\t\t\t{\n\t\t\t\t\tvar name = this.$element.attr('name');\n\n\t\t\t\t\treturn (typeof name === 'undefined') ? 'content-' + this.uuid : name;\n\t\t\t\t},\n\t\t\t\tloadFromTextarea: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$editor = $('<div />');\n\n\t\t\t\t\t// textarea\n\t\t\t\t\tthis.$textarea = this.$element;\n\t\t\t\t\tthis.$element.attr('name', this.build.getName());\n\n\t\t\t\t\t// place\n\t\t\t\t\tthis.$box.insertAfter(this.$element).append(this.$editor).append(this.$element);\n                    this.$editor.addClass('redactor-layer');\n\n\t\t\t\t\tif (this.opts.overrideStyles)\n\t\t\t\t\t{\n\t\t\t\t\t    this.$editor.addClass('redactor-styles');\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.$element.hide();\n\n\t\t\t\t\tthis.$box.prepend('<span class=\"redactor-voice-label\" id=\"redactor-voice-' + this.uuid +'\" aria-hidden=\"false\">' + this.lang.get('accessibility-help-label') + '</span>');\n\t\t\t\t\tthis.$editor.attr({ 'aria-labelledby': 'redactor-voice-' + this.uuid, 'role': 'presentation' });\n\t\t\t\t},\n\t\t\t\tstartTextarea: function()\n\t\t\t\t{\n\t\t\t\t\tthis.build.createContainerBox();\n\n\t\t\t\t\t// load\n\t\t\t\t\tthis.build.loadFromTextarea();\n\n\t\t\t\t\t// set code\n\t\t\t\t\tthis.code.start(this.core.textarea().val());\n\n\t\t\t\t\t// set value\n\t\t\t\t\tthis.core.textarea().val(this.clean.onSync(this.$editor.html()));\n\t\t\t\t},\n\t\t\t\tisTag: function(tag)\n\t\t\t\t{\n\t\t\t\t\treturn (this.$element[0].tagName === tag);\n\t\t\t\t},\n\t\t\t\tisInline: function()\n\t\t\t\t{\n\t\t\t\t\treturn (!this.build.isTag('TEXTAREA') && !this.build.isTag('DIV') && !this.build.isTag('PRE'));\n\t\t\t\t},\n\t\t\t\tenableEditor: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().attr({ 'contenteditable': true });\n\t\t\t\t},\n\t\t\t\tsetOptions: function()\n\t\t\t\t{\n\t\t\t\t\t// inline\n\t\t\t\t\tif (this.opts.type === 'inline')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.opts.enterKey = false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// inline & pre\n\t\t\t\t\tif (this.opts.type === 'inline' || this.opts.type === 'pre')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.opts.toolbarMobile = false;\n\t\t\t\t\t\tthis.opts.toolbar = false;\n\t\t\t\t\t\tthis.opts.air = false;\n\t\t\t\t\t\tthis.opts.linkify = false;\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// spellcheck\n\t\t\t\t\tthis.core.editor().attr('spellcheck', this.opts.spellcheck);\n\n\t\t\t\t\t// structure\n\t\t\t\t\tif (this.opts.structure)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().addClass('redactor-structure');\n\t\t\t\t\t}\n\n\t\t\t\t\t// options sets only in textarea mode\n\t\t\t\t\tif (this.opts.type !== 'textarea')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// direction\n\t\t\t\t\tthis.core.box().attr('dir', this.opts.direction);\n\t\t\t\t\tthis.core.editor().attr('dir', this.opts.direction);\n\n\t\t\t\t\t// tabindex\n\t\t\t\t\tif (this.opts.tabindex)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().attr('tabindex', this.opts.tabindex);\n\t\t\t\t\t}\n\n\t\t\t\t\t// min height\n\t\t\t\t\tif (this.opts.minHeight)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().css('min-height', this.opts.minHeight);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().css('min-height', '40px');\n\t\t\t\t\t}\n\n\t\t\t\t\t// max height\n\t\t\t\t\tif (this.opts.maxHeight)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().css('max-height', this.opts.maxHeight);\n\t\t\t\t\t}\n\n\t\t\t\t\t// max width\n\t\t\t\t\tif (this.opts.maxWidth)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().css({ 'max-width': this.opts.maxWidth, 'margin': 'auto' });\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tcallEditor: function()\n\t\t\t\t{\n\t\t\t\t\tthis.build.disableBrowsersEditing();\n\n\t\t\t\t\tthis.events.init();\n\t\t\t\t\tthis.build.setHelpers();\n\n\t\t\t\t\t// init buttons\n\t\t\t\t\tif (this.opts.toolbar || this.opts.air)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.toolbarsButtons = this.button.init();\n\t\t\t\t\t}\n\n\t\t\t\t\t// load toolbar\n\t\t\t\t\tif (this.opts.air)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.air.build();\n\t\t\t\t\t}\n\t\t\t\t\telse if (this.opts.toolbar)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.toolbar.build();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.detect.isMobile() && this.opts.toolbarMobile && this.opts.air)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.opts.toolbar = true;\n\t\t\t\t\t\tthis.toolbar.build();\n\t\t\t\t\t}\n\n\t\t\t\t\t// observe dropdowns\n\t\t\t\t\tif (this.opts.air || this.opts.toolbar)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().on('mouseup.redactor-observe.' + this.uuid + ' keyup.redactor-observe.' + this.uuid + ' focus.redactor-observe.' + this.uuid + ' touchstart.redactor-observe.' + this.uuid, $.proxy(this.observe.toolbar, this));\n\t\t\t\t\t\tthis.core.element().on('blur.callback.redactor', $.proxy(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.button.setInactiveAll();\n\n\t\t\t\t\t\t}, this));\n\t\t\t\t\t}\n\n\t\t\t\t\t// modal templates init\n\t\t\t\t\tthis.modal.templates();\n\n\t\t\t\t\t// plugins\n\t\t\t\t\tthis.build.plugins();\n\n\t\t\t\t\t// autosave\n\t\t\t\t\tthis.autosave.init();\n\n\t\t\t\t\t// sync code\n\t\t\t\t\tthis.code.html = this.code.cleaned(this.core.editor().html());\n\n\t\t\t\t\t// init callback\n\t\t\t\t\tthis.core.callback('init');\n\t\t\t\t\tthis.core.callback('initToEdit');\n\n\t\t\t\t\t// get images & files list\n\t\t\t\t\tthis.storage.observe();\n\n\t\t\t\t\t// started\n\t\t\t\t\tthis.start = false;\n\n\t\t\t\t},\n\t\t\t\tsetHelpers: function()\n\t\t\t\t{\n\t\t\t\t\t// linkify\n\t\t\t\t\tif (this.opts.linkify)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.linkify.format();\n\t\t\t\t\t}\n\n\t\t\t\t\t// placeholder\n\t\t\t\t\tthis.placeholder.init();\n\n\t\t\t\t\t// focus\n\t\t\t\t\tif (this.opts.focus)\n\t\t\t\t\t{\n\t\t\t\t\t\tsetTimeout(this.focus.start, 100);\n\t\t\t\t\t}\n\t\t\t\t\telse if (this.opts.focusEnd)\n\t\t\t\t\t{\n\t\t\t\t\t\tsetTimeout(this.focus.end, 100);\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tdisableBrowsersEditing: function()\n\t\t\t\t{\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// FF fix\n\t\t\t\t\t\tdocument.execCommand('enableObjectResizing', false, false);\n\t\t\t\t\t\tdocument.execCommand('enableInlineTableEditing', false, false);\n\t\t\t\t\t\t// IE prevent converting links\n\t\t\t\t\t\tdocument.execCommand(\"AutoUrlDetect\", false, false);\n\t\t\t\t\t} catch (e) {}\n\t\t\t\t},\n\t\t\t\tplugins: function()\n\t\t\t\t{\n\t\t\t\t\tif (!this.opts.plugins)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t$.each(this.opts.plugins, $.proxy(function(i, s)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar func = (typeof RedactorPlugins !== 'undefined' && typeof RedactorPlugins[s] !== 'undefined') ? RedactorPlugins : Redactor.fn;\n\n\t\t\t\t\t\tif (!$.isFunction(func[s]))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis[s] = func[s]();\n\n\t\t\t\t\t\t// get methods\n\t\t\t\t\t\tvar methods = this.getModuleMethods(this[s]);\n\t\t\t\t\t\tvar len = methods.length;\n\n\t\t\t\t\t\t// bind methods\n\t\t\t\t\t\tfor (var z = 0; z < len; z++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis[s][methods[z]] = this[s][methods[z]].bind(this);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// append lang\n\t\t\t\t\t\tif (typeof this[s].langs !== 'undefined')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar lang = {};\n\t\t\t\t\t\t\tif (typeof this[s].langs[this.opts.lang] !== 'undefined')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlang = this[s].langs[this.opts.lang];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if (typeof this[s].langs[this.opts.lang] === 'undefined' && typeof this[s].langs.en !== 'undefined')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlang = this[s].langs.en;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// extend\n\t\t\t\t\t\t\tvar self = this;\n\t\t\t\t\t\t\t$.each(lang, function(i,s)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (typeof self.opts.curLang[i] === 'undefined')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tself.opts.curLang[i] = s;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// init\n\t\t\t\t\t\tif ($.isFunction(this[s].init))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis[s].init();\n\t\t\t\t\t\t}\n\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =button\n\t\tbutton: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\ttoolbar: function()\n\t\t\t\t{\n\t\t\t\t\treturn (typeof this.button.$toolbar === 'undefined' || !this.button.$toolbar) ? this.$toolbar : this.button.$toolbar;\n\t\t\t\t},\n\t\t\t\tinit: function()\n\t\t\t\t{\n\t\t\t\t\treturn {\n\t\t\t\t\t\tformat:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('format'),\n\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\tdropdown:\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tp:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('paragraph'),\n\t\t\t\t\t\t\t\t\tfunc: 'block.format'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tblockquote:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('quote'),\n\t\t\t\t\t\t\t\t\tfunc: 'block.format'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tpre:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('code'),\n\t\t\t\t\t\t\t\t\tfunc: 'block.format'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\th1:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('heading1'),\n\t\t\t\t\t\t\t\t\tfunc: 'block.format'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\th2:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('heading2'),\n\t\t\t\t\t\t\t\t\tfunc: 'block.format'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\th3:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('heading3'),\n\t\t\t\t\t\t\t\t\tfunc: 'block.format'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\th4:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('heading4'),\n\t\t\t\t\t\t\t\t\tfunc: 'block.format'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\th5:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('heading5'),\n\t\t\t\t\t\t\t\t\tfunc: 'block.format'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\th6:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('heading6'),\n\t\t\t\t\t\t\t\t\tfunc: 'block.format'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tbold:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('bold-abbr'),\n\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\tlabel: this.lang.get('bold'),\n\t\t\t\t\t\t\tfunc: 'inline.format'\n\t\t\t\t\t\t},\n\t\t\t\t\t\titalic:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('italic-abbr'),\n\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\tlabel: this.lang.get('italic'),\n\t\t\t\t\t\t\tfunc: 'inline.format'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdeleted:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('deleted-abbr'),\n\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\tlabel: this.lang.get('deleted'),\n\t\t\t\t\t\t\tfunc: 'inline.format'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tunderline:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('underline-abbr'),\n\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\tlabel: this.lang.get('underline'),\n\t\t\t\t\t\t\tfunc: 'inline.format'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tlists:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('lists'),\n\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\tdropdown:\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tunorderedlist:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: '&bull; ' + this.lang.get('unorderedlist'),\n\t\t\t\t\t\t\t\t\tfunc: 'list.toggle'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\torderedlist:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: '1. ' + this.lang.get('orderedlist'),\n\t\t\t\t\t\t\t\t\tfunc: 'list.toggle'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\toutdent:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: '< ' + this.lang.get('outdent'),\n\t\t\t\t\t\t\t\t\tfunc: 'indent.decrease',\n\t\t\t\t\t\t\t\t\tobserve: {\n\t\t\t\t\t\t\t\t\t\telement: 'li',\n\t\t\t\t\t\t\t\t\t\tout: {\n\t\t\t\t\t\t\t\t\t\t\tattr: {\n\t\t\t\t\t\t\t\t\t\t\t\t'class': 'redactor-dropdown-link-inactive',\n\t\t\t\t\t\t\t\t\t\t\t\t'aria-disabled': true\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tindent:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: '> ' + this.lang.get('indent'),\n\t\t\t\t\t\t\t\t\tfunc: 'indent.increase',\n\t\t\t\t\t\t\t\t\tobserve: {\n\t\t\t\t\t\t\t\t\t\telement: 'li',\n\t\t\t\t\t\t\t\t\t\tout: {\n\t\t\t\t\t\t\t\t\t\t\tattr: {\n\t\t\t\t\t\t\t\t\t\t\t\t'class': 'redactor-dropdown-link-inactive',\n\t\t\t\t\t\t\t\t\t\t\t\t'aria-disabled': true\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tul:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: '&bull; ' + this.lang.get('bulletslist'),\n\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\tfunc: 'list.toggle'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tol:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: '1. ' + this.lang.get('numberslist'),\n\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\tfunc: 'list.toggle'\n\t\t\t\t\t\t},\n\t\t\t\t\t\toutdent:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('outdent'),\n\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\tfunc: 'indent.decrease'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tindent:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('indent'),\n\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\tfunc: 'indent.increase'\n\t\t\t\t\t\t},\n\t\t\t\t\t\timage:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('image'),\n\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\tfunc: 'image.show'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfile:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('file'),\n\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\tfunc: 'file.show'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tlink:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('link'),\n\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\tdropdown:\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlink:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('link-insert'),\n\t\t\t\t\t\t\t\t\tfunc: 'link.show',\n\t\t\t\t\t\t\t\t\tobserve: {\n\t\t\t\t\t\t\t\t\t\telement: 'a',\n\t\t\t\t\t\t\t\t\t\t'in': {\n\t\t\t\t\t\t\t\t\t\t\ttitle: this.lang.get('link-edit')\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tout: {\n\t\t\t\t\t\t\t\t\t\t\ttitle: this.lang.get('link-insert')\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tunlink:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('unlink'),\n\t\t\t\t\t\t\t\t\tfunc: 'link.unlink',\n\t\t\t\t\t\t\t\t\tobserve: {\n\t\t\t\t\t\t\t\t\t\telement: 'a',\n\t\t\t\t\t\t\t\t\t\tout: {\n\t\t\t\t\t\t\t\t\t\t\tattr: {\n\t\t\t\t\t\t\t\t\t\t\t\t'class': 'redactor-dropdown-link-inactive',\n\t\t\t\t\t\t\t\t\t\t\t\t'aria-disabled': true\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\thorizontalrule:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('horizontalrule'),\n\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\tfunc: 'line.insert'\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\tsetFormatting: function()\n\t\t\t\t{\n\t\t\t\t\t$.each(this.toolbarsButtons.format.dropdown, $.proxy(function (i, s)\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($.inArray(i, this.opts.formatting) === -1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdelete this.toolbarsButtons.format.dropdown[i];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t},\n\t\t\t\thideButtons: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.buttonsHide.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.button.hideButtonsSlicer(this.opts.buttonsHide);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\thideButtonsOnMobile: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.detect.isMobile() && this.opts.buttonsHideOnMobile.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.button.hideButtonsSlicer(this.opts.buttonsHideOnMobile);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\thideButtonsSlicer: function(buttons)\n\t\t\t\t{\n\t\t\t\t\t$.each(buttons, $.proxy(function(i, s)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar index = this.opts.buttons.indexOf(s);\n\t\t\t\t\t\tif (index !== -1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t    this.opts.buttons.splice(index, 1);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\tload: function($toolbar)\n\t\t\t\t{\n\t\t\t\t\tthis.button.buttons = [];\n\n\t\t\t\t\t$.each(this.opts.buttons, $.proxy(function(i, btnName)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!this.toolbarsButtons[btnName]\n\t\t\t\t\t\t\t|| (btnName === 'file' && !this.file.is())\n\t\t\t\t\t\t\t|| (btnName === 'image' && !this.image.is()))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$toolbar.append($('<li>').append(this.button.build(btnName, this.toolbarsButtons[btnName])));\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\tbuildButtonTooltip: function($btn, title)\n\t\t\t\t{\n    \t\t\t\tif (this.opts.air || this.detect.isMobile())\n    \t\t\t\t{\n        \t\t\t\treturn;\n    \t\t\t\t}\n\n                    var $tooltip = $('<span>');\n\t\t\t\t    $tooltip.addClass('re-button-tooltip');\n\t\t\t\t    $tooltip.html(title);\n\n                    $btn.append($tooltip);\n                    $btn.on('mouseover', function()\n                    {\n                        if ($(this).hasClass('redactor-button-disabled'))\n                        {\n                            return;\n                        }\n\n                        $tooltip.show();\n                        $tooltip.css('margin-left', -($tooltip.innerWidth()/2));\n\n                    }).on('mouseout', function()\n                    {\n                        $tooltip.hide();\n                    });\n\t\t\t\t},\n\t\t\t\tbuild: function(btnName, btnObject)\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.toolbar === false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n                    var title = (typeof btnObject.label !== 'undefined') ? btnObject.label : btnObject.title;\n\t\t\t\t\tvar $button = $('<a href=\"javascript:void(null);\" alt=\"' + title + '\" rel=\"' + btnName + '\" />')\n\n                    $button.addClass('re-button re-' + btnName);\n\t\t\t\t\t$button.attr({ 'role': 'button', 'aria-label': title, 'tabindex': '-1' });\n\n                    if (typeof btnObject.icon !== 'undefined' && !this.opts.buttonsTextLabeled)\n                    {\n    \t\t\t\t\tvar $icon = $('<i>');\n\t\t\t\t\t    $icon.addClass('re-icon-' + btnName);\n\n\t\t\t\t\t    $button.append($icon);\n\t\t\t\t\t    $button.addClass('re-button-icon');\n\n                        this.button.buildButtonTooltip($button, title);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n    \t\t\t\t\t$button.html(btnObject.title);\n\t\t\t\t\t}\n\n\t\t\t\t\t// click\n\t\t\t\t\tif (btnObject.func || btnObject.command || btnObject.dropdown)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.button.setEvent($button, btnName, btnObject);\n\t\t\t\t\t}\n\n\t\t\t\t\t// dropdown\n\t\t\t\t\tif (btnObject.dropdown)\n\t\t\t\t\t{\n\t\t\t\t\t\t$button.addClass('redactor-toolbar-link-dropdown').attr('aria-haspopup', true);\n\n\t\t\t\t\t\tvar $dropdown = $('<ul class=\"redactor-dropdown redactor-dropdown-' + this.uuid + ' redactor-dropdown-box-' + btnName + '\" style=\"display: none;\">');\n\t\t\t\t\t\t$button.data('dropdown', $dropdown);\n\t\t\t\t\t\tthis.dropdown.build(btnName, $dropdown, btnObject.dropdown);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.button.buttons.push($button);\n\n\t\t\t\t\treturn $button;\n\t\t\t\t},\n\t\t\t\tgetButtons: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.button.toolbar().find('a.re-button');\n\t\t\t\t},\n\t\t\t\tgetButtonsKeys: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.button.buttons;\n\t\t\t\t},\n\t\t\t\tsetEvent: function($button, btnName, btnObject)\n\t\t\t\t{\n\t\t\t\t\t$button.on('mousedown', $.proxy(function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\tif ($button.hasClass('redactor-button-disabled'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar type = 'func';\n\t\t\t\t\t\tvar callback = btnObject.func;\n\n\t\t\t\t\t\tif (btnObject.command)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype = 'command';\n\t\t\t\t\t\t\tcallback = btnObject.command;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (btnObject.dropdown)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype = 'dropdown';\n\t\t\t\t\t\t\tcallback = false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.button.toggle(e, btnName, type, callback);\n\n\t\t\t\t\t\treturn false;\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\ttoggle: function(e, btnName, type, callback, args)\n\t\t\t\t{\n\n\t\t\t\t\tif (this.detect.isIe() || !this.detect.isDesktop())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.utils.freezeScroll();\n\t\t\t\t\t\te.returnValue = false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (type === 'command')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.inline.format(callback);\n\t\t\t\t\t}\n\t\t\t\t\telse if (type === 'dropdown')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.dropdown.show(e, btnName);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.button.clickCallback(e, callback, btnName, args);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (type !== 'dropdown')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.dropdown.hideAll(false);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.opts.air && type !== 'dropdown')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.air.hide(e);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.detect.isIe() || !this.detect.isDesktop())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.utils.unfreezeScroll();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tclickCallback: function(e, callback, btnName, args)\n\t\t\t\t{\n\t\t\t\t\tvar func;\n\n\t\t\t\t\targs = (typeof args === 'undefined') ? btnName : args;\n\n\t\t\t\t\tif ($.isFunction(callback))\n\t\t\t\t\t{\n\t\t\t\t\t\tcallback.call(this, btnName);\n\t\t\t\t\t}\n\t\t\t\t\telse if (callback.search(/\\./) !== '-1')\n\t\t\t\t\t{\n\t\t\t\t\t\tfunc = callback.split('.');\n\t\t\t\t\t\tif (typeof this[func[0]] === 'undefined')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (typeof args === 'object')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis[func[0]][func[1]].apply(this, args);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis[func[0]][func[1]].call(this, args);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\n\t\t\t\t\t\tif (typeof args === 'object')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis[callback].apply(this, args);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis[callback].call(this, args);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.observe.buttons(e, btnName);\n\n\t\t\t\t},\n\t\t\t\tall: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.button.buttons;\n\t\t\t\t},\n\t\t\t\tget: function(key)\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.toolbar === false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this.button.toolbar().find('a.re-' + key);\n\t\t\t\t},\n\t\t\t\tset: function(key, title)\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.toolbar === false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $btn = this.button.toolbar().find('a.re-' + key);\n\n\t\t\t\t\t$btn.html(title).attr('aria-label', title);\n\n\t\t\t\t\treturn $btn;\n\t\t\t\t},\n\t\t\t\tadd: function(key, title)\n\t\t\t\t{\n\t\t\t\t\tif (this.button.isAdded(key) !== true)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn $();\n\t\t\t\t\t}\n\n\t\t\t\t\tvar btn = this.button.build(key, { title: title });\n\n\t\t\t\t\tthis.button.toolbar().append($('<li>').append(btn));\n\n\t\t\t\t\treturn btn;\n\t\t\t\t},\n\t\t\t\taddFirst: function(key, title)\n\t\t\t\t{\n\t\t\t\t\tif (this.button.isAdded(key) !== true)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn $();\n\t\t\t\t\t}\n\n\t\t\t\t\tvar btn = this.button.build(key, { title: title });\n\n\t\t\t\t\tthis.button.toolbar().prepend($('<li>').append(btn));\n\n\t\t\t\t\treturn btn;\n\t\t\t\t},\n\t\t\t\taddAfter: function(afterkey, key, title)\n\t\t\t\t{\n\t\t\t\t\tif (this.button.isAdded(key) !== true)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn $();\n\t\t\t\t\t}\n\n\t\t\t\t\tvar btn = this.button.build(key, { title: title });\n\t\t\t\t\tvar $btn = this.button.get(afterkey);\n\n\t\t\t\t\tif ($btn.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t$btn.parent().after($('<li>').append(btn));\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.button.toolbar().append($('<li>').append(btn));\n\t\t\t\t\t}\n\n\t\t\t\t\treturn btn;\n\t\t\t\t},\n\t\t\t\taddBefore: function(beforekey, key, title)\n\t\t\t\t{\n\t\t\t\t\tif (this.button.isAdded(key) !== true)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn $();\n\t\t\t\t\t}\n\n\t\t\t\t\tvar btn = this.button.build(key, { title: title });\n\t\t\t\t\tvar $btn = this.button.get(beforekey);\n\n\t\t\t\t\tif ($btn.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t$btn.parent().before($('<li>').append(btn));\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.button.toolbar().append($('<li>').append(btn));\n\t\t\t\t\t}\n\n\t\t\t\t\treturn btn;\n\t\t\t\t},\n\t\t\t\tisAdded: function(key)\n\t\t\t\t{\n\t                var index = this.opts.buttonsHideOnMobile.indexOf(key);\n                    if (this.opts.toolbar === false || (index !== -1 && this.detect.isMobile()))\n                    {\n\t\t\t\t\t    return false;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t\tsetIcon: function($btn, icon)\n\t\t\t\t{\n    \t\t\t\tif (!this.opts.buttonsTextLabeled)\n    \t\t\t\t{\n    \t\t\t\t\t$btn.html(icon).addClass('re-button-icon');\n\t\t\t\t\t    this.button.buildButtonTooltip($btn, $btn.attr('alt'));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tchangeIcon: function(key, newIconClass)\n\t\t\t\t{\n                    var $btn = this.button.get(key);\n                    if ($btn.length !== 0)\n\t\t\t\t\t{\n    \t\t\t\t\t$btn.find('i').removeAttr('class').addClass('re-icon-' + newIconClass);\n    \t\t\t\t}\n\t\t\t\t},\n\t\t\t\taddCallback: function($btn, callback)\n\t\t\t\t{\n\t\t\t\t\tif (typeof $btn === 'undefined' || this.opts.toolbar === false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar type = (callback === 'dropdown') ? 'dropdown' : 'func';\n\t\t\t\t\tvar key = $btn.attr('rel');\n\t\t\t\t\t$btn.on('mousedown', $.proxy(function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($btn.hasClass('redactor-button-disabled'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.button.toggle(e, key, type, callback);\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\taddDropdown: function($btn, dropdown)\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.toolbar === false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t$btn.addClass('redactor-toolbar-link-dropdown').attr('aria-haspopup', true);\n\n\t\t\t\t\tvar key = $btn.attr('rel');\n\t\t\t\t\tthis.button.addCallback($btn, 'dropdown');\n\n\t\t\t\t\tvar $dropdown = $('<div class=\"redactor-dropdown redactor-dropdown-' + this.uuid + ' redactor-dropdown-box-' + key + '\" style=\"display: none;\">');\n\t\t\t\t\t$btn.data('dropdown', $dropdown);\n\n\t\t\t\t\t// build dropdown\n\t\t\t\t\tif (dropdown)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.dropdown.build(key, $dropdown, dropdown);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn $dropdown;\n\t\t\t\t},\n\t\t\t\tsetActive: function(key)\n\t\t\t\t{\n\t\t\t\t\tthis.button.get(key).addClass('redactor-act');\n\t\t\t\t},\n\t\t\t\tsetInactive: function(key)\n\t\t\t\t{\n\t\t\t\t\tthis.button.get(key).removeClass('redactor-act');\n\t\t\t\t},\n\t\t\t\tsetInactiveAll: function(key)\n\t\t\t\t{\n\t\t\t\t\tvar $btns = this.button.toolbar().find('a.re-button');\n\n\t\t\t\t\tif (typeof key !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\t$btns = $btns.not('.re-' + key);\n\t\t\t\t\t}\n\n\t\t\t\t\t$btns.removeClass('redactor-act');\n\t\t\t\t},\n\t\t\t\tdisable: function(key)\n\t\t\t\t{\n\t\t\t\t\tthis.button.get(key).addClass('redactor-button-disabled');\n\t\t\t\t},\n\t\t\t\tenable: function(key)\n\t\t\t\t{\n\t\t\t\t\tthis.button.get(key).removeClass('redactor-button-disabled');\n\t\t\t\t},\n\t\t\t\tdisableAll: function(key)\n\t\t\t\t{\n\t\t\t\t\tvar $btns = this.button.toolbar().find('a.re-button');\n\t\t\t\t\tif (typeof key !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\t$btns = $btns.not('.re-' + key);\n\t\t\t\t\t}\n\n\t\t\t\t\t$btns.addClass('redactor-button-disabled');\n\t\t\t\t},\n\t\t\t\tenableAll: function()\n\t\t\t\t{\n\t\t\t\t\tthis.button.toolbar().find('a.re-button').removeClass('redactor-button-disabled');\n\t\t\t\t},\n\t\t\t\tremove: function(key)\n\t\t\t\t{\n\t\t\t\t\tthis.button.get(key).remove();\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =caret\n\t\tcaret: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tset: function(node1, node2, end)\n\t\t\t\t{\n                    var cs = this.core.editor().scrollTop();\n                    this.core.editor().focus();\n                    this.core.editor().scrollTop(cs);\n\n\t\t\t\t\tend = (typeof end === 'undefined') ? 0 : 1;\n\n\t\t\t\t\tnode1 = node1[0] || node1;\n\t\t\t\t\tnode2 = node2[0] || node2;\n\n\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\tvar range = this.selection.range(sel);\n\n\t\t\t\t\ttry\n\t\t\t\t\t{\n\t\t\t\t\t\trange.setStart(node1, 0);\n\t\t\t\t\t\trange.setEnd(node2, end);\n\t\t\t\t\t}\n\t\t\t\t\tcatch (e) {}\n\n\t\t\t\t\tthis.selection.update(sel, range);\n\t\t\t\t},\n\t\t\t\tprepare: function(node)\n\t\t\t\t{\n\t\t\t\t\t// firefox focus\n\t\t\t\t\tif (this.detect.isFirefox() && typeof this.start !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().focus();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn node[0] || node;\n\t\t\t\t},\n\t\t\t\tstart: function(node)\n\t\t\t\t{\n\t\t\t\t\tvar sel, range;\n\t\t\t\t\tnode = this.caret.prepare(node);\n\n\t\t\t\t\tif (!node)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (node.tagName === 'BR')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.caret.before(node);\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $first = $(node).children().first();\n\n\t\t\t\t\t// empty or inline tag\n\t\t\t\t\tvar inline = this.utils.isInlineTag(node.tagName);\n\t\t\t\t\tif (node.innerHTML === '' || inline)\n\t\t\t\t\t{\n                        this.caret.setStartEmptyOrInline(node, inline);\n\t\t\t\t\t}\n\t\t\t\t\t// empty inline inside\n                    else if ($first && $first.length !== 0 && this.utils.isInlineTag($first[0].tagName) && $first.text() === '')\n                    {\n                       this.caret.setStartEmptyOrInline($first[0], true);\n                    }\n                    // block tag\n\t\t\t\t\telse\n\t\t\t\t\t{\n                        sel = window.getSelection();\n                        sel.removeAllRanges();\n\n                        range = document.createRange();\n                        range.selectNodeContents(node);\n                        range.collapse(true);\n                        sel.addRange(range);\n\t\t\t\t\t}\n\n\n\t\t\t\t},\n\t\t\t\tsetStartEmptyOrInline: function(node, inline)\n\t\t\t\t{\n                    var sel = window.getSelection();\n\t\t\t\t    var range = document.createRange();\n\t\t\t\t\tvar textNode = document.createTextNode('\\u200B');\n\n\t\t\t\t\trange.setStart(node, 0);\n\t\t\t\t\trange.insertNode(textNode);\n\t\t\t\t\trange.setStartAfter(textNode);\n\t\t\t\t\trange.collapse(true);\n\n\t\t\t\t\tsel.removeAllRanges();\n\t\t\t\t\tsel.addRange(range);\n\n\t\t\t\t\t// remove invisible text node\n\t\t\t\t\tif (!inline)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().on('keydown.redactor-remove-textnode', function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(textNode).remove();\n\t\t\t\t\t\t\t$(this).off('keydown.redactor-remove-textnode');\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tend: function(node)\n\t\t\t\t{\n\t\t\t\t\tvar sel, range;\n\t\t\t\t\tnode = this.caret.prepare(node);\n\n\t\t\t\t\tif (!node)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// empty node\n\t\t\t\t\tif (node.tagName !== 'BR' && node.innerHTML === '')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.caret.start(node);\n\t\t\t\t\t}\n\n\t\t\t\t\t// br\n\t\t\t\t\tif (node.tagName === 'BR')\n\t\t\t\t\t{\n\t\t\t\t\t\tvar space = document.createElement('span');\n\t\t\t\t\t\tspace.className = 'redactor-invisible-space';\n\t\t\t\t\t\tspace.innerHTML = '&#x200b;';\n\n\t\t\t\t\t\t$(node).after(space);\n\n\t\t\t\t\t\tsel = window.getSelection();\n\t\t\t\t\t\tsel.removeAllRanges();\n\n\t\t\t\t\t\trange = document.createRange();\n\n\t\t\t\t\t\trange.setStartBefore(space);\n\t\t\t\t\t\trange.setEndBefore(space);\n\t\t\t\t\t\tsel.addRange(range);\n\n\t\t\t\t\t\t$(space).replaceWith(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn $(this).contents();\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (node.lastChild && node.lastChild.nodeType === 1)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.caret.after(node.lastChild);\n\t\t\t\t\t}\n\n                    var sel = window.getSelection();\n                    if (sel.getRangeAt || sel.rangeCount)\n                    {\n                        try {\n                            var range = sel.getRangeAt(0);\n                            range.selectNodeContents(node);\n                            range.collapse(false);\n\n                            sel.removeAllRanges();\n                            sel.addRange(range);\n                        }\n                        catch(e) {}\n                    }\n\t\t\t\t},\n\t\t\t\tafter: function(node)\n\t\t\t\t{\n\t\t\t\t\tvar sel, range;\n\t\t\t\t\tnode = this.caret.prepare(node);\n\n\n\t\t\t\t\tif (!node)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (node.tagName === 'BR')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.caret.end(node);\n\t\t\t\t\t}\n\n\t\t\t\t\t// block tag\n\t\t\t\t\tif (this.utils.isBlockTag(node.tagName))\n\t\t\t\t\t{\n\t\t\t\t\t\tvar next = this.caret.next(node);\n\n\t\t\t\t\t\tif (typeof next === 'undefined')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.caret.end(node);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t// table\n\t\t\t\t\t\t\tif (next.tagName === 'TABLE')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tnext = $(next).find('th, td').first()[0];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// list\n\t\t\t\t\t\t\telse if (next.tagName === 'UL' || next.tagName === 'OL')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tnext = $(next).find('li').first()[0];\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.caret.start(next);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// inline tag\n\t\t\t\t\tvar textNode = document.createTextNode('\\u200B');\n\n\t\t\t\t\tsel = window.getSelection();\n\t\t\t\t\tsel.removeAllRanges();\n\n\t\t\t\t\trange = document.createRange();\n\t\t\t\t\trange.setStartAfter(node);\n\t\t\t\t\trange.insertNode(textNode);\n\t\t\t\t\trange.setStartAfter(textNode);\n\t\t\t\t\trange.collapse(true);\n\n\t\t\t\t\tsel.addRange(range);\n\n\t\t\t\t},\n\t\t\t\tbefore: function(node)\n\t\t\t\t{\n\t\t\t\t\tvar sel, range;\n\t\t\t\t\tnode = this.caret.prepare(node);\n\n\n\t\t\t\t\tif (!node)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// block tag\n\t\t\t\t\tif (this.utils.isBlockTag(node.tagName))\n\t\t\t\t\t{\n\t\t\t\t\t\tvar prev = this.caret.prev(node);\n\n\t\t\t\t\t\tif (typeof prev === 'undefined')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.caret.start(node);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t// table\n\t\t\t\t\t\t\tif (prev.tagName === 'TABLE')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tprev = $(prev).find('th, td').last()[0];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// list\n\t\t\t\t\t\t\telse if (prev.tagName === 'UL' || prev.tagName === 'OL')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tprev = $(prev).find('li').last()[0];\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.caret.end(prev);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// inline tag\n\t\t\t\t\tsel = window.getSelection();\n\t\t\t\t\tsel.removeAllRanges();\n\n\t\t\t\t\trange = document.createRange();\n\n\t\t\t        range.setStartBefore(node);\n\t\t\t        range.collapse(true);\n\n\t\t\t        sel.addRange(range);\n\t\t\t\t},\n\t\t\t\tnext: function(node)\n\t\t\t\t{\n\t\t\t\t\tvar $next = $(node).next();\n\t\t\t\t\tif ($next.hasClass('redactor-script-tag, redactor-selection-marker'))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn $next.next()[0];\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\treturn $next[0];\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tprev: function(node)\n\t\t\t\t{\n\t\t\t\t\tvar $prev = $(node).prev();\n\t\t\t\t\tif ($prev.hasClass('redactor-script-tag, redactor-selection-marker'))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn $prev.prev()[0];\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\treturn $prev[0];\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\t// #backward\n\t\t\t\toffset: function(node)\n\t\t\t\t{\n\t\t\t\t\treturn this.offset.get(node);\n\t\t\t\t}\n\n\t\t\t};\n\t\t},\n\n\t\t// =clean\n\t\tclean: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tonSet: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = this.clean.savePreCode(html);\n\t\t\t\t\thtml = this.clean.saveFormTags(html);\n\n\t\t\t\t\t// convert script tag\n\t\t\t\t\tif (this.opts.script)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(/<script(.*?[^>]?)>([\\w\\W]*?)<\\/script>/gi, '<pre class=\"redactor-script-tag\" $1>$2</pre>');\n\t\t\t\t\t}\n\n\t\t\t\t\t// converting entity\n\t\t\t\t\thtml = html.replace(/\\$/g, '&#36;');\n\t\t\t\t\thtml = html.replace(/&amp;/g, '&');\n\n\t\t\t\t\t// replace special characters in links\n\t\t\t\t\thtml = html.replace(/<a href=\"(.*?[^>]?)®(.*?[^>]?)\">/gi, '<a href=\"$1&reg$2\">');\n\n\t\t\t\t\t// save markers\n\t\t\t\t\thtml = html.replace(/<span id=\"selection-marker-1\"(.*?[^>]?)>​<\\/span>/gi, '###marker1###');\n\t\t\t\t\thtml = html.replace(/<span id=\"selection-marker-2\"(.*?[^>]?)>​<\\/span>/gi, '###marker2###');\n\n\t\t\t\t\t// replace tags\n\t\t\t\t\tvar self = this;\n\t\t\t\t\tvar $div = $(\"<div/>\").html($.parseHTML(html, document, true));\n\n\t\t\t\t\tvar replacement = this.opts.replaceTags;\n\t\t\t\t\tif (replacement)\n\t\t\t\t\t{\n                        var keys = Object.keys(this.opts.replaceTags);\n    \t\t\t\t\t$div.find(keys.join(',')).each(function(i,s)\n    \t\t\t\t\t{\n    \t\t\t\t\t\tself.utils.replaceToTag(s, replacement[s.tagName.toLowerCase()]);\n    \t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\t// add span marker\n\t\t\t\t\t$div.find('span, a').attr('data-redactor-span', true);\n\n\t\t\t\t\t// add style cache\n\t\t\t\t\t$div.find(this.opts.inlineTags.join(',')).each(function()\n\t\t\t\t\t{\n    \t\t\t\t\t// add style cache\n    \t\t\t\t\tvar $el = $(this);\n\n    \t\t\t\t\tif ($el.attr('style'))\n    \t\t\t\t\t{\n        \t\t\t\t\t$el.attr('data-redactor-style-cache', $el.attr('style'));\n    \t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\thtml = $div.html();\n\n\t\t\t\t\t// remove tags\n\t\t\t\t\tvar tags = ['font', 'html', 'head', 'link', 'body', 'meta', 'applet'];\n\t\t\t\t\tif (!this.opts.script)\n\t\t\t\t\t{\n\t\t\t\t\t\ttags.push('script');\n\t\t\t\t\t}\n\n\t\t\t\t\thtml = this.clean.stripTags(html, tags);\n\n\t\t\t\t\t// remove html comments\n\t\t\t\t\tif (this.opts.removeComments)\n\t\t\t\t\t{\n\t\t\t\t\t    html = html.replace(/<!--[\\s\\S]*?-->/gi, '');\n\t\t\t\t\t}\n\n\t\t\t\t\t// paragraphize\n\t\t\t\t\thtml = this.paragraphize.load(html);\n\n\t\t\t\t\t// restore markers\n\t\t\t\t\thtml = html.replace('###marker1###', '<span id=\"selection-marker-1\" class=\"redactor-selection-marker\">​</span>');\n\t\t\t\t\thtml = html.replace('###marker2###', '<span id=\"selection-marker-2\" class=\"redactor-selection-marker\">​</span>');\n\n\t\t\t\t\t// empty\n\t\t\t\t\tif (html.search(/^(||\\s||<br\\s?\\/?>||&nbsp;)$/i) !== -1)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.opts.emptyHtml;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tonGet: function(html)\n\t\t\t\t{\n\t\t\t\t\treturn this.clean.onSync(html);\n\t\t\t\t},\n\t\t\t\tonSync: function(html)\n\t\t\t\t{\n\t\t\t\t\t// remove invisible spaces\n\t\t\t\t\thtml = html.replace(/\\u200B/g, '');\n\t\t\t\t\thtml = html.replace(/&#x200b;/gi, '');\n\t\t\t\t\t//html = html.replace(/&nbsp;&nbsp;/gi, '&nbsp;');\n\n\t\t\t\t\tif (html.search(/^<p>(||\\s||<br\\s?\\/?>||&nbsp;)<\\/p>$/i) !== -1)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn '';\n\t\t\t\t\t}\n\n\t\t\t\t\t// remove image resize\n\t\t\t\t\thtml = html.replace(/<span(.*?)id=\"redactor-image-box\"(.*?[^>])>([\\w\\W]*?)<img(.*?)><\\/span>/gi, '$3<img$4>');\n\t\t\t\t\thtml = html.replace(/<span(.*?)id=\"redactor-image-resizer\"(.*?[^>])>(.*?)<\\/span>/gi, '');\n\t\t\t\t\thtml = html.replace(/<span(.*?)id=\"redactor-image-editter\"(.*?[^>])>(.*?)<\\/span>/gi, '');\n\t\t\t\t\thtml = html.replace(/<img(.*?)style=\"(.*?)opacity: 0\\.5;(.*?)\"(.*?)>/gi, '<img$1style=\"$2$3\"$4>');\n\n\t\t\t\t\tvar $div = $(\"<div/>\").html($.parseHTML(html, document, true));\n\n\t\t\t\t\t// remove empty atributes\n\t\t\t\t\t$div.find('*[style=\"\"]').removeAttr('style');\n\t\t\t\t\t$div.find('*[class=\"\"]').removeAttr('class');\n\t\t\t\t\t$div.find('*[rel=\"\"]').removeAttr('rel');\n\t\t\t\t\t$div.find('*[data-image=\"\"]').removeAttr('data-image');\n\t\t\t\t\t$div.find('*[alt=\"\"]').removeAttr('alt');\n\t\t\t\t\t$div.find('*[title=\"\"]').removeAttr('title');\n\t\t\t\t\t$div.find('*[data-redactor-style-cache]').removeAttr('data-redactor-style-cache');\n\n\t\t\t\t\t// remove markers\n\t\t\t\t\t$div.find('.redactor-invisible-space, .redactor-unlink').each(function()\n\t\t\t\t\t{\n\t\t\t\t\t\t$(this).contents().unwrap();\n\t\t\t\t\t});\n\n\t\t\t\t\t// remove span without attributes & span marker\n\t\t\t\t    $div.find('span, a').removeAttr('data-redactor-span data-redactor-style-cache').each(function()\n\t\t\t\t\t{\n    \t\t\t\t\tif (this.attributes.length === 0)\n    \t\t\t\t\t{\n\t\t\t\t\t\t    $(this).contents().unwrap();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t// remove rel attribute from img\n\t\t\t\t\t$div.find('img').removeAttr('rel');\n\n\t\t\t\t\t$div.find('.redactor-selection-marker, #redactor-insert-marker').remove();\n\n\t\t\t\t\thtml = $div.html();\n\n\t\t\t\t\t// reconvert script tag\n\t\t\t\t\tif (this.opts.script)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(/<pre class=\"redactor-script-tag\"(.*?[^>]?)>([\\w\\W]*?)<\\/pre>/gi, '<script$1>$2</script>');\n\t\t\t\t\t}\n\n\t\t\t\t\t// restore form tag\n\t\t\t\t\thtml = this.clean.restoreFormTags(html);\n\n\t\t\t\t\t// remove br in|of li/header tags\n\t\t\t\t\thtml = html.replace(new RegExp('<br\\\\s?/?></h', 'gi'), '</h');\n\t\t\t\t\thtml = html.replace(new RegExp('<br\\\\s?/?></li>', 'gi'), '</li>');\n\t\t\t\t\thtml = html.replace(new RegExp('</li><br\\\\s?/?>', 'gi'), '</li>');\n\n\t\t\t\t\t// pre class\n\t\t\t\t\thtml = html.replace(/<pre>/gi, \"<pre>\\n\");\n\t\t\t\t\tif (this.opts.preClass)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(/<pre>/gi, '<pre class=\"' + this.opts.preClass + '\">');\n\t\t\t\t\t}\n\n\t\t\t\t\t// link nofollow\n\t\t\t\t\tif (this.opts.linkNofollow)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(/<a(.*?)rel=\"nofollow\"(.*?[^>])>/gi, '<a$1$2>');\n\t\t\t\t\t\thtml = html.replace(/<a(.*?[^>])>/gi, '<a$1 rel=\"nofollow\">');\n\t\t\t\t\t}\n\n\t\t\t\t\t// replace special characters\n\t\t\t\t\tvar chars = {\n\t\t\t\t\t\t'\\u2122': '&trade;',\n\t\t\t\t\t\t'\\u00a9': '&copy;',\n\t\t\t\t\t\t'\\u2026': '&hellip;',\n\t\t\t\t\t\t'\\u2014': '&mdash;',\n\t\t\t\t\t\t'\\u2010': '&dash;'\n\t\t\t\t\t};\n\n\t\t\t\t\t$.each(chars, function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(new RegExp(i, 'g'), s);\n\t\t\t\t\t});\n\n\t\t\t\t\thtml = html.replace(/&amp;/g, '&');\n\n\t\t\t\t\t// remove empty paragpraphs\n\t\t\t\t\t//html = html.replace(/<p><\\/p>/gi, \"\");\n\n\t\t\t\t\t// remove new lines\n                    html = html.replace(/\\n{2,}/g, \"\\n\");\n\n                    // remove all newlines\n                    if (this.opts.removeNewlines)\n                    {\n                        html = html.replace(/\\r?\\n/g, \"\");\n                    }\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tonPaste: function(html, data, insert)\n\t\t\t\t{\n\t\t\t\t\t// if paste event\n\t\t\t\t\tif (insert !== true)\n\t\t\t\t\t{\n    \t\t\t\t\t// remove google docs markers\n                        html = html.replace(/<b\\sid=\"internal-source-marker(.*?)\">([\\w\\W]*?)<\\/b>/gi, \"$2\");\n    \t\t\t\t\thtml = html.replace(/<b(.*?)id=\"docs-internal-guid(.*?)\">([\\w\\W]*?)<\\/b>/gi, \"$3\");\n\n                        // google docs styles\n                        html = html.replace(/<span[^>]*(font-style: italic; font-weight: bold|font-weight: bold; font-style: italic)[^>]*>([\\w\\W]*?)<\\/span>/gi, '<b><i>$2</i></b>');\n                        html = html.replace(/<span[^>]*(font-style: italic; font-weight: 700|font-weight: 700; font-style: italic)[^>]*>([\\w\\W]*?)<\\/span>/gi, '<b><i>$2</i></b>');\n                        html = html.replace(/<span[^>]*font-style: italic[^>]*>([\\w\\W]*?)<\\/span>/gi, '<i>$1</i>');\n                        html = html.replace(/<span[^>]*font-weight: bold[^>]*>([\\w\\W]*?)<\\/span>/gi, '<b>$1</b>');\n                        html = html.replace(/<span[^>]*font-weight: 700[^>]*>([\\w\\W]*?)<\\/span>/gi, '<b>$1</b>');\n\n                        // op tag\n                        html = html.replace(/<o:p[^>]*>/gi, '');\n                        html = html.replace(/<\\/o:p>/gi, '');\n\n\t\t\t\t\t\tvar msword = this.clean.isHtmlMsWord(html);\n\t\t\t\t\t\tif (msword)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\thtml = this.clean.cleanMsWord(html);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\thtml = $.trim(html);\n\n\t\t\t\t\tif (data.pre)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.opts.preSpaces)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\thtml = html.replace(/\\t/g, new Array(this.opts.preSpaces + 1).join(' '));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\n\t\t\t\t\t\thtml = this.clean.replaceBrToNl(html);\n\t\t\t\t\t\thtml = this.clean.removeTagsInsidePre(html);\n\t\t\t\t\t}\n\n\t\t\t\t\t// if paste event\n\t\t\t\t\tif (insert !== true)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = this.clean.removeEmptyInlineTags(html);\n\n\t\t\t\t\t\tif (data.encode === false)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\thtml = html.replace(/&/g, '&amp;');\n\t\t\t\t\t\t\thtml = this.clean.convertTags(html, data);\n\t\t\t\t\t\t\thtml = this.clean.getPlainText(html);\n\t\t\t\t\t\t\thtml = this.clean.reconvertTags(html, data);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif (data.text)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = this.clean.replaceNbspToSpaces(html);\n\t\t\t\t\t\thtml = this.clean.getPlainText(html);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (data.lists)\n\t\t\t\t\t{\n    \t\t\t\t\thtml = html.replace(\"\\n\", '<br>');\n    \t\t\t\t}\n\n\t\t\t\t\tif (data.encode)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = this.clean.encodeHtml(html);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (data.paragraphize)\n\t\t\t\t\t{\n    \t\t\t\t\t// ff bugfix\n                        html = html.replace(/ \\n/g, ' ');\n                        html = html.replace(/\\n /g, ' ');\n\n\t\t\t\t\t\thtml = this.paragraphize.load(html);\n\n\t\t\t\t\t\t// remove empty p\n\t\t\t\t\t\thtml = html.replace(/<p><\\/p>/g, '');\n\t\t\t\t\t}\n\n\t\t\t\t\treturn html;\n\n\t\t\t\t},\n\t\t\t\tgetCurrentType: function(html, insert)\n\t\t\t\t{\n\t\t\t\t\tvar blocks = this.selection.blocks();\n\n\t\t\t\t\tvar data = {\n\t\t\t\t\t\ttext: false,\n\t\t\t\t\t\tencode: false,\n\t\t\t\t\t\tparagraphize: true,\n\t\t\t\t\t\tline: this.clean.isHtmlLine(html),\n\t\t\t\t\t\tblocks: this.clean.isHtmlBlocked(html),\n\t\t\t\t\t\tpre: false,\n\t\t\t\t\t\tlists: false,\n\t\t\t\t\t\tblock: true,\n\t\t\t\t\t\tinline: true,\n\t\t\t\t\t\tlinks: true,\n\t\t\t\t\t\timages: true\n\t\t\t\t\t};\n\n\t\t\t\t\tif (blocks.length === 1 && this.utils.isCurrentOrParent(['h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'a', 'figcaption']))\n\t\t\t\t\t{\n\t\t\t\t\t\tdata.text = true;\n\t\t\t\t\t\tdata.paragraphize = false;\n\t\t\t\t\t\tdata.inline = false;\n\t\t\t\t\t\tdata.images = false;\n\t\t\t\t\t\tdata.links = false;\n\t\t\t\t\t\tdata.line = true;\n\t\t\t\t\t}\n\t\t\t\t\telse if (this.opts.type === 'inline' || this.opts.enterKey === false)\n\t\t\t\t\t{\n\t\t\t\t\t\tdata.paragraphize = false;\n\t\t\t\t\t\tdata.block = false;\n\t\t\t\t\t\tdata.line = true;\n\t\t\t\t\t}\n\t\t\t\t\telse if (blocks.length === 1 && this.utils.isCurrentOrParent(['li']))\n\t\t\t\t\t{\n\t\t\t\t\t\tdata.lists = true;\n\t\t\t\t\t\tdata.block = false;\n\t\t\t\t\t\tdata.paragraphize = false;\n\t\t\t\t\t\tdata.images = false;\n\t\t\t\t\t}\n\t\t\t\t\telse if (blocks.length === 1 && this.utils.isCurrentOrParent(['th', 'td', 'blockquote']))\n\t\t\t\t\t{\n\t\t\t\t\t\tdata.block = false;\n\t\t\t\t\t\tdata.paragraphize = false;\n\n\t\t\t\t\t}\n\t\t\t\t\telse if (this.opts.type === 'pre' || (blocks.length === 1 && this.utils.isCurrentOrParent('pre')))\n\t\t\t\t\t{\n\t\t\t\t\t\tdata.inline = false;\n\t\t\t\t\t\tdata.block = false;\n\t\t\t\t\t\tdata.encode = true;\n\t\t\t\t\t\tdata.pre = true;\n\t\t\t\t\t\tdata.paragraphize = false;\n\t\t\t\t\t\tdata.images = false;\n\t\t\t\t\t\tdata.links = false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (data.line === true)\n\t\t\t\t\t{\n\t\t\t\t\t\tdata.paragraphize = false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (insert === true)\n\t\t\t\t\t{\n\t\t\t\t\t\tdata.text = false;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn data;\n\n\t\t\t\t},\n\t\t\t\tisHtmlBlocked: function(html)\n\t\t\t\t{\n\t\t\t\t\tvar match1 = html.match(new RegExp('</(' + this.opts.blockTags.join('|' ).toUpperCase() + ')>', 'gi'));\n\t\t\t\t\tvar match2 = html.match(new RegExp('<hr(.*?[^>])>', 'gi'));\n\n\t\t\t\t\treturn (match1 === null && match2 === null) ? false : true;\n\t\t\t\t},\n\t\t\t\tisHtmlLine: function(html)\n\t\t\t\t{\n\t\t\t\t\tif (this.clean.isHtmlBlocked(html))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar matchBR = html.match(/<br\\s?\\/?>/gi);\n\t\t\t\t\tvar matchNL = html.match(/\\n/gi);\n\n\t\t\t\t\treturn (!matchBR && !matchNL) ? true : false;\n\t\t\t\t},\n\t\t\t\tisHtmlMsWord: function(html)\n\t\t\t\t{\n\t\t\t\t\treturn html.match(/class=\"?Mso|style=\"[^\"]*\\bmso-|style='[^'']*\\bmso-|w:WordDocument/i);\n\t\t\t\t},\n\t\t\t\tremoveEmptyInlineTags: function(html)\n\t\t\t\t{\n\t\t\t\t\tvar tags = this.opts.inlineTags;\n    \t\t\t\tvar $div = $(\"<div/>\").html($.parseHTML(html, document, true));\n                    var self = this;\n\n\t\t\t\t\tvar $spans = $div.find('span');\n\t\t\t\t\tvar $tags = $div.find(tags.join(','));\n\n\t\t\t\t\t$tags.removeAttr('style');\n\n\t\t\t\t\t$tags.each(function()\n\t\t\t\t\t{\n    \t\t\t\t\tvar tagHtml = $(this).html();\n    \t\t\t\t\tif (this.attributes.length === 0 && self.utils.isEmpty(tagHtml))\n    \t\t\t\t\t{\n        \t\t\t\t\t$(this).replaceWith(function()\n        \t\t\t\t\t{\n        \t\t\t\t\t\treturn $(this).contents();\n        \t\t\t\t\t});\n    \t\t\t\t\t}\n\t\t\t\t\t});\n\n                    $spans.each(function()\n\t\t\t\t\t{\n    \t\t\t\t\tvar tagHtml = $(this).html();\n    \t\t\t\t\tif (this.attributes.length === 0)\n    \t\t\t\t\t{\n        \t\t\t\t\t$(this).replaceWith(function()\n        \t\t\t\t\t{\n        \t\t\t\t\t\treturn $(this).contents();\n        \t\t\t\t\t});\n    \t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\thtml = $div.html();\n\n\t\t\t\t\t// convert php tags\n\t\t\t\t\thtml = html.replace('<!--?php', '<?php');\n\t\t\t\t\thtml = html.replace('<!--?', '<?');\n\t\t\t\t\thtml = html.replace('?-->', '?>');\n\n\t\t\t\t\t$div.remove();\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tcleanMsWord: function(html)\n\t\t\t\t{\n    \t\t\t\thtml = html.replace(/<!--[\\s\\S]*?-->/g, \"\");\n    \t\t\t\thtml = html.replace(/<o:p>[\\s\\S]*?<\\/o:p>/gi, '');\n\t\t\t\t\thtml = html.replace(/\\n/g, \" \");\n\t\t\t\t\thtml = html.replace(/<br\\s?\\/?>|<\\/p>|<\\/div>|<\\/li>|<\\/td>/gi, '\\n\\n');\n\n\t\t\t\t\t// lists\n\t\t\t\t\tvar $div = $(\"<div/>\").html(html);\n\n\t\t\t\t\tvar lastList = false;\n\t\t\t\t\tvar lastLevel = 1;\n\t\t\t\t\tvar listsIds = [];\n\n\t\t\t\t\t$div.find(\"p[style]\").each(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tvar matches = $(this).attr('style').match(/mso\\-list\\:l([0-9]+)\\slevel([0-9]+)/);\n\n\t\t\t\t\t\tif (matches)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar currentList = parseInt(matches[1]);\n\t\t\t\t\t\t\tvar currentLevel = parseInt(matches[2]);\n\t\t\t\t\t\t\tvar listType = $(this).html().match(/^[\\w]+\\./) ? \"ol\" : \"ul\";\n\n\t\t\t\t\t\t\tvar $li = $(\"<li/>\").html($(this).html());\n\n\t\t\t\t\t\t\t$li.html($li.html().replace(/^([\\w\\.]+)</, '<'));\n\t\t\t\t\t\t\t$li.find(\"span:first\").remove();\n\n\t\t\t\t\t\t\tif (currentLevel == 1 && $.inArray(currentList, listsIds) == -1)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvar $list = $(\"<\" + listType + \"/>\").attr({\"data-level\": currentLevel, \"data-list\": currentList}).html($li);\n\t\t\t\t\t\t\t\t$(this).replaceWith($list);\n\n\t\t\t\t\t\t\t\tlastList = currentList;\n\t\t\t\t\t\t\t\tlistsIds.push(currentList);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (currentLevel > lastLevel)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tvar $prevList = $div.find('[data-level=\"' + lastLevel + '\"][data-list=\"' + lastList + '\"]');\n\t\t\t\t\t\t\t\t\tvar $lastList = $prevList;\n\n\t\t\t\t\t\t\t\t\tfor(var i = lastLevel; i < currentLevel; i++)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t$list = $(\"<\" + listType + \"/>\");\n\t\t\t\t\t\t\t\t\t\t$list.appendTo($lastList.find(\"li\").last());\n\n\t\t\t\t\t\t\t\t\t\t$lastList = $list;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t$lastList.attr({\"data-level\": currentLevel, \"data-list\": currentList}).html($li);\n\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tvar $prevList = $div.find('[data-level=\"' + currentLevel + '\"][data-list=\"' + currentList + '\"]').last();\n\n\t\t\t\t\t\t\t\t\t$prevList.append($li);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tlastLevel = currentLevel;\n\t\t\t\t\t\t\t\tlastList = currentList;\n\n\t\t\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t$div.find('[data-level][data-list]').removeAttr('data-level data-list');\n\t\t\t\t\thtml = $div.html();\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\treplaceNbspToSpaces: function(html)\n\t\t\t\t{\n\t\t\t\t\treturn html.replace('&nbsp;', ' ');\n\t\t\t\t},\n\t\t\t\treplaceBrToNl: function(html)\n\t\t\t\t{\n\t\t\t\t\treturn html.replace(/<br\\s?\\/?>/gi, '\\n');\n\t\t\t\t},\n\t\t\t\treplaceNlToBr: function(html)\n\t\t\t\t{\n\t\t\t\t\treturn html.replace(/\\n/g, '<br />');\n\t\t\t\t},\n\t\t\t\tconvertTags: function(html, data)\n\t\t\t\t{\n                    var $div = $('<div>').html(html);\n\n                    // remove iframe\n\t\t\t\t\t$div.find('iframe').remove();\n\n\t\t\t\t\t// link target & attrs\n\t\t\t\t\tvar $links = $div.find('a');\n\t\t\t\t\t$links.removeAttr('style');\n\t\t\t\t\tif (this.opts.pasteLinkTarget !== false)\n\t\t\t\t\t{\n    \t\t\t\t\t$links.attr('target', this.opts.pasteLinkTarget);\n\t\t\t\t\t}\n\n                    // links\n                    if (data.links && this.opts.pasteLinks)\n                    {\n                    \t$div.find('a').each(function(i, link)\n                    \t{\n                    \t\tif (link.href)\n                    \t\t{\n                    \t\t\tvar tmp = '##%a href=\"' + link.href + '\"';\n                    \t\t\tvar attr;\n                    \t\t\tfor (var j = 0, length = link.attributes.length; j < length; j++)\n                    \t\t\t{\n                    \t\t\t\tattr = link.attributes.item(j);\n                    \t\t\t\tif (attr.name !== 'href')\n                    \t\t\t\t{\n                    \t\t\t\t\ttmp += ' ' + attr.name + '=\"' + attr.value + '\"';\n                    \t\t\t\t}\n                    \t\t\t}\n\n                    \t\t\tlink.outerHTML = tmp + '%##' + link.innerHTML + '##%/a%##';\n                    \t\t}\n                    \t});\n                    }\n\n                    html = $div.html();\n\n                    // images\n\t\t\t\t\tif (data.images && this.opts.pasteImages)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(/<img(.*?)src=\"(.*?)\"(.*?[^>])>/gi, '##%img$1src=\"$2\"$3%##');\n\t\t\t\t\t}\n\n\t\t\t\t\t// plain text\n\t\t\t\t\tif (this.opts.pastePlainText)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn html;\n\t\t\t\t\t}\n\n\t\t\t\t\t// all tags\n\t\t\t\t\tvar blockTags = (data.lists) ? ['ul', 'ol', 'li'] : this.opts.pasteBlockTags;\n\n\t\t\t\t\tvar tags;\n\t\t\t\t\tif (data.block || data.lists)\n\t\t\t\t\t{\n\t\t\t\t\t\ttags = (data.inline) ? blockTags.concat(this.opts.pasteInlineTags) : blockTags;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\ttags = (data.inline) ? this.opts.pasteInlineTags : [];\n\t\t\t\t\t}\n\n\t\t\t\t\tvar len = tags.length;\n\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(new RegExp('<\\/' + tags[i] + '>', 'gi'), '###/' + tags[i] + '###');\n\n\t\t\t\t\t\tif (tags[i] === 'td' || tags[i] === 'th')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\thtml = html.replace(new RegExp('<' + tags[i] + '(.*?[^>])((colspan|rowspan)=\"(.*?[^>])\")?(.*?[^>])>', 'gi'), '###' + tags[i] + ' $2###');\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (this.utils.isInlineTag(tags[i]))\n\t\t\t\t\t\t{\n    \t\t\t\t\t\thtml = html.replace(new RegExp('<' + tags[i] + '([^>]*)class=\"([^>]*)\"[^>]*>', 'gi'), '###' + tags[i] + ' class=\"$2\"###');\n                            html = html.replace(new RegExp('<' + tags[i] + '([^>]*)data-redactor-style-cache=\"([^>]*)\"[^>]*>', 'gi'), '###' + tags[i] + ' cache=\"$2\"###');\n                            html = html.replace(new RegExp('<' + tags[i] + '[^>]*>', 'gi'), '###' + tags[i] + '###');\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\thtml = html.replace(new RegExp('<' + tags[i] + '[^>]*>', 'gi'), '###' + tags[i] + '###');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn html;\n\n\t\t\t\t},\n\t\t\t\treconvertTags: function(html, data)\n\t\t\t\t{\n\t\t\t\t\t// links & images\n\t\t\t\t\tif ((data.links && this.opts.pasteLinks) || (data.images && this.opts.pasteImages))\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(new RegExp('##%', 'gi'), '<');\n\t\t\t\t\t\thtml = html.replace(new RegExp('%##', 'gi'), '>');\n                    }\n\n\t\t\t\t\t// plain text\n\t\t\t\t\tif (this.opts.pastePlainText)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn html;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar blockTags = (data.lists) ? ['ul', 'ol', 'li'] : this.opts.pasteBlockTags;\n\n\t\t\t\t\tvar tags;\n\t\t\t\t\tif (data.block || data.lists)\n\t\t\t\t\t{\n\t\t\t\t\t\ttags = (data.inline) ? blockTags.concat(this.opts.pasteInlineTags) : blockTags;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\ttags = (data.inline) ? this.opts.pasteInlineTags : [];\n\t\t\t\t\t}\n\n\t\t\t\t\tvar len = tags.length;\n\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(new RegExp('###\\/' + tags[i] + '###', 'gi'), '</' + tags[i] + '>');\n                    }\n\n                    for (var i = 0; i < len; i++)\n\t\t\t\t\t{\n    \t\t\t\t\thtml = html.replace(new RegExp('###' + tags[i] + '###', 'gi'), '<' + tags[i] + '>');\n    \t\t\t\t}\n\n\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t{\n                        if (tags[i] === 'td' || tags[i] === 'th')\n                        {\n\t\t\t\t\t\t    html = html.replace(new RegExp('###' + tags[i] + '\\s?(.*?[^#])###', 'gi'), '<' + tags[i] + '$1>');\n                        }\n                        else if (this.utils.isInlineTag(tags[i]))\n                        {\n\n                            var spanMarker = (tags[i] === 'span') ? ' data-redactor-span=\"true\"' : '';\n\n                            html = html.replace(new RegExp('###' + tags[i] + ' cache=\"(.*?[^#])\"###', 'gi'), '<' + tags[i] + ' style=\"$1\"' + spanMarker + ' data-redactor-style-cache=\"$1\">');\n                            html = html.replace(new RegExp('###' + tags[i] + '\\s?(.*?[^#])###', 'gi'), '<' + tags[i] + '$1>');\n                        }\n                    }\n\n\t\t\t\t\treturn html;\n\n\t\t\t\t},\n\t\t\t\tcleanPre: function(block)\n\t\t\t\t{\n\t\t\t\t\tblock = (typeof block === 'undefined') ? $(this.selection.block()).closest('pre', this.core.editor()[0]) : block;\n\n\t\t\t\t\t$(block).find('br').replaceWith(function()\n\t\t\t\t\t{\n\t\t\t\t\t\treturn document.createTextNode('\\n');\n\t\t\t\t\t});\n\n\t\t\t\t\t$(block).find('p').replaceWith(function()\n\t\t\t\t\t{\n\t\t\t\t\t\treturn $(this).contents();\n\t\t\t\t\t});\n\n\t\t\t\t},\n\t\t\t\tremoveTagsInsidePre: function(html)\n\t\t\t\t{\n\t\t\t\t\tvar $div = $('<div />').append(html);\n\t\t\t\t\t$div.find('pre').replaceWith(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tvar str = $(this).html();\n\t\t\t\t\t\tstr = str.replace(/<br\\s?\\/?>|<\\/p>|<\\/div>|<\\/li>|<\\/td>/gi, '\\n');\n\t\t\t\t\t\tstr = str.replace(/(<([^>]+)>)/gi, '');\n\n\t\t\t\t\t\treturn $('<pre />').append(str);\n\t\t\t\t\t});\n\n\t\t\t\t\thtml = $div.html();\n\t\t\t\t\t$div.remove();\n\n\t\t\t\t\treturn html;\n\n\t\t\t\t},\n\t\t\t\tgetPlainText: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = html.replace(/<!--[\\s\\S]*?-->/gi, '');\n\t\t\t\t\thtml = html.replace(/<style[\\s\\S]*?style>/gi, '');\n                    html = html.replace(/<p><\\/p>/g, '');\n\t\t\t\t\thtml = html.replace(/<\\/div>|<\\/li>|<\\/td>/gi, '\\n');\n\t\t\t\t\thtml = html.replace(/<\\/p>/gi, '\\n\\n');\n\t\t\t\t\thtml = html.replace(/<\\/H[1-6]>/gi, '\\n\\n');\n\n\t\t\t\t\tvar tmp = document.createElement('div');\n\t\t\t\t\ttmp.innerHTML = html;\n\t\t\t\t\thtml = tmp.textContent || tmp.innerText;\n\n\t\t\t\t\treturn $.trim(html);\n\t\t\t\t},\n\t\t\t\tsavePreCode: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = this.clean.savePreFormatting(html);\n\t\t\t\t\thtml = this.clean.saveCodeFormatting(html);\n\t\t\t\t\thtml = this.clean.restoreSelectionMarkers(html);\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tsavePreFormatting: function(html)\n\t\t\t\t{\n\t\t\t\t\tvar pre = html.match(/<pre(.*?)>([\\w\\W]*?)<\\/pre>/gi);\n\t\t\t\t\tif (pre === null)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn html;\n\t\t\t\t\t}\n\n\t\t\t\t\t$.each(pre, $.proxy(function(i,s)\n\t\t\t\t\t{\n    \t\t\t\t\tvar arr = [];\n    \t\t\t\t\tvar codeTag = false;\n    \t\t\t\t\tvar contents, attr1, attr2;\n\n    \t\t\t\t\tif (s.match(/<pre(.*?)>(([\\n\\r\\s]+)?)<code(.*?)>/i))\n    \t\t\t\t\t{\n        \t\t\t\t\tarr = s.match(/<pre(.*?)>(([\\n\\r\\s]+)?)<code(.*?)>([\\w\\W]*?)<\\/code>(([\\n\\r\\s]+)?)<\\/pre>/i);\n        \t\t\t\t\tcodeTag = true;\n\n                            contents = arr[5];\n                            attr1 = arr[1];\n                            attr2 = arr[4];\n    \t\t\t\t\t}\n                        else\n\t\t\t\t\t\t{\n    \t\t\t\t\t\tarr = s.match(/<pre(.*?)>([\\w\\W]*?)<\\/pre>/i);\n\n                            contents = arr[2];\n                            attr1 = arr[1];\n                        }\n\n\t\t\t\t\t\tcontents = contents.replace(/<br\\s?\\/?>/g, '\\n');\n\t\t\t\t\t\tcontents = contents.replace(/&nbsp;/g, ' ');\n\n\t\t\t\t\t\tif (this.opts.preSpaces)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcontents = contents.replace(/\\t/g, new Array(this.opts.preSpaces + 1).join(' '));\n\t\t\t\t\t\t}\n\n                        contents = this.clean.encodeEntities(contents);\n\n\t\t\t\t\t\t// $ fix\n\t\t\t\t\t\tcontents = contents.replace(/\\$/g, '&#36;');\n\n                        if (codeTag)\n                        {\n                            html = html.replace(s, '<pre' + attr1 + '><code' + attr2 + '>' + contents + '</code></pre>');\n                        }\n                        else\n                        {\n                            html = html.replace(s, '<pre' + attr1 + '>' + contents + '</pre>');\n                        }\n\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tsaveCodeFormatting: function(html)\n\t\t\t\t{\n\t\t\t\t\tvar code = html.match(/<code(.*?)>([\\w\\W]*?)<\\/code>/gi);\n\t\t\t\t\tif (code === null)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn html;\n\t\t\t\t\t}\n\n\t\t\t\t\t$.each(code, $.proxy(function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar arr = s.match(/<code(.*?)>([\\w\\W]*?)<\\/code>/i);\n\n\t\t\t\t\t\tarr[2] = arr[2].replace(/&nbsp;/g, ' ');\n\t\t\t\t\t\tarr[2] = this.clean.encodeEntities(arr[2]);\n\t\t\t\t\t\tarr[2] = arr[2].replace(/\\$/g, '&#36;');\n\n\t\t\t\t\t\thtml = html.replace(s, '<code' + arr[1] + '>' + arr[2] + '</code>');\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\trestoreSelectionMarkers: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = html.replace(/&lt;span id=&quot;selection-marker-([0-9])&quot; class=&quot;redactor-selection-marker&quot;&gt;​&lt;\\/span&gt;/g, '<span id=\"selection-marker-$1\" class=\"redactor-selection-marker\">​</span>');\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tsaveFormTags: function(html)\n\t\t\t\t{\n\t\t\t\t\treturn html.replace(/<form(.*?)>([\\w\\W]*?)<\\/form>/gi, '<section$1 rel=\"redactor-form-tag\">$2</section>');\n\t\t\t\t},\n\t\t\t\trestoreFormTags: function(html)\n\t\t\t\t{\n\t\t\t\t\treturn html.replace(/<section(.*?) rel=\"redactor-form-tag\"(.*?)>([\\w\\W]*?)<\\/section>/gi, '<form$1$2>$3</form>');\n\t\t\t\t},\n\t\t\t\tencodeHtml: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = html.replace(/”/g, '\"');\n\t\t\t\t\thtml = html.replace(/“/g, '\"');\n\t\t\t\t\thtml = html.replace(/‘/g, '\\'');\n\t\t\t\t\thtml = html.replace(/’/g, '\\'');\n\t\t\t\t\thtml = this.clean.encodeEntities(html);\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tencodeEntities: function(str)\n\t\t\t\t{\n\t\t\t\t\tstr = String(str).replace(/&amp;/g, '&').replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&quot;/g, '\"');\n\t\t\t\t\tstr = str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;');\n\n\t\t\t\t\treturn str;\n\t\t\t\t},\n\t\t\t\tstripTags: function(input, denied)\n\t\t\t\t{\n\t\t\t\t\tif (typeof denied === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn input.replace(/(<([^>]+)>)/gi, '');\n\t\t\t\t\t}\n\n\t\t\t\t    var tags = /<\\/?([a-z][a-z0-9]*)\\b[^>]*>/gi;\n\n\t\t\t\t    return input.replace(tags, function ($0, $1)\n\t\t\t\t    {\n\t\t\t\t        return denied.indexOf($1.toLowerCase()) === -1 ? $0 : '';\n\t\t\t\t    });\n\t\t\t\t},\n\t\t\t\tremoveMarkers: function(html)\n\t\t\t\t{\n\t\t\t\t\treturn html.replace(/<span(.*?[^>]?)class=\"redactor-selection-marker\"(.*?[^>]?)>([\\w\\W]*?)<\\/span>/gi, '');\n\t\t\t\t},\n\t\t\t\tremoveSpaces: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = $.trim(html);\n\t\t\t\t\thtml = html.replace(/\\n/g, '');\n\t\t\t\t\thtml = html.replace(/[\\t]*/g, '');\n\t\t\t\t\thtml = html.replace(/\\n\\s*\\n/g, \"\\n\");\n\t\t\t\t\thtml = html.replace(/^[\\s\\n]*/g, ' ');\n\t\t\t\t\thtml = html.replace(/[\\s\\n]*$/g, ' ');\n\t\t\t\t\thtml = html.replace( />\\s{2,}</g, '> <'); // between inline tags can be only one space\n\t\t\t\t\thtml = html.replace(/\\n\\n/g, \"\\n\");\n\t\t\t\t\thtml = html.replace(/\\u200B/g, '');\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tremoveSpacesHard: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = $.trim(html);\n\t\t\t\t\thtml = html.replace(/\\n/g, '');\n\t\t\t\t\thtml = html.replace(/[\\t]*/g, '');\n\t\t\t\t\thtml = html.replace(/\\n\\s*\\n/g, \"\\n\");\n\t\t\t\t\thtml = html.replace(/^[\\s\\n]*/g, '');\n\t\t\t\t\thtml = html.replace(/[\\s\\n]*$/g, '');\n\t\t\t\t\thtml = html.replace( />\\s{2,}</g, '><');\n\t\t\t\t\thtml = html.replace(/\\n\\n/g, \"\\n\");\n\t\t\t\t\thtml = html.replace(/\\u200B/g, '');\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tnormalizeCurrentHeading: function()\n\t\t\t\t{\n\t\t\t\t\tvar heading = this.selection.block();\n\t\t\t\t\tif (this.utils.isCurrentOrParentHeader() && heading)\n\t\t\t\t\t{\n\t\t\t\t\t\theading.normalize();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =code\n\t\tcode: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tsyncFire: true,\n\t\t\t\thtml: false,\n\t\t\t\tstart: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = $.trim(html);\n\t\t\t\t\thtml = html.replace(/^(<span id=\"selection-marker-1\" class=\"redactor-selection-marker\">​<\\/span>)/, '');\n\n\t\t\t\t\t// clean\n\t\t\t\t\tif (this.opts.type === 'textarea')\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = this.clean.onSet(html);\n\t\t\t\t\t}\n\t\t\t\t\telse if (this.opts.type === 'div' && html === '')\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = this.opts.emptyHtml;\n\t\t\t\t\t}\n\n\t\t\t\t\thtml = html.replace(/<p><span id=\"selection-marker-1\" class=\"redactor-selection-marker\">​<\\/span><\\/p>/, '');\n\n\t\t\t\t\tthis.events.stopDetectChanges();\n\t\t\t\t\tthis.core.editor().html(html);\n\t\t\t\t\tthis.observe.load();\n\t\t\t\t\tthis.events.startDetectChanges();\n\t\t\t\t},\n\t\t\t\tset: function(html, options)\n\t\t\t\t{\n\t\t\t\t\thtml = $.trim(html);\n\n                    options = options || {};\n\n                    // start\n                    if (options.start)\n                    {\n                        this.start = options.start;\n                    }\n\n\t\t\t\t\t// clean\n\t\t\t\t\tif (this.opts.type === 'textarea')\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = this.clean.onSet(html);\n\t\t\t\t\t}\n\t\t\t\t\telse if (this.opts.type === 'div' && html === '')\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = this.opts.emptyHtml;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.core.editor().html(html);\n\n\t\t\t\t\tif (this.opts.type === 'textarea')\n\t\t\t\t\t{\n    \t\t\t\t\tthis.code.sync();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.placeholder.enable();\n\t\t\t\t},\n\t\t\t\tget: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.type === 'textarea')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.core.textarea().val();\n                    }\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tvar html = this.core.editor().html();\n\n\t\t\t\t\t\t// clean\n\t\t\t\t\t\thtml = this.clean.onGet(html);\n\n\t\t\t\t\t\treturn html;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsync: function()\n\t\t\t\t{\n\t\t\t\t\tif (!this.code.syncFire)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar html = this.core.editor().html();\n\t\t\t\t\tvar htmlCleaned = this.code.cleaned(html);\n\n\t\t\t\t\t// is there a need to synchronize\n\t\t\t\t\tif (this.code.isSync(htmlCleaned))\n\t\t\t\t\t{\n\t\t\t\t\t\t// do not sync\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// save code\n\t\t\t\t\tthis.code.html = htmlCleaned;\n\n\t\t\t\t\tif (this.opts.type !== 'textarea')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.callback('sync', html);\n\t\t\t\t\t\tthis.core.callback('change', html);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.opts.type === 'textarea')\n\t\t\t\t\t{\n\t\t\t\t\t\tsetTimeout($.proxy(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.code.startSync(html);\n\n\t\t\t\t\t\t}, this), 10);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tstartSync: function(html)\n\t\t\t\t{\n\t\t\t\t\t// before clean callback\n\t\t\t\t\thtml = this.core.callback('syncBefore', html);\n\n\t\t\t\t\t// clean\n\t\t\t\t\thtml = this.clean.onSync(html);\n\n\t\t\t\t\t// set code\n\t\t\t\t\tthis.core.textarea().val(html);\n\n\t\t\t\t\t// after sync callback\n\t\t\t\t\tthis.core.callback('sync', html);\n\n\t\t\t\t\t// change callback\n\t\t\t\t\tif (this.start === false)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.callback('change', html);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.start = false;\n\t\t\t\t},\n\t\t\t\tisSync: function(htmlCleaned)\n\t\t\t\t{\n\t\t\t\t\tvar html = (this.code.html !== false) ? this.code.html : false;\n\n\t\t\t\t\treturn (html !== false && html === htmlCleaned);\n\t\t\t\t},\n\t\t\t\tcleaned: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = html.replace(/\\u200B/g, '');\n\t\t\t\t\treturn this.clean.removeMarkers(html);\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =core\n\t\tcore: function()\n\t\t{\n\t\t\treturn {\n\n\t\t\t\tid: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.$editor.attr('id');\n\t\t\t\t},\n\t\t\t\telement: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.$element;\n\t\t\t\t},\n\t\t\t\teditor: function()\n\t\t\t\t{\n\t\t\t\t\treturn (typeof this.$editor === 'undefined') ? $() : this.$editor;\n\t\t\t\t},\n\t\t\t\ttextarea: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.$textarea;\n\t\t\t\t},\n\t\t\t\tbox: function()\n\t\t\t\t{\n\t\t\t\t\treturn (this.opts.type === 'textarea') ? this.$box : this.$element;\n\t\t\t\t},\n\t\t\t\ttoolbar: function()\n\t\t\t\t{\n\t\t\t\t\treturn (this.$toolbar) ? this.$toolbar : false;\n\t\t\t\t},\n\t\t\t\tair: function()\n\t\t\t\t{\n\t\t\t\t\treturn (this.$air) ? this.$air : false;\n\t\t\t\t},\n\t\t\t\tobject: function()\n\t\t\t\t{\n\t\t\t\t\treturn $.extend({}, this);\n\t\t\t\t},\n\t\t\t\tstructure: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().toggleClass('redactor-structure');\n\t\t\t\t},\n\t\t\t\taddEvent: function(name)\n\t\t\t\t{\n\t\t\t\t\tthis.core.event = name;\n\t\t\t\t},\n\t\t\t\tgetEvent: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.core.event;\n\t\t\t\t},\n\t\t\t\tcallback: function(type, e, data)\n\t\t\t\t{\n\t\t\t\t\tvar eventNamespace = 'redactor';\n\t\t\t\t\tvar returnValue = false;\n\t\t\t\t\tvar events = $._data(this.core.element()[0], 'events');\n\n\t\t\t\t\t// on callback\n\t\t\t\t\tif (typeof events !== 'undefined' && typeof events[type] !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tvar len = events[type].length;\n\t\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar namespace = events[type][i].namespace;\n\t\t\t\t\t\t\tif (namespace === 'callback.' + eventNamespace)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvar handler = events[type][i].handler;\n\t\t\t\t\t\t\t\tvar args = (typeof data === 'undefined') ? [e] : [e, data];\n\t\t\t\t\t\t\t\treturnValue = (typeof args === 'undefined') ? handler.call(this, e) : handler.call(this, e, args);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (returnValue)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn returnValue;\n\t\t\t\t\t}\n\n\t\t\t\t\t// no callback\n\t\t\t\t\tif (typeof this.opts.callbacks[type] === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn (typeof data === 'undefined') ? e : data;\n\t\t\t\t\t}\n\n\t\t\t\t\t// callback\n\t\t\t\t\tvar callback = this.opts.callbacks[type];\n\n\t\t\t\t\tif ($.isFunction(callback))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn (typeof data === 'undefined') ? callback.call(this, e) : callback.call(this, e, data);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\treturn (typeof data === 'undefined') ? e : data;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tdestroy: function()\n\t\t\t\t{\n\t\t\t\t\tthis.opts.destroyed = true;\n\n\t\t\t\t\tthis.core.callback('destroy');\n\n\t\t\t\t\t// placeholder\n\t\t\t\t\tthis.placeholder.destroy();\n\n\t\t\t\t\t// progress\n\t\t\t\t\tthis.progress.destroy();\n\n\t\t\t\t\t// help label\n\t\t\t\t\t$('#redactor-voice-' + this.uuid).remove();\n\n\t\t\t\t\tthis.core.editor().removeClass('redactor-in redactor-styles redactor-structure redactor-layer-img-edit');\n\n\t\t\t\t\t// caret service\n\t\t\t\t\tthis.core.editor().off('keydown.redactor-remove-textnode');\n\n\t\t\t\t\t// observer\n\t\t\t\t\tthis.core.editor().off('.redactor-observe.' + this.uuid);\n\n\t\t\t\t\t// off events and remove data\n\t\t\t\t\tthis.$element.off('.redactor').removeData('redactor');\n\t\t\t\t\tthis.core.editor().off('.redactor');\n\n\t\t\t\t\t$(document).off('.redactor-dropdown');\n\t\t\t\t\t$(document).off('.redactor-air.' + this.uuid);\n\t\t\t\t\t$(document).off('mousedown.redactor-blur.' + this.uuid);\n\t\t\t\t\t$(document).off('mousedown.redactor.' + this.uuid);\n\t\t\t\t\t$(document).off('touchstart.redactor.' + this.uuid + ' click.redactor.' + this.uuid);\n\t\t\t\t\t$(window).off('.redactor-toolbar.' + this.uuid);\n\t\t\t\t\t$(window).off('touchmove.redactor.' + this.uuid);\n\t\t\t\t\t$(\"body\").off('scroll.redactor.' + this.uuid);\n\n\t\t\t\t\t$(this.opts.toolbarFixedTarget).off('scroll.redactor.' + this.uuid);\n\n\t\t\t\t\t// plugins events\n\t\t\t\t\tvar self = this;\n\t\t\t\t\tif (this.opts.plugins !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\t$.each(this.opts.plugins, function(i,s)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(window).off('.redactor-plugin-' + s);\n\t\t\t\t\t\t\t$(document).off('.redactor-plugin-' + s);\n\t\t\t\t\t\t\t$(\"body\").off('.redactor-plugin-' + s);\n\t\t\t\t\t\t\tself.core.editor().off('.redactor-plugin-' + s);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\t// click to edit\n\t\t\t\t\tthis.$element.off('click.redactor-click-to-edit');\n\t\t\t\t\tthis.$element.removeClass('redactor-click-to-edit');\n\n\t\t\t\t\t// common\n\t\t\t\t\tthis.core.editor().removeClass('redactor-layer');\n\t\t\t\t\tthis.core.editor().removeAttr('contenteditable');\n\n\t\t\t\t\tvar html = this.code.get();\n\n\t\t\t\t\tif (this.opts.toolbar && this.$toolbar)\n\t\t\t\t\t{\n\t\t\t\t\t\t// dropdowns off\n\t\t\t\t\t\tthis.$toolbar.find('a').each(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar $el = $(this);\n\t\t\t\t\t\t\tif ($el.data('dropdown'))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$el.data('dropdown').remove();\n\t\t\t\t\t\t\t\t$el.data('dropdown', {});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.opts.type === 'textarea')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$box.after(this.$element);\n\t\t\t\t\t\tthis.$box.remove();\n\t\t\t\t\t\tthis.$element.val(html).show();\n\t\t\t\t\t}\n\n\t\t\t\t\t// air\n\t\t\t\t\tif (this.opts.air)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$air.remove();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.opts.toolbar && this.$toolbar)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$toolbar.remove();\n\t\t\t\t\t}\n\n\t\t\t\t\t// modal\n\t\t\t\t\tif (this.$modalBox)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$modalBox.remove();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.$modalOverlay)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$modalOverlay.remove();\n\t\t\t\t\t}\n\n\t\t\t\t\t// hide link's tooltip\n\t\t\t\t\t$('.redactor-link-tooltip').remove();\n\n\t\t\t\t\t// autosave\n\t\t\t\t\tclearInterval(this.autosaveTimeout);\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =detect\n\t\tdetect: function()\n\t\t{\n\t\t\treturn {\n\n\t\t\t\t// public\n\t\t\t\tisWebkit: function()\n\t\t\t\t{\n\t\t\t\t\treturn /webkit/.test(this.opts.userAgent);\n\t\t\t\t},\n\t\t\t\tisFirefox: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.opts.userAgent.indexOf('firefox') > -1;\n\t\t\t\t},\n\t\t\t\tisIe: function(v)\n\t\t\t\t{\n                    if (document.documentMode || /Edge/.test(navigator.userAgent))\n                    {\n                        return 'edge';\n                    }\n\n\t\t\t\t\tvar ie;\n\t\t\t\t\tie = RegExp('msie' + (!isNaN(v)?('\\\\s'+v):''), 'i').test(navigator.userAgent);\n\n\t\t\t\t\tif (!ie)\n\t\t\t\t\t{\n\t\t\t\t\t\tie = !!navigator.userAgent.match(/Trident.*rv[ :]*11\\./);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn ie;\n\t\t\t\t},\n\t\t\t\tisMobile: function()\n\t\t\t\t{\n\t\t\t\t\treturn /(iPhone|iPod|BlackBerry|Android)/.test(navigator.userAgent);\n\t\t\t\t},\n\t\t\t\tisDesktop: function()\n\t\t\t\t{\n\t\t\t\t\treturn !/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent);\n\t\t\t\t},\n\t\t\t\tisIpad: function()\n\t\t\t\t{\n\t\t\t\t\treturn /iPad/.test(navigator.userAgent);\n\t\t\t\t}\n\n\t\t\t};\n\t\t},\n\n\t\t// =dropdown\n\t\tdropdown: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tactive: false,\n\t\t\t\tbutton: false,\n\t\t\t\tkey: false,\n\t\t\t\tposition: [],\n\t\t\t\tgetDropdown: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.dropdown.active;\n\t\t\t\t},\n\t\t\t\tbuild: function(name, $dropdown, dropdownObject)\n\t\t\t\t{\n\t\t\t\t\tdropdownObject = this.dropdown.buildFormatting(name, dropdownObject);\n\n\t\t\t\t\t$.each(dropdownObject, $.proxy(function(btnName, btnObject)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $item = this.dropdown.buildItem(btnName, btnObject);\n\n\t\t\t\t\t\tthis.observe.addDropdown($item, btnName, btnObject);\n\t\t\t\t\t\t$dropdown.attr('rel', name).append($item);\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\tbuildFormatting: function(name, dropdownObject)\n\t\t\t\t{\n\t\t\t\t\tif (name !== 'format' || this.opts.formattingAdd === false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn dropdownObject;\n\t\t\t\t\t}\n\n\t\t\t\t\t$.each(this.opts.formattingAdd, $.proxy(function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar type = (this.utils.isBlockTag(s.args[0])) ? 'block' : 'inline';\n\n\t\t\t\t\t\tdropdownObject[i] = {\n\t\t\t\t\t\t\tfunc: (type === 'block') ? 'block.format' : 'inline.format',\n\t\t\t\t\t\t\targs: s.args,\n\t\t\t\t\t\t\ttitle: s.title\n\t\t\t\t\t\t};\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\treturn dropdownObject;\n\t\t\t\t},\n\t\t\t\tbuildItem: function(btnName, btnObject)\n\t\t\t\t{\n\t\t\t\t\tvar $itemContainer = $('<li />');\n\t\t\t\t\tif (typeof btnObject.classname !== 'undefined')\n\t\t\t\t\t{\n    \t\t\t\t\t$itemContainer.addClass(btnObject.classname);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (btnName.search(/^divider/i) !== -1)\n\t\t\t\t\t{\n    \t\t\t\t\t$itemContainer.addClass('redactor-dropdown-divider');\n\n    \t\t\t\t\treturn $itemContainer;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $item = $('<a href=\"#\" class=\"redactor-dropdown-' + btnName + '\" role=\"button\" />');\n\t\t\t\t\tvar $itemSpan = $('<span />').html(btnObject.title);\n\n\t\t\t\t\t$item.append($itemSpan);\n\t\t\t\t\t$item.on('mousedown', $.proxy(function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\tthis.dropdown.buildClick(e, btnName, btnObject);\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\t$itemContainer.append($item);\n\n\t\t\t\t\treturn $itemContainer;\n\n\t\t\t\t},\n\t\t\t\tbuildClick: function(e, btnName, btnObject)\n\t\t\t\t{\n\t\t\t\t\tif ($(e.target).hasClass('redactor-dropdown-link-inactive'))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar command = this.dropdown.buildCommand(btnObject);\n\n\t\t\t\t\tif (typeof btnObject.args !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.button.toggle(e, btnName, command.type, command.callback, btnObject.args);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.button.toggle(e, btnName, command.type, command.callback);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tbuildCommand: function(btnObject)\n\t\t\t\t{\n\t\t\t\t\tvar command = {};\n\t\t\t\t\tcommand.type = 'func';\n\t\t\t\t\tcommand.callback = btnObject.func;\n\n\t\t\t\t\tif (btnObject.command)\n\t\t\t\t\t{\n\t\t\t\t\t\tcommand.type = 'command';\n\t\t\t\t\t\tcommand.callback = btnObject.command;\n\t\t\t\t\t}\n\t\t\t\t\telse if (btnObject.dropdown)\n\t\t\t\t\t{\n\t\t\t\t\t\tcommand.type = 'dropdown';\n\t\t\t\t\t\tcommand.callback = btnObject.dropdown;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn command;\n\t\t\t\t},\n\t\t\t\tshow: function(e, key)\n\t\t\t\t{\n\t\t\t\t\tif (this.detect.isDesktop())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().focus();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.dropdown.hideAll(false, key);\n\n\t\t\t\t\tthis.dropdown.key = key;\n\t\t\t\t\tthis.dropdown.button = this.button.get(this.dropdown.key);\n\n\t\t\t\t\tif (this.dropdown.button.hasClass('dropact'))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.dropdown.hide();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// re append\n\t\t\t\t\tthis.dropdown.active = this.dropdown.button.data('dropdown').appendTo(document.body);\n\n\t\t\t\t\t// callback\n\t\t\t\t\tthis.core.callback('dropdownShow', { dropdown: this.dropdown.active, key: this.dropdown.key, button: this.dropdown.button });\n\n\t\t\t\t\t// set button\n\t\t\t\t\tthis.button.setActive(this.dropdown.key);\n\t\t\t\t\tthis.dropdown.button.addClass('dropact');\n\n\t\t\t\t\t// position\n\t\t\t\t\tthis.dropdown.getButtonPosition();\n\n\t\t\t\t\t// show\n\t\t\t\t\tif (this.button.toolbar().hasClass('toolbar-fixed-box') && this.detect.isDesktop())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.dropdown.showIsFixedToolbar();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.dropdown.showIsUnFixedToolbar();\n\t\t\t\t\t}\n\n\t\t\t\t\t// disable scroll whan dropdown scroll\n\t\t\t\t\tif (this.detect.isDesktop() && !this.detect.isFirefox())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.dropdown.active.on('mouseover.redactor-dropdown', $.proxy(this.utils.disableBodyScroll, this));\n\t\t\t\t\t\tthis.dropdown.active.on('mouseout.redactor-dropdown mousedown.redactor-dropdown', $.proxy(this.utils.enableBodyScroll, this));\n\t\t\t\t\t}\n\n\t\t\t\t\te.stopPropagation();\n\n\t\t\t\t},\n\t\t\t\tshowIsFixedToolbar: function()\n\t\t\t\t{\n\t\t\t\t\tvar top = this.dropdown.button.position().top + this.dropdown.button.innerHeight() + this.opts.toolbarFixedTopOffset;\n\n\t\t\t\t\tvar position = 'fixed';\n\t\t\t\t\tif (this.opts.toolbarFixedTarget !== document)\n\t\t\t\t\t{\n\t\t\t\t\t\ttop = (this.dropdown.button.innerHeight() + this.$toolbar.offset().top) + this.opts.toolbarFixedTopOffset;\n\t\t\t\t\t\tposition = 'absolute';\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.dropdown.active.css({\n\n\t\t\t\t\t\tposition: position,\n\t\t\t\t\t\tleft: this.dropdown.position.left + 'px',\n\t\t\t\t\t\ttop: top + 'px'\n\n\t\t\t\t\t}).show();\n\n\t\t\t\t\t// animate\n\t\t\t\t\tthis.dropdown.active.redactorAnimation('slideDown', { duration: 0.2 }, $.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.dropdown.enableCallback();\n\t\t\t\t\t\tthis.dropdown.enableEvents();\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\tshowIsUnFixedToolbar: function()\n\t\t\t\t{\n\t\t\t\t\tthis.dropdown.active.css({\n\n\t\t\t\t\t\tposition: 'absolute',\n\t\t\t\t\t\tleft: this.dropdown.position.left + 'px',\n\t\t\t\t\t\ttop: (this.dropdown.button.innerHeight() + this.dropdown.position.top) + 'px'\n\n\t\t\t\t\t}).show();\n\n\t\t\t\t\t// animate\n\t\t\t\t\tthis.dropdown.active.redactorAnimation(((this.opts.animation) ? 'slideDown' : 'show'), { duration: 0.2 }, $.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.dropdown.enableCallback();\n\t\t\t\t\t\tthis.dropdown.enableEvents();\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\tenableEvents: function()\n\t\t\t\t{\n\t\t\t\t\t$(document).on('mousedown.redactor-dropdown', $.proxy(this.dropdown.hideAll, this));\n\t\t\t\t\tthis.core.editor().on('touchstart.redactor-dropdown', $.proxy(this.dropdown.hideAll, this));\n\t\t\t\t\t$(document).on('keyup.redactor-dropdown', $.proxy(this.dropdown.closeHandler, this));\n\t\t\t\t},\n\t\t\t\tenableCallback: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.callback('dropdownShown', { dropdown: this.dropdown.active, key: this.dropdown.key, button: this.dropdown.button });\n\t\t\t\t},\n\t\t\t\tgetButtonPosition: function()\n\t\t\t\t{\n\t\t\t\t\tthis.dropdown.position = this.dropdown.button.offset();\n\n\t\t\t\t\t// fix right placement\n\t\t\t\t\tvar dropdownWidth = this.dropdown.active.width();\n\t\t\t\t\tif ((this.dropdown.position.left + dropdownWidth) > $(document).width())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.dropdown.position.left = Math.max(0, this.dropdown.position.left - dropdownWidth + parseInt(this.dropdown.button.innerWidth()));\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tcloseHandler: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (e.which !== this.keyCode.ESC)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.dropdown.hideAll(e);\n\t\t\t\t\tthis.core.editor().focus();\n\t\t\t\t},\n\t\t\t\thideAll: function(e, key)\n\t\t\t\t{\n\t\t\t\t\tif (this.detect.isDesktop())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.utils.enableBodyScroll();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (e !== false && $(e.target).closest('.redactor-dropdown').length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $buttons = (typeof key === 'undefined') ? this.button.toolbar().find('a.dropact') : this.button.toolbar().find('a.dropact').not('.re-' + key);\n\t\t\t\t\tvar $elements = (typeof key === 'undefined') ? $('.redactor-dropdown-' + this.uuid) : $('.redactor-dropdown-' + this.uuid).not('.redactor-dropdown-box-' + key);\n\n\t\t\t\t\tif ($elements.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t$(document).off('.redactor-dropdown');\n\t\t\t\t\t\tthis.core.editor().off('.redactor-dropdown');\n\n\t\t\t\t\t\t$.each($elements, $.proxy(function(i,s)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar $el = $(s);\n\n\t\t\t\t\t\t\tthis.core.callback('dropdownHide', $el);\n\n\t\t\t\t\t\t\t$el.hide();\n\t\t\t\t\t\t\t$el.off('mouseover mouseout').off('.redactor-dropdown');\n\n\t\t\t\t\t\t}, this));\n\n\t\t\t\t\t\t$buttons .removeClass('redactor-act dropact');\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\thide: function ()\n\t\t\t\t{\n\t\t\t\t\tif (this.dropdown.active === false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.detect.isDesktop())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.utils.enableBodyScroll();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.dropdown.active.redactorAnimation(((this.opts.animation) ? 'slideUp' : 'hide'), { duration: 0.2 }, $.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\t$(document).off('.redactor-dropdown');\n\t\t\t\t\t\tthis.core.editor().off('.redactor-dropdown');\n\n\t\t\t\t\t\tthis.dropdown.hideOut();\n\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\thideOut: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.callback('dropdownHide', this.dropdown.active);\n\n\t\t\t\t\tthis.dropdown.button.removeClass('redactor-act dropact');\n\t\t\t\t\tthis.dropdown.active.off('mouseover mouseout').off('.redactor-dropdown');\n\t\t\t\t\tthis.dropdown.button = false;\n\t\t\t\t\tthis.dropdown.key = false;\n\t\t\t\t\tthis.dropdown.active = false;\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =events\n\t\tevents: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tfocused: false,\n\t\t\t\tblured: true,\n\t\t\t\tdropImage: false,\n\t\t\t\tstopChanges: false,\n\t\t\t\tstopDetectChanges: function()\n\t\t\t\t{\n\t\t\t\t\tthis.events.stopChanges = true;\n\t\t\t\t},\n\t\t\t\tstartDetectChanges: function()\n\t\t\t\t{\n\t\t\t\t\tvar self = this;\n\t\t\t\t\tsetTimeout(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tself.events.stopChanges = false;\n\t\t\t\t\t}, 1);\n\t\t\t\t},\n\t\t\t\tdragover: function(e)\n\t\t\t\t{\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopPropagation();\n\n\t\t\t\t\tif (e.target.tagName === 'IMG')\n\t\t\t\t\t{\n\t\t\t\t\t\t$(e.target).addClass('redactor-image-dragover');\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tdragleave: function(e)\n\t\t\t\t{\n\t\t\t\t\t// remove image dragover\n\t\t\t\t\tthis.core.editor().find('img').removeClass('redactor-image-dragover');\n\t\t\t\t},\n\t\t\t\tdrop: function(e)\n\t\t\t\t{\n\t\t\t\t\te = e.originalEvent || e;\n\n\t\t\t\t\t// remove image dragover\n\t\t\t\t\tthis.core.editor().find('img').removeClass('redactor-image-dragover');\n\n\t\t\t\t\tif (this.opts.type === 'inline' || this.opts.type === 'pre')\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (window.FormData === undefined || !e.dataTransfer)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (e.dataTransfer.files.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.events.onDrop(e);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.events.onDropUpload(e);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.core.callback('drop', e);\n\n\t\t\t\t},\n\t\t\t\tclick: function(e)\n\t\t\t\t{\n\t\t\t\t\tvar event = this.core.getEvent();\n\t\t\t\t\tvar type = (event === 'click' || event === 'arrow') ? false : 'click';\n\n                    this.core.addEvent(type);\n\t\t\t\t\tthis.utils.disableSelectAll();\n\t\t\t\t\tthis.core.callback('click', e);\n\t\t\t\t},\n\t\t\t\tfocus: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (this.rtePaste)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.events.isCallback('focus'))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.callback('focus', e);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.events.focused = true;\n\t\t\t\t\tthis.events.blured = false;\n\n\t\t\t\t\t// tab\n\t\t\t\t\tif (this.selection.current() === false)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\t\tvar range = this.selection.range(sel);\n\n\t\t\t\t\t\trange.setStart(this.core.editor()[0], 0);\n\t\t\t\t\t\trange.setEnd(this.core.editor()[0], 0);\n\t\t\t\t\t\tthis.selection.update(sel, range);\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tblur: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (this.start || this.rtePaste)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($(e.target).closest('#' + this.core.id() + ', .redactor-toolbar, .redactor-dropdown, #redactor-modal-box').length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!this.events.blured && this.events.isCallback('blur'))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.callback('blur', e);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.events.focused = false;\n\t\t\t\t\tthis.events.blured = true;\n\t\t\t\t},\n\t\t\t\ttouchImageEditing: function()\n\t\t\t\t{\n\t\t\t\t\tvar scrollTimer = -1;\n\t\t\t\t\tthis.events.imageEditing = false;\n\t\t\t\t\t$(window).on('touchmove.redactor.' + this.uuid, $.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.events.imageEditing = true;\n\t\t\t\t\t\tif (scrollTimer !== -1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tclearTimeout(scrollTimer);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tscrollTimer = setTimeout($.proxy(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.events.imageEditing = false;\n\n\t\t\t\t\t\t}, this), 500);\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\tinit: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().on('dragover.redactor dragenter.redactor', $.proxy(this.events.dragover, this));\n\t\t\t\t\tthis.core.editor().on('dragleave.redactor', $.proxy(this.events.dragleave, this));\n\t\t\t\t\tthis.core.editor().on('drop.redactor', $.proxy(this.events.drop, this));\n\t\t\t\t\tthis.core.editor().on('click.redactor', $.proxy(this.events.click, this));\n\t\t\t\t\tthis.core.editor().on('paste.redactor', $.proxy(this.paste.init, this));\n\t\t\t\t\tthis.core.editor().on('keydown.redactor', $.proxy(this.keydown.init, this));\n\t\t\t\t\tthis.core.editor().on('keyup.redactor', $.proxy(this.keyup.init, this));\n\t\t\t\t\tthis.core.editor().on('focus.redactor', $.proxy(this.events.focus, this));\n\n\t\t\t\t\t$(document).on('mousedown.redactor-blur.' + this.uuid, $.proxy(this.events.blur, this));\n\n\t\t\t\t\tthis.events.touchImageEditing();\n\n\t\t\t\t\tthis.events.createObserver();\n\t\t\t\t\tthis.events.setupObserver();\n\n\t\t\t\t},\n\t\t\t\tcreateObserver: function()\n\t\t\t\t{\n\t\t\t\t\tvar self = this;\n\t\t\t\t\tthis.events.observer = new MutationObserver(function(mutations)\n\t\t\t\t\t{\n\t\t\t\t\t\tmutations.forEach($.proxy(self.events.iterateObserver, self));\n\t\t\t\t\t});\n\n\t\t\t\t},\n\t\t\t\titerateObserver: function(mutation)\n\t\t\t\t{\n\n\t\t\t\t\tvar stop = false;\n\n\t\t\t\t\t// target\n\t\t\t\t\tif (((this.opts.type === 'textarea' || this.opts.type === 'div')\n\t\t\t\t\t    && (!this.detect.isFirefox() && mutation.target === this.core.editor()[0]))\n\t\t\t\t\t    || (mutation.attributeName === 'class' && mutation.target === this.core.editor()[0])\n                    )\n\t\t\t\t\t{\n\t\t\t\t\t\tstop = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!stop)\n\t\t\t\t\t{\n    \t\t\t\t\tthis.observe.load();\n\t\t\t\t\t\tthis.events.changeHandler();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsetupObserver: function()\n\t\t\t\t{\n\t\t\t\t\tthis.events.observer.observe(this.core.editor()[0], {\n\t\t\t\t\t\t attributes: true,\n\t\t\t\t\t\t subtree: true,\n\t\t\t\t\t\t childList: true,\n\t\t\t\t\t\t characterData: true,\n\t\t\t\t\t\t characterDataOldValue: true\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tchangeHandler: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.events.stopChanges)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.code.sync();\n\n\t\t\t\t\t// autosave\n\t\t\t\t\tif (this.autosave.is())\n\t\t\t\t\t{\n\t\t\t\t\t\tclearTimeout(this.autosaveTimeout);\n\t\t\t\t\t\tthis.autosaveTimeout = setTimeout($.proxy(this.autosave.send, this), 300);\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tonDropUpload: function(e)\n\t\t\t\t{\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopPropagation();\n\n\t\t\t\t\tif ((!this.opts.dragImageUpload && !this.opts.dragFileUpload) || (this.opts.imageUpload === null && this.opts.fileUpload === null))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (e.target.tagName === 'IMG')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.events.dropImage = e.target;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar files = e.dataTransfer.files;\n                    var len = files.length;\n\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t{\n    \t\t\t\t\tthis.upload.directUpload(files[i], e);\n    \t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonDrop: function(e)\n\t\t\t\t{\n\t\t\t\t\tthis.core.callback('drop', e);\n\t\t\t\t},\n\t\t\t\tisCallback: function(name)\n\t\t\t\t{\n\t\t\t\t\treturn (typeof this.opts.callbacks[name] !== 'undefined' && $.isFunction(this.opts.callbacks[name]));\n\t\t\t\t},\n\n\t\t\t\t// #backward\n\t\t\t\tstopDetect: function()\n\t\t\t\t{\n\t\t\t\t\tthis.events.stopDetectChanges();\n\t\t\t\t},\n\t\t\t\tstartDetect: function()\n\t\t\t\t{\n\t\t\t\t\tthis.events.startDetectChanges();\n\t\t\t\t}\n\n\t\t\t};\n\t\t},\n\n\t\t// =file\n\t\tfile: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tis: function()\n\t\t\t\t{\n\t\t\t\t\treturn !(!this.opts.fileUpload || !this.opts.fileUpload && !this.opts.s3);\n\t\t\t\t},\n\t\t\t\tshow: function()\n\t\t\t\t{\n\t\t\t\t\t// build modal\n\t\t\t\t\tthis.modal.load('file', this.lang.get('file'), 700);\n\n\t\t\t\t\t// build upload\n\t\t\t\t\tthis.upload.init('#redactor-modal-file-upload', this.opts.fileUpload, this.file.insert);\n\n\t\t\t\t\t// set selected text\n\t\t\t\t\t$('#redactor-filename').val(this.selection.get().toString());\n\n\t\t\t\t\t// show\n\t\t\t\t\tthis.modal.show();\n\t\t\t\t},\n\t\t\t\tinsert: function(json, direct, e)\n\t\t\t\t{\n\t\t\t\t\t// error callback\n\t\t\t\t\tif (typeof json.error !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.modal.close();\n\t\t\t\t\t\tthis.core.callback('fileUploadError', json);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.file.release(e, direct);\n\n\t\t\t\t\t// prepare\n\t\t\t\t\tthis.buffer.set();\n\t\t\t\t\tthis.air.collapsed();\n\n\t\t\t\t\t// get\n\t\t\t\t\tvar text = this.file.text(json);\n\t\t\t\t\tvar $link = $('<a />').attr('href', json.url).text(text);\n\t\t\t\t\tvar id = (typeof json.id === 'undefined') ? '' : json.id;\n\t\t\t\t\tvar type = (typeof json.s3 === 'undefined') ? 'file' : 's3';\n\n\t\t\t\t\t// set id\n\t\t\t\t\t$link.attr('data-' + type, id);\n\n\t\t\t\t\t// insert\n\t\t\t\t\t$link = $(this.insert.node($link));\n\n\t\t\t\t\t// focus\n\t\t\t\t\tthis.caret.after($link);\n\n\t\t\t\t\t// callback\n\t\t\t\t\tthis.storage.add({ type: type, node: $link[0], url: json.url, id: id });\n\n\t\t\t\t\tif (direct !== null)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.callback('fileUpload', $link, json);\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\trelease: function(e, direct)\n\t\t\t\t{\n\t\t\t\t\tif (direct)\n\t\t\t\t\t{\n\t\t\t\t\t\t// drag and drop upload\n\t\t\t\t\t\tthis.marker.remove();\n\t\t\t\t\t\tthis.insert.nodeToPoint(e, this.marker.get());\n\t\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t// upload from modal\n\t\t\t\t\t\tthis.modal.close();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\ttext: function(json)\n\t\t\t\t{\n\t\t\t\t\tvar text = $('#redactor-filename').val();\n\n\t\t\t\t\treturn (typeof text === 'undefined' || text === '') ? json.name : text;\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =focus\n\t\tfocus: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tstart: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().focus();\n\n\t\t\t\t\tif (this.opts.type === 'inline')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $first = this.focus.first();\n\t\t\t\t\tif ($first !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.caret.start($first);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tend: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().focus();\n\n\t\t\t\t\tvar last = (this.opts.inline) ? this.core.editor() : this.focus.last();\n\t\t\t\t\tif (last.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// get inline last node\n\t\t\t\t\tvar lastNode = this.focus.lastChild(last);\n\t\t\t\t\tif (!this.detect.isWebkit() && lastNode !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.caret.end(lastNode);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\t\tvar range = this.selection.range(sel);\n\n\t\t\t\t\t\tif (range !== null)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\trange.selectNodeContents(last[0]);\n\t\t\t\t\t\t\trange.collapse(false);\n\n\t\t\t\t\t\t\tthis.selection.update(sel, range);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.caret.end(last);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tfirst: function()\n\t\t\t\t{\n\t\t\t\t\tvar $first = this.core.editor().children().first();\n\t\t\t\t\tif ($first.length === 0 && ($first[0].length === 0 || $first[0].tagName === 'BR' || $first[0].tagName === 'HR' || $first[0].nodeType === 3))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($first[0].tagName === 'UL' || $first[0].tagName === 'OL')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn $first.find('li').first();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn $first;\n\n\t\t\t\t},\n\t\t\t\tlast: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.core.editor().children().last();\n\t\t\t\t},\n\t\t\t\tlastChild: function(last)\n\t\t\t\t{\n\t\t\t\t\tvar lastNode = last[0].lastChild;\n\n\t\t\t\t\treturn (lastNode !== null && this.utils.isInlineTag(lastNode.tagName)) ? lastNode : false;\n\t\t\t\t},\n\t\t\t\tis: function()\n\t\t\t\t{\n\t\t\t\t\treturn (this.core.editor()[0] === document.activeElement);\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =image\n\t\timage: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tis: function()\n\t\t\t\t{\n\t\t\t\t\treturn !(!this.opts.imageUpload || !this.opts.imageUpload && !this.opts.s3);\n\t\t\t\t},\n\t\t\t\tshow: function()\n\t\t\t\t{\n\t\t\t\t\t// build modal\n\t\t\t\t\tthis.modal.load('image', this.lang.get('image'), 700);\n\n\t\t\t\t\t// build upload\n\t\t\t\t\tthis.upload.init('#redactor-modal-image-droparea', this.opts.imageUpload, this.image.insert);\n\t\t\t\t\tthis.modal.show();\n\n\t\t\t\t},\n\t\t\t\tinsert: function(json, direct, e)\n\t\t\t\t{\n\t\t\t\t\tvar $img;\n\n\t\t\t\t\t// error callback\n\t\t\t\t\tif (typeof json.error !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.modal.close();\n\t\t\t\t\t\tthis.events.dropImage = false;\n\t\t\t\t\t\tthis.core.callback('imageUploadError', json, e);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// change image\n\t\t\t\t\tif (this.events.dropImage !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\t$img = $(this.events.dropImage);\n\n\t\t\t\t\t\tthis.core.callback('imageDelete', $img[0].src, $img);\n\n\t\t\t\t\t\t$img.attr('src', json.url);\n\n\t\t\t\t\t\tthis.events.dropImage = false;\n\t\t\t\t\t\tthis.core.callback('imageUpload', $img, json);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.placeholder.hide();\n\t\t\t\t\tvar $figure = $('<' + this.opts.imageTag + '>');\n\n\t\t\t\t\t$img = $('<img>');\n\t\t\t\t\t$img.attr('src', json.url);\n\n\t\t\t\t\t// set id\n\t\t\t\t\tvar id = (typeof json.id === 'undefined') ? '' : json.id;\n\t\t\t\t\tvar type = (typeof json.s3 === 'undefined') ? 'image' : 's3';\n\t\t\t\t\t$img.attr('data-' + type, id);\n\n\t\t\t\t\t$figure.append($img);\n\n\t\t\t\t\tvar pre = this.utils.isTag(this.selection.current(), 'pre');\n\n\t\t\t\t\tif (direct)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.air.collapsed();\n\t\t\t\t\t\tthis.marker.remove();\n\n\t\t\t\t\t\tvar node = this.insert.nodeToPoint(e, this.marker.get());\n\t\t\t\t\t\tvar $next = $(node).next();\n\n\t\t\t\t\t\tthis.selection.restore();\n\n\t\t\t\t\t\t// buffer\n\t\t\t\t\t\tthis.buffer.set();\n\n\t\t\t\t\t\t// insert\n\t\t\t\t\t\tif (typeof $next !== 'undefined' && $next.length !== 0 && $next[0].tagName === 'IMG')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t// delete callback\n\t\t\t\t\t\t\tthis.core.callback('imageDelete', $next[0].src, $next);\n\n\t\t\t\t\t\t\t// replace\n\t\t\t\t\t\t\t$next.closest('figure, p', this.core.editor()[0]).replaceWith($figure);\n\t\t\t\t\t\t\tthis.caret.after($figure);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (pre)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$(pre).after($figure);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.insert.node($figure);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.caret.after($figure);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.modal.close();\n\n\t\t\t\t\t\t// buffer\n\t\t\t\t\t\tthis.buffer.set();\n\n\t\t\t\t\t\t// insert\n\t\t\t\t\t\tthis.air.collapsed();\n\n\t\t\t\t\t\tif (pre)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(pre).after($figure);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.insert.node($figure);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.caret.after($figure);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.events.dropImage = false;\n\t\t\t\t\tthis.storage.add({ type: type, node: $img[0], url: json.url, id: id });\n\n\t\t\t\t\tvar nextNode = $img[0].nextSibling;\n\t\t\t\t\tvar $nextFigure = $figure.next();\n\t\t\t\t\tvar isNextEmpty = $(nextNode).text().replace(/\\u200B/g, '');\n\t\t\t\t\tvar isNextFigureEmpty = $nextFigure.text().replace(/\\u200B/g, '');\n\n\t\t\t\t\tif (isNextEmpty === '')\n\t\t\t\t\t{\n    \t\t\t\t\t$(nextNode).remove();\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($nextFigure.length === 1 && $nextFigure[0].tagName === 'FIGURE' && isNextFigureEmpty === '')\n\t\t\t\t\t{\n    \t\t\t\t\t$nextFigure.remove();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (direct !== null)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.callback('imageUpload', $img, json);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n    \t\t\t\t\tthis.core.callback('imageInserted', $img, json);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsetEditable: function($image)\n\t\t\t\t{\n\t\t\t\t\t$image.on('dragstart', function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t});\n\n                    if (this.opts.imageResizable)\n                    {\n    \t\t\t\t\tvar handler = $.proxy(function(e)\n    \t\t\t\t\t{\n    \t\t\t\t\t\tthis.observe.image = $image;\n    \t\t\t\t\t\tthis.image.resizer = this.image.loadEditableControls($image);\n\n    \t\t\t\t\t\t$(document).on('mousedown.redactor-image-resize-hide.' + this.uuid, $.proxy(this.image.hideResize, this));\n\n    \t\t\t\t\t\tif (this.image.resizer)\n    \t\t\t\t\t\t{\n                                this.image.resizer.on('mousedown.redactor touchstart.redactor', $.proxy(function(e)\n        \t\t\t\t\t\t{\n        \t\t\t\t\t\t\tthis.image.setResizable(e, $image);\n        \t\t\t\t\t\t}, this));\n    \t\t\t\t\t\t}\n\n    \t\t\t\t\t}, this);\n\n    \t\t\t\t\t$image.off('mousedown.redactor').on('mousedown.redactor', $.proxy(this.image.hideResize, this));\n    \t\t\t\t\t$image.off('click.redactor touchstart.redactor').on('click.redactor touchstart.redactor', handler);\n                    }\n                    else\n                    {\n    \t\t\t\t\t$image.off('click.redactor touchstart.redactor').on('click.redactor touchstart.redactor', $.proxy(function(e)\n    \t\t\t\t\t{\n    \t\t\t\t\t\tsetTimeout($.proxy(function()\n    \t\t\t\t\t\t{\n    \t\t\t\t\t\t\tthis.image.showEdit($image);\n\n    \t\t\t\t\t\t}, this), 200);\n\n    \t\t\t\t\t}, this));\n                    }\n\n\t\t\t\t},\n\t\t\t\tsetResizable: function(e, $image)\n\t\t\t\t{\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t    this.image.resizeHandle = {\n\t\t\t\t        x : e.pageX,\n\t\t\t\t        y : e.pageY,\n\t\t\t\t        el : $image,\n\t\t\t\t        ratio: $image.width() / $image.height(),\n\t\t\t\t        h: $image.height()\n\t\t\t\t    };\n\n\t\t\t\t    e = e.originalEvent || e;\n\n\t\t\t\t    if (e.targetTouches)\n\t\t\t\t    {\n\t\t\t\t         this.image.resizeHandle.x = e.targetTouches[0].pageX;\n\t\t\t\t         this.image.resizeHandle.y = e.targetTouches[0].pageY;\n\t\t\t\t    }\n\n\t\t\t\t\tthis.image.startResize();\n\t\t\t\t},\n\t\t\t\tstartResize: function()\n\t\t\t\t{\n\t\t\t\t\t$(document).on('mousemove.redactor-image-resize touchmove.redactor-image-resize', $.proxy(this.image.moveResize, this));\n\t\t\t\t\t$(document).on('mouseup.redactor-image-resize touchend.redactor-image-resize', $.proxy(this.image.stopResize, this));\n\t\t\t\t},\n\t\t\t\tmoveResize: function(e)\n\t\t\t\t{\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\te = e.originalEvent || e;\n\n\t\t\t\t\tvar height = this.image.resizeHandle.h;\n\n\t\t            if (e.targetTouches) height += (e.targetTouches[0].pageY -  this.image.resizeHandle.y);\n\t\t            else height += (e.pageY -  this.image.resizeHandle.y);\n\n\t\t\t\t\tvar width = Math.round(height * this.image.resizeHandle.ratio);\n\n\t\t\t\t\tif (height < 50 || width < 100) return;\n\n\t\t\t\t\tthis.image.resizeHandle.el.attr({width: width, height: height});\n\t\t            this.image.resizeHandle.el.width(width);\n\t\t            this.image.resizeHandle.el.height(height);\n\n\t\t            this.code.sync();\n\t\t\t\t},\n\t\t\t\tstopResize: function()\n\t\t\t\t{\n\t\t\t\t\tthis.handle = false;\n\t\t\t\t\t$(document).off('.redactor-image-resize');\n\n\t\t\t\t\tthis.image.hideResize();\n\t\t\t\t},\n                hideResize: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (e && $(e.target).closest('#redactor-image-box', this.$editor[0]).length !== 0) return;\n\t\t\t\t\tif (e && e.target.tagName == 'IMG')\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $image = $(e.target);\n\t\t\t\t\t}\n\n\t\t\t\t\tvar imageBox = this.$editor.find('#redactor-image-box');\n\t\t\t\t\tif (imageBox.length === 0) return;\n\n\t\t\t\t\t$('#redactor-image-editter').remove();\n\t\t\t\t\t$('#redactor-image-resizer').remove();\n\n\t\t\t\t\timageBox.find('img').css({\n\t\t\t\t\t\tmarginTop: imageBox[0].style.marginTop,\n\t\t\t\t\t\tmarginBottom: imageBox[0].style.marginBottom,\n\t\t\t\t\t\tmarginLeft: imageBox[0].style.marginLeft,\n\t\t\t\t\t\tmarginRight: imageBox[0].style.marginRight\n\t\t\t\t\t});\n\n\t\t\t\t\timageBox.css('margin', '');\n\t\t\t\t\timageBox.find('img').css('opacity', '');\n\t\t\t\t\timageBox.replaceWith(function()\n\t\t\t\t\t{\n\t\t\t\t\t\treturn $(this).contents();\n\t\t\t\t\t});\n\n\t\t\t\t\t$(document).off('mousedown.redactor-image-resize-hide.' + this.uuid);\n\n\t\t\t\t\tif (typeof this.image.resizeHandle !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.image.resizeHandle.el.attr('rel', this.image.resizeHandle.el.attr('style'));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tloadResizableControls: function($image, imageBox)\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.imageResizable && !this.detect.isMobile())\n\t\t\t\t\t{\n\t\t\t\t\t\tvar imageResizer = $('<span id=\"redactor-image-resizer\" data-redactor=\"verified\"></span>');\n\n\t\t\t\t\t\tif (!this.detect.isDesktop())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\timageResizer.css({ width: '15px', height: '15px' });\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\timageResizer.attr('contenteditable', false);\n\t\t\t\t\t\timageBox.append(imageResizer);\n\t\t\t\t\t\timageBox.append($image);\n\n\t\t\t\t\t\treturn imageResizer;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\timageBox.append($image);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tloadEditableControls: function($image)\n\t\t\t\t{\n    \t\t\t\tif ($('#redactor-image-box').length !== 0)\n    \t\t\t\t{\n        \t\t\t\treturn;\n    \t\t\t\t}\n\n\t\t\t\t\tvar imageBox = $('<span id=\"redactor-image-box\" data-redactor=\"verified\">');\n\t\t\t\t\timageBox.css('float', $image.css('float')).attr('contenteditable', false);\n\n\t\t\t\t\tif ($image[0].style.margin != 'auto')\n\t\t\t\t\t{\n\t\t\t\t\t\timageBox.css({\n\t\t\t\t\t\t\tmarginTop: $image[0].style.marginTop,\n\t\t\t\t\t\t\tmarginBottom: $image[0].style.marginBottom,\n\t\t\t\t\t\t\tmarginLeft: $image[0].style.marginLeft,\n\t\t\t\t\t\t\tmarginRight: $image[0].style.marginRight\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t$image.css('margin', '');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\timageBox.css({ 'display': 'block', 'margin': 'auto' });\n\t\t\t\t\t}\n\n\t\t\t\t\t$image.css('opacity', '.5').after(imageBox);\n\n\n\t\t\t\t\tif (this.opts.imageEditable)\n\t\t\t\t\t{\n\t\t\t\t\t\t// editter\n\t\t\t\t\t\tthis.image.editter = $('<span id=\"redactor-image-editter\" data-redactor=\"verified\">' + this.lang.get('edit') + '</span>');\n\t\t\t\t\t\tthis.image.editter.attr('contenteditable', false);\n\t\t\t\t\t\tthis.image.editter.on('click', $.proxy(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.image.showEdit($image);\n\t\t\t\t\t\t}, this));\n\n\t\t\t\t\t\timageBox.append(this.image.editter);\n\n\t\t\t\t\t\t// position correction\n\t\t\t\t\t\tvar editerWidth = this.image.editter.innerWidth();\n\t\t\t\t\t\tthis.image.editter.css('margin-left', '-' + editerWidth/2 + 'px');\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this.image.loadResizableControls($image, imageBox);\n\n\t\t\t\t},\n\t\t\t\tshowEdit: function($image)\n\t\t\t\t{\n\t\t\t\t\tif (this.events.imageEditing)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.observe.image = $image;\n\n\t\t\t\t\tvar $link = $image.closest('a', this.$editor[0]);\n    \t\t\t\tvar $figure = $image.closest('figure', this.$editor[0]);\n    \t\t\t\tvar $container = ($figure.length !== 0) ? $figure : $image;\n\n\t\t\t\t\tthis.modal.load('image-edit', this.lang.get('edit'), 705);\n\n\t\t\t\t\tthis.image.buttonDelete = this.modal.getDeleteButton().text(this.lang.get('delete'));\n\t\t\t\t\tthis.image.buttonSave = this.modal.getActionButton().text(this.lang.get('save'));\n\n\t\t\t\t\tthis.image.buttonDelete.on('click', $.proxy(this.image.remove, this));\n\t\t\t\t\tthis.image.buttonSave.on('click', $.proxy(this.image.update, this));\n\n\t\t\t\t\tif (this.opts.imageCaption === false)\n\t\t\t\t\t{\n\t\t\t\t\t\t$('#redactor-image-caption').val('').hide().prev().hide();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $parent = $image.closest(this.opts.imageTag, this.$editor[0]);\n\t\t\t\t\t\tvar $ficaption = $parent.find('figcaption');\n\t\t\t\t\t\tif ($ficaption !== 0)\n\t\t\t\t\t\t{\n\n\t\t\t\t\t\t\t$('#redactor-image-caption').val($ficaption.text()).show();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!this.opts.imagePosition)\n\t\t\t\t\t{\n    \t\t\t\t\t$('.redactor-image-position-option').hide();\n    \t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n    \t\t\t\t\tvar isCentered = ($figure.length !== 0) ? ($container.css('text-align') === 'center') : ($container.css('display') == 'block' && $container.css('float') == 'none');\n\t\t\t\t\t\tvar floatValue = (isCentered) ? 'center' : $container.css('float');\n\t\t\t\t\t\t$('#redactor-image-align').val(floatValue);\n\t\t\t\t\t}\n\n\t\t\t\t\t$('#redactor-image-preview').html($('<img src=\"' + $image.attr('src') + '\" style=\"max-width: 100%;\">'));\n\t\t\t\t\t$('#redactor-image-title').val($image.attr('alt'));\n\n\t\t\t\t\tif ($link.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t$('#redactor-image-link').val($link.attr('href'));\n\t\t\t\t\t\tif ($link.attr('target') === '_blank')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$('#redactor-image-link-blank').prop('checked', true);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// hide link's tooltip\n\t\t\t\t\t$('.redactor-link-tooltip').remove();\n\n\t\t\t\t\tthis.modal.show();\n\n\t\t\t\t\t// focus\n\t\t\t\t\tif (this.detect.isDesktop())\n\t\t\t\t\t{\n\t\t\t\t\t\t$('#redactor-image-title').focus();\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tupdate: function()\n\t\t\t\t{\n\t\t\t\t\tvar $image = this.observe.image;\n\t\t\t\t\tvar $link = $image.closest('a', this.core.editor()[0]);\n\n\t\t\t\t\tvar title = $('#redactor-image-title').val().replace(/(<([^>]+)>)/ig,\"\");\n\t\t\t\t\t$image.attr('alt', title).attr('title', title);\n\n                    this.image.setFloating($image);\n\n\t\t\t\t\t// as link\n\t\t\t\t\tvar link = $.trim($('#redactor-image-link').val()).replace(/(<([^>]+)>)/ig,\"\");\n\t\t\t\t\tif (link !== '')\n\t\t\t\t\t{\n\t\t\t\t\t\t// test url (add protocol)\n\t\t\t\t\t\tvar pattern = '((xn--)?[a-z0-9]+(-[a-z0-9]+)*\\\\.)+[a-z]{2,}';\n\t\t\t\t\t\tvar re = new RegExp('^(http|ftp|https)://' + pattern, 'i');\n\t\t\t\t\t\tvar re2 = new RegExp('^' + pattern, 'i');\n\n\t\t\t\t\t\tif (link.search(re) === -1 && link.search(re2) === 0 && this.opts.linkProtocol)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlink = this.opts.linkProtocol + '://' + link;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar target = ($('#redactor-image-link-blank').prop('checked')) ? true : false;\n\n\t\t\t\t\t\tif ($link.length === 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar a = $('<a href=\"' + link + '\" id=\"redactor-img-tmp\">' + this.utils.getOuterHtml($image) + '</a>');\n\t\t\t\t\t\t\tif (target)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ta.attr('target', '_blank');\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t$image = $image.replaceWith(a);\n\t\t\t\t\t\t\t$link = this.core.editor().find('#redactor-img-tmp');\n\t\t\t\t\t\t\t$link.removeAttr('id');\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$link.attr('href', link);\n\t\t\t\t\t\t\tif (target)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$link.attr('target', '_blank');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$link.removeAttr('target');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if ($link.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t$link.replaceWith(this.utils.getOuterHtml($image));\n\t\t\t\t\t}\n\n                    this.image.addCaption($image, $link);\n\t\t\t\t\tthis.modal.close();\n\n\t\t\t\t\t// buffer\n\t\t\t\t\tthis.buffer.set();\n\n\t\t\t\t},\n\t\t\t\tsetFloating: function($image)\n\t\t\t\t{\n    \t\t\t\tvar $figure = $image.closest('figure', this.$editor[0]);\n    \t\t\t\tvar $container = ($figure.length !== 0) ? $figure : $image;\n\t\t\t\t\tvar floating = $('#redactor-image-align').val();\n\n\t\t\t\t\tvar imageFloat = '';\n\t\t\t\t\tvar imageDisplay = '';\n\t\t\t\t\tvar imageMargin = '';\n\t\t\t\t\tvar textAlign = '';\n\n\t\t\t\t\tswitch (floating)\n\t\t\t\t\t{\n\t\t\t\t\t\tcase 'left':\n\t\t\t\t\t\t\timageFloat = 'left';\n\t\t\t\t\t\t\timageMargin = '0 ' + this.opts.imageFloatMargin + ' ' + this.opts.imageFloatMargin + ' 0';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'right':\n\t\t\t\t\t\t\timageFloat = 'right';\n\t\t\t\t\t\t\timageMargin = '0 0 ' + this.opts.imageFloatMargin + ' ' + this.opts.imageFloatMargin;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'center':\n\n                            if ($figure.length !== 0)\n                            {\n                                textAlign = 'center';\n                            }\n                            else\n                            {\n\t    \t\t\t\t\t\timageDisplay = 'block';\n    \t\t\t\t\t\t\timageMargin = 'auto';\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\t$container.css({ 'float': imageFloat, 'display': imageDisplay, 'margin': imageMargin, 'text-align': textAlign });\n\t\t\t\t\t$container.attr('rel', $image.attr('style'));\n\t\t\t\t},\n\t\t\t\taddCaption: function($image, $link)\n\t\t\t\t{\n                    var caption = $('#redactor-image-caption').val();\n\n                    var $target = ($link.length !== 0) ? $link : $image;\n\t\t\t\t\tvar $figcaption = $target.next();\n\n\t\t\t\t\tif ($figcaption.length === 0 || $figcaption[0].tagName !== 'FIGCAPTION')\n\t\t\t\t\t{\n\t\t\t\t\t\t$figcaption = false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (caption !== '')\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($figcaption === false)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$figcaption = $('<figcaption />').text(caption);\n\t\t\t\t\t\t\t$target.after($figcaption);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$figcaption.text(caption);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if ($figcaption !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\t$figcaption.remove();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tremove: function(e, $image, index)\n\t\t\t\t{\n\t\t\t\t\t$image = (typeof $image === 'undefined') ? $(this.observe.image) : $image;\n\n\t\t\t\t\t// delete from modal\n\t\t\t\t\tif (typeof e !== 'boolean')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buffer.set();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.events.stopDetectChanges();\n\n\t\t\t\t\tvar $link = $image.closest('a', this.core.editor()[0]);\n\t\t\t\t\tvar $figure = $image.closest(this.opts.imageTag, this.core.editor()[0]);\n\t\t\t\t\tvar $parent = $image.parent();\n\n\t\t\t\t\t// callback\n                    var imageDeleteStop = this.core.callback('imageDelete', e, $image[0]);\n\t\t\t\t\tif (imageDeleteStop === false)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (e) e.preventDefault();\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($('#redactor-image-box').length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t$parent = $('#redactor-image-box').parent();\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $next, $prev;\n\t\t\t\t\tif ($figure.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t$prev = $figure.prev();\n\t\t\t\t\t\t$next = $figure.next();\n\t\t\t\t\t\t$figure.remove();\n\t\t\t\t\t}\n\t\t\t\t\telse if ($link.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t$parent = $link.parent();\n\t\t\t\t\t\t$link.remove();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t$image.remove();\n\t\t\t\t\t}\n\n\t\t\t\t\t$('#redactor-image-box').remove();\n\n\t\t\t\t\tif (e !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($next && $next.length !== 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.caret.start($next);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if ($prev && $prev.length !== 0)\n\t\t\t\t\t\t{\n                            this.caret.end($prev);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (typeof e !== 'boolean')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.modal.close();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.utils.restoreScroll();\n\t\t\t\t\tthis.observe.image = false;\n\t\t\t\t\tthis.events.startDetectChanges();\n\t\t\t\t\tthis.placeholder.enable();\n\t\t\t\t\tthis.code.sync();\n\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =indent\n\t\tindent: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tincrease: function()\n\t\t\t\t{\n\t\t\t\t\tif (!this.list.get())\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $current = $(this.selection.current()).closest('li');\n\t\t\t\t\tvar $list = $current.closest('ul, ol', this.core.editor()[0]);\n\n\t\t\t\t\tvar $li = $current.closest('li');\n\t\t\t\t\tvar $prev = $li.prev();\n\t\t\t\t\tif ($prev.length === 0 || $prev[0].tagName !== 'LI')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.buffer.set();\n\n\n\t\t\t\t\tif (this.utils.isCollapsed())\n\t\t\t\t\t{\n\t\t\t\t\t\tvar listTag = $list[0].tagName;\n\t\t\t\t\t\tvar $newList = $('<' + listTag + ' />');\n\n\t\t\t\t\t\tthis.selection.save();\n\n                        var $ol = $prev.find('ol').first();\n                        if ($ol.length === 1)\n                        {\n                            $ol.append($current);\n                        }\n                        else\n                        {\n                            var listTag = $list[0].tagName;\n                            var $newList = $('<' + listTag + ' />');\n                            $newList.append($current);\n                            $prev.append($newList);\n                        }\n\n\t\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tdocument.execCommand('indent');\n\n\t\t\t\t\t\t// normalize\n\t\t\t\t\t\tthis.selection.save();\n\t\t\t\t\t\tthis.indent.removeEmpty();\n\t\t\t\t\t\tthis.indent.normalize();\n\t\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tdecrease: function()\n\t\t\t\t{\n\t\t\t\t\tif (!this.list.get())\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $current = $(this.selection.current()).closest('li');\n\t\t\t\t\tvar $list = $current.closest('ul, ol', this.core.editor()[0]);\n\n\t\t\t\t\tthis.buffer.set();\n\n\t\t\t\t\tdocument.execCommand('outdent');\n\n\t\t\t\t\tvar $item = $(this.selection.current()).closest('li', this.core.editor()[0]);\n\n\t\t\t\t\tif (this.utils.isCollapsed())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.indent.repositionItem($item);\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($item.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tdocument.execCommand('formatblock', false, 'p');\n\t\t\t\t\t\t$item = $(this.selection.current());\n\t\t\t\t\t\tvar $next = $item.next();\n\t\t\t\t\t\tif ($next.length !== 0 && $next[0].tagName === 'BR')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$next.remove();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// normalize\n\t\t\t\t\tthis.selection.save();\n\t\t\t\t\tthis.indent.removeEmpty();\n\t\t\t\t\tthis.indent.normalize();\n\t\t\t\t\tthis.selection.restore();\n\n\t\t\t\t},\n\t\t\t\trepositionItem: function($item)\n\t\t\t\t{\n    \t\t\t\tvar $next = $item.next();\n    \t\t\t\tif ($next.length !== 0 && ($next[0].tagName !== 'UL' || $next[0].tagName !== 'OL'))\n    \t\t\t\t{\n        \t\t\t\t$item.append($next);\n    \t\t\t\t}\n\n\t\t\t\t\tvar $prev = $item.prev();\n\t\t\t\t\tif ($prev.length !== 0 && $prev[0].tagName !== 'LI')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.selection.save();\n\t\t\t\t\t\tvar $li = $item.parents('li', this.core.editor()[0]);\n\t\t\t\t\t\t$li.after($item);\n\t\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tnormalize: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().find('li').each($.proxy(function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $el = $(s);\n\n\t\t\t\t\t\t// remove style\n\t\t\t\t\t\t$el.find(this.opts.inlineTags.join(',')).each(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(this).removeAttr('style');\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tvar $parent = $el.parent();\n\t\t\t\t\t\tif ($parent.length !== 0 && $parent[0].tagName === 'LI')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$parent.after($el);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar $next = $el.next();\n\t\t\t\t\t\tif ($next.length !== 0 && ($next[0].tagName === 'UL' || $next[0].tagName === 'OL'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$el.append($next);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t},\n\t\t\t\tremoveEmpty: function($list)\n\t\t\t\t{\n\t\t\t\t\tvar $lists = this.core.editor().find('ul, ol');\n\t\t\t\t\tvar $items = this.core.editor().find('li');\n\n\t\t\t\t\t$items.each($.proxy(function(i, s)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.indent.removeItemEmpty(s);\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\t$lists.each($.proxy(function(i, s)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.indent.removeItemEmpty(s);\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\t$items.each($.proxy(function(i, s)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.indent.removeItemEmpty(s);\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\tremoveItemEmpty: function(s)\n\t\t\t\t{\n\t\t\t\t\tvar html = s.innerHTML.replace(/[\\t\\s\\n]/g, '');\n\t\t\t\t\thtml = html.replace(/<span><\\/span>/g, '');\n\n\t\t\t\t\tif (html === '')\n\t\t\t\t\t{\n\t\t\t\t\t\t$(s).remove();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =inline\n\t\tinline: function()\n\t\t{\n\t\t\treturn {\n                format: function(tag, attr, value, type)\n\t\t\t\t{\n    \t\t\t\t// Stop formatting pre/code\n\t\t\t\t\tif (this.utils.isCurrentOrParent(['PRE', 'CODE'])) return;\n\n\t\t\t\t\t// Get params\n\t\t\t\t\tvar params = this.inline.getParams(attr, value, type);\n\n                    // Arrange tag\n                    tag = this.inline.arrangeTag(tag);\n\n                    this.placeholder.hide();\n\t\t\t\t\tthis.buffer.set();\n\n\t\t\t\t\t(this.utils.isCollapsed()) ? this.inline.formatCollapsed(tag, params) : this.inline.formatUncollapsed(tag, params);\n\t\t\t\t},\n\t\t\t\tformatCollapsed: function(tag, params)\n\t\t\t\t{\n    \t\t\t\tvar newInline;\n    \t\t\t\tvar inline = this.selection.inline();\n\n    \t\t\t\tif (inline)\n\t\t\t\t\t{\n                        var currentTag = inline.tagName.toLowerCase();\n                        if (currentTag === tag)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t// empty = remove\n\t\t\t\t\t\t\tif (this.utils.isEmpty(inline.innerHTML))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.caret.after(inline);\n\t\t\t\t\t\t\t\t$(inline).remove();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// not empty = break\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvar $first = this.inline.insertBreakpoint(inline, currentTag);\n\t\t\t\t\t\t\t\tthis.caret.after($first);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n                        else if ($(inline).closest(tag).length === 0)\n                        {\n\t\t\t\t\t\t\tnewInline = this.inline.insertInline(tag);\n\t\t\t\t\t\t\tnewInline = this.inline.setParams(newInline, params);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n    \t\t\t\t\t\tvar $first = this.inline.insertBreakpoint(inline, currentTag);\n                            this.caret.after($first);\n\t\t\t\t\t\t}\n    \t\t\t\t}\n    \t\t\t\telse\n    \t\t\t\t{\n                        newInline = this.inline.insertInline(tag);\n                        newInline = this.inline.setParams(newInline, params);\n    \t\t\t\t}\n\t\t\t\t},\n\t\t\t\tformatUncollapsed: function(tag, params)\n\t\t\t\t{\n    \t\t\t\tthis.selection.save();\n\n                    var nodes = this.inline.getClearedNodes();\n                    this.inline.setNodesStriked(nodes, tag, params);\n\n                    this.selection.restore();\n\n                    document.execCommand('strikethrough');\n\n                    this.selection.saveInstant();\n\n                    var self = this;\n                    this.core.editor().find('strike').each(function()\n    \t\t\t\t{\n                        var $el = self.utils.replaceToTag(this, tag);\n        \t\t\t\tself.inline.setParams($el[0], params);\n\n        \t\t\t\tvar $inside = $el.find(tag);\n        \t\t\t\tvar $parent = $el.parent();\n        \t\t\t\tvar $parentAround = $parent.parent();\n\n                        // revert formatting (safari bug)\n                        if ($parentAround.length !== 0 && $parentAround[0].tagName.toLowerCase() === tag && $parentAround.html() == $parent[0].outerHTML)\n                        {\n                            $el.replaceWith(function() { return $(this).contents(); });\n                            $parentAround.replaceWith(function() { return $(this).contents(); });\n\n                            return;\n                        }\n\n        \t\t\t\t// remove inside\n        \t\t\t\tif ($inside.length !== 0) self.inline.cleanInsideOrParent($inside, params);\n\n                        // same parent\n                        if ($parent.html() == $el[0].outerHTML) self.inline.cleanInsideOrParent($parent, params);\n\n                        // bugfix: remove empty inline tags after selection\n                        if (self.detect.isFirefox())\n                        {\n                            self.core.editor().find(tag + ':empty').remove();\n                        }\n    \t\t\t\t});\n\n    \t\t\t\tthis.selection.restoreInstant();\n\t\t\t\t},\n\t\t\t\tcleanInsideOrParent: function($el, params)\n\t\t\t\t{\n                    if (params)\n                    {\n                        for (var key in params.data)\n                        {\n        \t\t\t\t    this.inline.removeSpecificAttr($el, key, params.data[key]);\n        \t\t\t\t}\n    \t\t\t\t}\n\t\t\t\t},\n    \t\t\tgetClearedNodes: function()\n    \t\t\t{\n                    var nodes = this.selection.nodes();\n        \t\t\tvar newNodes = [];\n        \t\t\tvar len = nodes.length;\n                    var started = 0;\n\n                    // find array slice\n                    for (var i = 0; i < len; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($(nodes[i]).hasClass('redactor-selection-marker'))\n\t\t\t\t\t\t{\n    \t\t\t\t\t\tstarted = i + 2;\n    \t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n                    // find selected inline & text nodes\n                    for (var i = 0; i < len; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (i >= started && !this.utils.isBlockTag(nodes[i].tagName))\n\t\t\t\t\t\t{\n                            newNodes.push(nodes[i]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn newNodes;\n    \t\t\t},\n                isConvertableAttr: function(node, name, value)\n                {\n                    var nodeAttrValue = $(node).attr(name);\n                    if (nodeAttrValue)\n                    {\n                        if (name === 'style')\n                        {\n                            value = $.trim(value).replace(/;$/, '')\n\n                            var rules = value.split(';');\n                            var count = 0;\n                            for (var i = 0; i < rules.length; i++)\n                            {\n                                var arr = rules[i].split(':');\n                                var ruleName = $.trim(arr[0]);\n                                var ruleValue = $.trim(arr[1]);\n\n                                if (ruleName.search(/color/) !== -1)\n                                {\n                                    var val = $(node).css(ruleName);\n                                    if (val && (val === ruleValue || this.utils.rgb2hex(val) === ruleValue))\n                                    {\n                                        count++;\n                                    }\n                                }\n                                else if ($(node).css(ruleName) === ruleValue)\n                                {\n                                    count++;\n                                }\n                            }\n\n                            if (count === rules.length)\n                            {\n                                return 1;\n                            }\n                        }\n                        else if (nodeAttrValue === value)\n                        {\n                            return 1;\n                        }\n                    }\n\n                    return 0;\n\n                },\n    \t\t\tisConvertable: function(node, nodeTag, tag, params)\n    \t\t\t{\n                    if (nodeTag === tag)\n                    {\n                        if (params)\n                        {\n                            var count = 0;\n                            for (var key in params.data)\n                            {\n                                count += this.inline.isConvertableAttr(node, key, params.data[key]);\n                            }\n\n                            if (count === Object.keys(params.data).length)\n                            {\n                                return true;\n                            }\n                        }\n                        else\n                        {\n                            return true;\n                        }\n                    }\n\n                    return false;\n    \t\t\t},\n    \t\t\tsetNodesStriked: function(nodes, tag, params)\n    \t\t\t{\n                    for (var i = 0; i < nodes.length; i++)\n\t\t\t\t\t{\n                        var nodeTag = (nodes[i].tagName) ? nodes[i].tagName.toLowerCase() : undefined;\n\n                        var parent = nodes[i].parentNode;\n                        var parentTag = (parent && parent.tagName) ? parent.tagName.toLowerCase() : undefined;\n\n                        var convertable = this.inline.isConvertable(parent, parentTag, tag, params);\n                        if (convertable)\n                        {\n                            var $el = $(parent).replaceWith(function()\n                            {\n                                return $('<strike>').append($(this).contents());\n                            });\n\n                            $el.attr('data-redactor-inline-converted');\n                        }\n\n                        var convertable = this.inline.isConvertable(nodes[i], nodeTag, tag, params);\n                        if (convertable)\n                        {\n                            var $el = $(nodes[i]).replaceWith(function()\n                            {\n                                return $('<strike>').append($(this).contents());\n                            });\n                        }\n    \t\t\t\t}\n    \t\t\t},\n                insertBreakpoint: function(inline, currentTag)\n\t\t\t\t{\n\t\t\t\t\tvar breakpoint = document.createElement('span');\n\t\t\t\t\tbreakpoint.id = 'redactor-inline-breakpoint';\n\t\t\t\t\tbreakpoint = this.insert.node(breakpoint);\n\n\t\t\t\t\tvar end = this.utils.isEndOfElement(inline);\n\t\t\t\t\tvar code = this.utils.getOuterHtml(inline);\n\t\t\t\t\tvar endTag = (end) ? '' : '<' + currentTag + '>';\n\n                    code = code.replace(/<span id=\"redactor-inline-breakpoint\"><\\/span>/i, \"</\" + currentTag + \">\" + endTag);\n\n\t\t\t\t\tvar $code = $(code);\n\t\t\t\t\t$(inline).replaceWith($code);\n\n\t\t\t\t\tif (endTag !== '')\n\t\t\t\t\t{\n    \t\t\t\t\tthis.utils.cloneAttributes(inline, $code.last());\n\t\t\t\t\t}\n\n\t\t\t\t\treturn $code.first();\n\t\t\t\t},\n                insertInline: function(tag)\n\t\t\t\t{\n\t\t\t\t\tvar node = document.createElement(tag);\n\n\t\t\t\t\tthis.insert.node(node);\n\t\t\t\t\tthis.caret.start(node);\n\n\t\t\t\t\treturn node;\n\t\t\t\t},\n\t\t\t\tarrangeTag: function(tag)\n\t\t\t\t{\n                    var tags = ['b', 'bold', 'i', 'italic', 'underline', 'strikethrough', 'deleted', 'superscript', 'subscript'];\n\t\t\t\t\tvar replaced = ['strong', 'strong', 'em', 'em', 'u', 'del', 'del', 'sup', 'sub'];\n\n    \t\t\t\ttag = tag.toLowerCase();\n\n\t\t\t\t\tfor (var i = 0; i < tags.length; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (tag === tags[i])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttag = replaced[i];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn tag;\n\t\t\t\t},\n\t\t\t\tgetStyleParams: function(params)\n\t\t\t\t{\n                    var result = {};\n    \t\t\t\tvar rules = params.trim().replace(/;$/, '').split(';');\n    \t\t\t\tfor (var i = 0; i < rules.length; i++)\n    \t\t\t\t{\n        \t\t\t\tvar rule = rules[i].split(':');\n        \t\t\t\tif (rule)\n        \t\t\t\t{\n                            result[rule[0].trim()] = rule[1].trim();\n                        }\n    \t\t\t\t}\n\n    \t\t\t\treturn result;\n\t\t\t\t},\n\t\t\t\tgetParams: function(attr, value, type)\n\t\t\t\t{\n \t\t\t\t    var data = false;\n    \t\t\t\tvar func = 'toggle';\n    \t\t\t\tif (typeof attr === 'object')\n    \t\t\t\t{\n        \t\t\t\tdata = attr;\n        \t\t\t\tfunc = (value !== undefined) ? value : func;\n    \t\t\t\t}\n    \t\t\t\telse if (attr !== undefined && value !== undefined)\n    \t\t\t\t{\n        \t\t\t\tdata = {};\n        \t\t\t\tdata[attr] = value;\n        \t\t\t\tfunc = (type !== undefined) ? type : func;\n    \t\t\t\t}\n\n    \t\t\t\treturn (data) ? { 'func': func, 'data': data } : false;\n\t\t\t\t},\n\t\t\t\tsetParams: function(node, params)\n\t\t\t\t{\n                    if (params)\n                    {\n                        for (var key in params.data)\n                        {\n                            var $node = $(node);\n                            if (key === 'style')\n                            {\n                                node = this.inline[params.func + 'Style'](params.data[key], node);\n                                $node.attr('data-redactor-style-cache', $node.attr('style'));\n                            }\n                            else if (key === 'class')\n                            {\n                                node = this.inline[params.func + 'Class'](params.data[key], node);\n                            }\n                            // attr\n                            else\n                            {\n                                node = (params.func === 'remove') ? this.inline[params.func + 'Attr'](key, node) : this.inline[params.func + 'Attr'](key, params.data[key], node);\n                            }\n\n                            if (key === 'style' && node.tagName === 'SPAN')\n                            {\n                                $node.attr('data-redactor-span', true);\n                            }\n                        }\n                    }\n\n                    return node;\n\t\t\t\t},\n\n                // Each\n                eachInline: function(node, callback)\n                {\n                    var lastNode;\n                    var nodes = (node === undefined) ? this.selection.inlines() : [node];\n    \t\t\t\tif (nodes)\n    \t\t\t\t{\n        \t\t\t\tfor (var i = 0; i < nodes.length; i++)\n        \t\t\t\t{\n            \t\t\t\tlastNode = callback(nodes[i])[0];\n        \t\t\t\t}\n    \t\t\t\t}\n\n    \t\t\t\treturn lastNode;\n                },\n\n                // Class\n                replaceClass: function(value, node)\n\t\t\t\t{\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n                        return $(el).removeAttr('class').addClass(value);\n    \t\t\t\t});\n\t\t\t\t},\n\t\t\t\ttoggleClass: function(value, node)\n\t\t\t\t{\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n                        return $(el).toggleClass(value);\n    \t\t\t\t});\n\t\t\t\t},\n\t\t\t\taddClass: function(value, node)\n\t\t\t\t{\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n                        return $(el).addClass(value);\n    \t\t\t\t});\n\t\t\t\t},\n\t\t\t\tremoveClass: function(value, node)\n\t\t\t\t{\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n                        return $(el).removeClass(value);\n    \t\t\t\t});\n\t\t\t\t},\n\t\t\t\tremoveAllClass: function(node)\n\t\t\t\t{\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n                        return $(el).removeAttr('class');\n    \t\t\t\t});\n\t\t\t\t},\n\n\t\t\t\t// Attr\n\t\t\t\treplaceAttr: function(name, value, node)\n\t\t\t\t{\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n                        return $(el).removeAttr(name).attr(name. value);\n    \t\t\t\t});\n\t\t\t\t},\n\t\t\t\ttoggleAttr: function(name, value, node)\n\t\t\t\t{\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n        \t\t\t\tvar attr = $(el).attr(name);\n\n        \t\t\t\treturn (attr) ? $(el).removeAttr(name) : $(el).attr(name. value);\n    \t\t\t\t});\n\t\t\t\t},\n\t\t\t\taddAttr: function(name, value, node)\n\t\t\t\t{\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n                        return $(el).attr(name, value);\n    \t\t\t\t});\n\t\t\t\t},\n\t\t\t\tremoveAttr: function(name, node)\n\t\t\t\t{\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n        \t\t\t\tvar $el = $(el);\n\n                        $el.removeAttr(name);\n                        if (name === 'style')\n                        {\n        \t\t\t\t    $el.removeAttr('data-redactor-style-cache');\n        \t\t\t\t}\n\n                        return $el;\n    \t\t\t\t});\n\t\t\t\t},\n\t\t\t\tremoveAllAttr: function(node)\n\t\t\t\t{\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n        \t\t\t\tvar $el = $(el);\n                        var len = el.attributes.length;\n\t\t\t\t\t\tfor (var z = 0; z < len; z++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$el.removeAttr(el.attributes[z].name);\n\t\t\t\t\t\t}\n\n                        return $el;\n    \t\t\t\t});\n\t\t\t\t},\n\t\t\t\tremoveSpecificAttr: function(node, key, value)\n\t\t\t\t{\n    \t\t\t\tvar $el = $(node);\n    \t\t\t\tif (key === 'style')\n    \t\t\t\t{\n        \t\t\t\tvar arr = value.split(':');\n        \t\t\t\tvar name = arr[0].trim();\n                        $el.css(name, '');\n\n                        if (this.utils.removeEmptyAttr(node, 'style'))\n                        {\n                            $el.removeAttr('data-redactor-style-cache');\n                        }\n    \t\t\t\t}\n    \t\t\t\telse\n    \t\t\t\t{\n        \t\t\t\t$el.removeAttr(key)[0];\n    \t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\t// Style\n\t\t\t\thasParentStyle: function($el)\n\t\t\t\t{\n                    var $parent = $el.parent();\n\n                    return ($parent.length === 1 && $parent[0].tagName === $el[0].tagName && $parent.html() === $el[0].outerHTML) ? $parent : false;\n\t\t\t\t},\n\t\t\t\taddParentStyle: function($el)\n\t\t\t\t{\n                    var $parent = this.inline.hasParentStyle($el);\n                    if ($parent)\n                    {\n                        var style = this.inline.getStyleParams($el.attr('style'));\n                        $parent.css(style);\n                        $parent.attr('data-redactor-style-cache', $parent.attr('style'));\n\n                        $el.replaceWith(function()\n                        {\n                            return $(this).contents();\n                        });\n                    }\n                    else\n                    {\n                        $el.attr('data-redactor-style-cache', $el.attr('style'));\n                    }\n\n                    return $el;\n\t\t\t\t},\n\t\t\t\treplaceStyle: function(params, node)\n\t\t\t\t{\n    \t\t\t\tparams = this.inline.getStyleParams(params);\n\n                    var self = this;\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n        \t\t\t\tvar $el = $(el);\n                        $el.removeAttr('style').css(params);\n\n                        var style = $el.attr('style');\n                        if (style) $el.attr('style', style.replace(/\"/g, '\\''));\n\n                        $el = self.inline.addParentStyle($el);\n\n                        return $el;\n    \t\t\t\t});\n\t\t\t\t},\n\t\t\t\ttoggleStyle: function(params, node)\n\t\t\t\t{\n    \t\t\t\tparams = this.inline.getStyleParams(params);\n\n                    var self = this;\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n        \t\t\t\tvar $el = $(el);\n\n                        for (var key in params)\n                        {\n                            var newVal = params[key];\n                            var oldVal = $el.css(key);\n\n                            oldVal = (self.utils.isRgb(oldVal)) ? self.utils.rgb2hex(oldVal) : oldVal.replace(/\"/g, '');\n                            newVal = (self.utils.isRgb(newVal)) ? self.utils.rgb2hex(newVal) : newVal.replace(/\"/g, '');\n\n                            if (oldVal === newVal)\n                            {\n                                $el.css(key, '');\n                            }\n                            else\n                            {\n                                $el.css(key, newVal);\n                            }\n                        }\n\n                        var style = $el.attr('style');\n                        if (style) $el.attr('style', style.replace(/\"/g, '\\''));\n\n                        if (!self.utils.removeEmptyAttr(el, 'style'))\n                        {\n                            $el = self.inline.addParentStyle($el);\n                        }\n                        else\n                        {\n                            $el.removeAttr('data-redactor-style-cache');\n                        }\n\n\n                        return $el;\n    \t\t\t\t});\n\t\t\t\t},\n\t\t\t\taddStyle: function(params, node)\n\t\t\t\t{\n                    params = this.inline.getStyleParams(params);\n\n                    var self = this;\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n                        var $el = $(el);\n\n                        $el.css(params);\n\n                        var style = $el.attr('style');\n                        if (style) $el.attr('style', style.replace(/\"/g, '\\''));\n\n                        $el = self.inline.addParentStyle($el);\n\n                        return $el;\n    \t\t\t\t});\n\t\t\t\t},\n\t\t\t\tremoveStyle: function(params, node)\n\t\t\t\t{\n    \t\t\t\tparams = this.inline.getStyleParams(params);\n\n                    var self = this;\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n        \t\t\t\tvar $el = $(el);\n\n                        for (var key in params)\n                        {\n                            $el.css(key, '');\n                        }\n\n                        if (self.utils.removeEmptyAttr(el, 'style'))\n                        {\n                            $el.removeAttr('data-redactor-style-cache');\n                        }\n                        else\n                        {\n                            $el.attr('data-redactor-style-cache', $el.attr('style'));\n                        }\n\n                        return $el;\n    \t\t\t\t});\n\t\t\t\t},\n\t\t\t\tremoveAllStyle: function(node)\n\t\t\t\t{\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n                        return $(el).removeAttr('style').removeAttr('data-redactor-style-cache');\n    \t\t\t\t});\n\t\t\t\t},\n                removeStyleRule: function(name)\n\t\t\t\t{\n\t\t\t\t\tvar parent = this.selection.parent();\n\t\t\t\t\tvar nodes = this.selection.inlines();\n\n                    this.buffer.set();\n\n\t\t\t\t\tif (parent && parent.tagName === 'SPAN')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.inline.removeStyleRuleAttr($(parent), name);\n\t\t\t\t\t}\n\n                    for (var i = 0; i < nodes.length; i++)\n\t\t\t\t\t{\n    \t\t\t\t\tvar el = nodes[i];\n\t\t\t\t\t\tvar $el = $(el);\n\t\t\t\t\t\tif ($.inArray(el.tagName.toLowerCase(), this.opts.inlineTags) != -1 && !$el.hasClass('redactor-selection-marker'))\n\t\t\t\t\t\t{\n                            this.inline.removeStyleRuleAttr($el, name);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tremoveStyleRuleAttr: function($el, name)\n\t\t\t\t{\n                    $el.css(name, '');\n\t\t\t\t\tif (this.utils.removeEmptyAttr($el, 'style'))\n\t\t\t\t\t{\n\t\t\t\t\t\t$el.removeAttr('data-redactor-style-cache');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n    \t\t\t\t\t$el.attr('data-redactor-style-cache', $el.attr('style'));\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\t// Update\n\t\t\t\tupdate: function(tag, attr, value, type)\n\t\t\t\t{\n                    tag = this.inline.arrangeTag(tag);\n\n\t\t\t\t\tvar params = this.inline.getParams(attr, value, type);\n\t\t\t\t\tvar nodes = this.selection.inlines();\n\t\t\t\t\tvar result = [];\n\n                    if (nodes)\n                    {\n                        for (var i = 0; i < nodes.length; i++)\n                        {\n                            var el = nodes[i];\n                            if (tag === '*' || el.tagName.toLowerCase() === tag)\n                            {\n    \t\t\t\t\t\t    result.push(this.inline.setParams(el, params));\n    \t\t\t\t\t\t}\n                        }\n                    }\n\n                    return result;\n\t\t\t\t},\n\n                // All\n\t\t\t\tremoveFormat: function()\n\t\t\t\t{\n    \t\t\t\tthis.selection.save();\n\n    \t\t\t\tvar nodes = this.inline.getClearedNodes();\n    \t\t\t\tfor (var i = 0; i < nodes.length; i++)\n    \t\t\t\t{\n        \t\t\t\tif (nodes[i].nodeType === 1)\n        \t\t\t\t{\n            \t\t\t\t$(nodes[i]).replaceWith(function()\n                            {\n                                return $(this).contents();\n                            });\n        \t\t\t\t}\n    \t\t\t\t}\n\n    \t\t\t\tthis.selection.restore();\n\t\t\t\t}\n\n\t\t\t};\n\t\t},\n\n\t\t// =insert\n\t\tinsert: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tset: function(html)\n\t\t\t\t{\n\t\t\t\t\tthis.placeholder.hide();\n\n\t\t\t\t\tthis.code.set(html);\n\t\t\t\t\tthis.focus.end();\n\n\t\t\t\t\tthis.placeholder.enable();\n\t\t\t\t},\n\t\t\t\thtml: function(html, data)\n\t\t\t\t{\n\t\t\t\t\tthis.placeholder.hide();\n\t\t\t\t\tthis.core.editor().focus();\n\n\t\t\t\t\tvar block = this.selection.block();\n\t\t\t\t\tvar inline = this.selection.inline();\n\n\t\t\t\t\t// clean\n\t\t\t\t\tif (typeof data === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tdata = this.clean.getCurrentType(html, true);\n\t\t\t\t\t\thtml = this.clean.onPaste(html, data, true);\n\t\t\t\t\t}\n\n\t\t\t\t\thtml = $.parseHTML(html);\n\n                    // end node\n                    var endNode = $(html).last();\n\n\t\t\t\t\t// delete selected content\n\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\tvar range = this.selection.range(sel);\n\t\t\t\t\trange.deleteContents();\n\n\t\t\t\t\tthis.selection.update(sel, range);\n\n\t\t\t\t\t// insert list in list\n\t\t\t\t\tif (data.lists)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $list = $(html);\n\t\t\t\t\t\tif ($list.length !== 0 && ($list[0].tagName === 'UL' || $list[0].tagName === 'OL'))\n\t\t\t\t\t\t{\n\n\t\t\t\t\t\t\tthis.insert.appendLists(block, $list);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (data.blocks && block)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.utils.isSelectAll())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.core.editor().html(html);\n\t\t\t\t\t\t\tthis.focus.end();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar breaked = this.utils.breakBlockTag();\n\t\t\t\t\t\t\tif (breaked === false)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.insert.placeHtml(html);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n    \t\t\t\t\t\t\tvar $last = $(html).children().last();\n\t\t\t\t\t\t\t\t$last.append(this.marker.get());\n\n\t\t\t\t\t\t\t\tif (breaked.type === 'start')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tbreaked.$block.before(html);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tbreaked.$block.after(html);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\t\t\t\tthis.core.editor().find('p').each(function()\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tif ($.trim(this.innerHTML) === '')\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tif (inline)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t// remove same tag inside\n\t\t\t\t\t\t\tvar $div = $(\"<div/>\").html(html);\n\t\t\t\t\t\t\t$div.find(inline.tagName.toLowerCase()).each(function()\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$(this).contents().unwrap();\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\thtml = $div.html();\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.utils.isSelectAll())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar $node = $(this.opts.emptyHtml);\n\t\t\t\t\t\t\tthis.core.editor().html('').append($node);\n\t\t\t\t\t\t\t$node.html(html);\n\t\t\t\t\t\t\tthis.caret.end($node);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.insert.placeHtml(html);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.utils.disableSelectAll();\n\n\t\t\t\t\tif (data.pre) this.clean.cleanPre();\n\n                    this.caret.end(endNode);\n                    this.linkify.format();\n\t\t\t\t},\n\t\t\t\ttext: function(text)\n\t\t\t\t{\n\t\t\t\t\ttext = text.toString();\n\t\t\t\t\ttext = $.trim(text);\n\n\t\t\t\t\tvar tmp = document.createElement('div');\n\t\t\t\t\ttmp.innerHTML = text;\n\t\t\t\t\ttext = tmp.textContent || tmp.innerText;\n\n\t\t\t\t\tif (typeof text === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.placeholder.hide();\n\t\t\t\t\tthis.core.editor().focus();\n\n\t\t\t\t\t// blocks\n\t\t\t\t\tvar blocks = this.selection.blocks();\n\n\t\t\t\t\t// nl to spaces\n\t\t\t\t\ttext = text.replace(/\\n/g, ' ');\n\n\t\t\t\t\t// select all\n\t\t\t\t\tif (this.utils.isSelectAll())\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $node = $(this.opts.emptyHtml);\n\t\t\t\t\t\tthis.core.editor().html('').append($node);\n\t\t\t\t\t\t$node.html(text);\n\t\t\t\t\t\tthis.caret.end($node);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t// insert\n\t\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\t\tvar node = document.createTextNode(text);\n\n\t\t\t\t\t\tif (sel.getRangeAt && sel.rangeCount)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar range = sel.getRangeAt(0);\n\t\t\t\t\t\t\trange.deleteContents();\n\t\t\t\t\t\t\trange.insertNode(node);\n\t\t\t\t\t\t\trange.setStartAfter(node);\n\t\t\t\t\t\t\trange.collapse(true);\n\n\t\t\t\t\t\t\tthis.selection.update(sel, range);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// wrap node if selected two or more block tags\n\t\t\t\t\t\tif (blocks.length > 1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(node).wrap('<p>');\n\t\t\t\t\t\t\tthis.caret.after(node);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.utils.disableSelectAll();\n\t\t\t\t\tthis.linkify.format();\n\t\t\t\t\tthis.clean.normalizeCurrentHeading();\n\n\t\t\t\t},\n\t\t\t\traw: function(html)\n\t\t\t\t{\n\t\t\t\t\tthis.placeholder.hide();\n\t\t\t\t\tthis.core.editor().focus();\n\n\t\t\t\t\tvar sel = this.selection.get();\n\n\t\t\t\t\tvar range = this.selection.range(sel);\n\t\t\t\t\trange.deleteContents();\n\n\t\t            var el = document.createElement(\"div\");\n\t\t            el.innerHTML = html;\n\n\t\t            var frag = document.createDocumentFragment(), node, lastNode;\n\t\t            while ((node = el.firstChild))\n\t\t            {\n\t\t                lastNode = frag.appendChild(node);\n\t\t            }\n\n\t\t            range.insertNode(frag);\n\n\t\t\t\t\tif (lastNode)\n\t\t\t\t\t{\n\t\t\t\t\t\trange = range.cloneRange();\n\t\t\t\t\t\trange.setStartAfter(lastNode);\n\t\t\t\t\t\trange.collapse(true);\n\t\t\t\t\t\tsel.removeAllRanges();\n\t\t\t\t\t\tsel.addRange(range);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tnode: function(node, deleteContent)\n\t\t\t\t{\n\t\t\t\t\tthis.placeholder.hide();\n\n\t\t\t\t\tif (typeof this.start !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().focus();\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = node[0] || node;\n\n\t\t\t\t\tvar block = this.selection.block();\n\t\t\t\t\tvar gap = this.utils.isBlockTag(node.tagName);\n\t\t\t\t\tvar result = true;\n\n\t\t\t\t\tif (this.utils.isSelectAll())\n\t\t\t\t\t{\n\t\t\t\t\t\tif (gap)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.core.editor().html(node);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.core.editor().html($('<p>').html(node));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.code.sync();\n\t\t\t\t\t}\n\t\t\t\t\telse if (gap && block)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar breaked = this.utils.breakBlockTag();\n\t\t\t\t\t\tif (breaked === false)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.insert.placeNode(node, deleteContent);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (breaked.type === 'start')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbreaked.$block.before(node);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbreaked.$block.after(node);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.core.editor().find('p:empty').remove();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tresult = this.insert.placeNode(node, deleteContent);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.utils.disableSelectAll();\n\n\t\t\t\t\tif (result)\n\t\t\t\t\t{\n\t\t\t\t\t    this.caret.end(node);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn node;\n\n\t\t\t\t},\n\t\t\t\tappendLists: function(block, $list)\n\t\t\t\t{\n\t\t\t\t\tvar $block = $(block);\n\t\t\t\t\tvar last;\n\t\t\t\t\tvar isEmpty = this.utils.isEmpty(block.innerHTML);\n\n\t\t\t\t\tif (isEmpty || this.utils.isEndOfElement(block))\n\t\t\t\t\t{\n\t\t\t\t\t\tlast = $block;\n\t\t\t\t\t\t$list.find('li').each(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlast.after(this);\n\t\t\t\t\t\t\tlast = $(this);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (isEmpty)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$block.remove();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (this.utils.isStartOfElement(block))\n\t\t\t\t\t{\n\t\t\t\t\t\t$list.find('li').each(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$block.before(this);\n\t\t\t\t\t\t\tlast = $(this);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t        var endOfNode = this.selection.extractEndOfNode(block);\n\n\t\t\t\t        $block.after($('<li>').append(endOfNode));\n\t\t\t\t        $block.append($list);\n\t\t\t\t\t\tlast = $list;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.marker.remove();\n\n\t\t\t\t\tif (last)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.caret.end(last);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.linkify.format();\n\t\t\t\t},\n\t\t\t\tplaceHtml: function(html)\n\t\t\t\t{\n\t\t\t\t\tvar marker = document.createElement('span');\n\t\t\t\t\tmarker.id = 'redactor-insert-marker';\n\t\t\t\t\tmarker = this.insert.node(marker);\n\n\t\t\t\t\t$(marker).before(html);\n\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\tthis.caret.after(marker);\n\t\t\t\t\t$(marker).remove();\n\t\t\t\t},\n\t\t\t\tplaceNode: function(node, deleteContent)\n\t\t\t\t{\n\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\tvar range = this.selection.range(sel);\n\t\t\t\t\tif (range == null)\n\t\t\t\t\t{\n    \t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (deleteContent !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\trange.deleteContents();\n\t\t\t\t\t}\n\n\t\t\t\t\trange.insertNode(node);\n\t\t\t\t\trange.collapse(false);\n\n\t\t\t\t\tthis.selection.update(sel, range);\n\t\t\t\t},\n\t\t\t\tnodeToPoint: function(e, node)\n\t\t\t\t{\n\t\t\t\t\tthis.placeholder.hide();\n\n\t\t\t\t\tnode = node[0] || node;\n\n\t\t\t\t\tif (this.utils.isEmpty())\n\t\t\t\t\t{\n\t\t\t\t\t\tnode = (this.utils.isBlock(node)) ? node : $('<p />').append(node);\n\n\t\t\t\t\t\tthis.core.editor().html(node);\n\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar range;\n\t\t\t\t\tvar x = e.clientX, y = e.clientY;\n\t\t\t\t\tif (document.caretPositionFromPoint)\n\t\t\t\t\t{\n\t\t\t\t\t    var pos = document.caretPositionFromPoint(x, y);\n\t\t\t\t\t    var sel = document.getSelection();\n\t\t\t\t\t    range = sel.getRangeAt(0);\n\t\t\t\t\t    range.setStart(pos.offsetNode, pos.offset);\n\t\t\t\t\t    range.collapse(true);\n\t\t\t\t\t    range.insertNode(node);\n\t\t\t\t\t}\n\t\t\t\t\telse if (document.caretRangeFromPoint)\n\t\t\t\t\t{\n\t\t\t\t\t    range = document.caretRangeFromPoint(x, y);\n\t\t\t\t\t    range.insertNode(node);\n\t\t\t\t\t}\n\t\t\t\t\telse if (typeof document.body.createTextRange !== \"undefined\")\n\t\t\t\t\t{\n\t\t\t\t        range = document.body.createTextRange();\n\t\t\t\t        range.moveToPoint(x, y);\n\t\t\t\t        var endRange = range.duplicate();\n\t\t\t\t        endRange.moveToPoint(x, y);\n\t\t\t\t        range.setEndPoint(\"EndToEnd\", endRange);\n\t\t\t\t        range.select();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn node;\n\n\t\t\t\t},\n\n\t\t\t\t// #backward\n\t\t\t\tnodeToCaretPositionFromPoint: function(e, node)\n\t\t\t\t{\n\t\t\t\t\tthis.insert.nodeToPoint(e, node);\n\t\t\t\t},\n\t\t\t\tmarker: function()\n\t\t\t\t{\n\t\t\t\t\tthis.marker.insert();\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =keydown\n\t\tkeydown: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tinit: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (this.rtePaste)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar key = e.which;\n\t\t\t\t\tvar arrow = (key >= 37 && key <= 40);\n\n\t\t\t\t\tthis.keydown.ctrl = e.ctrlKey || e.metaKey;\n\t\t\t\t\tthis.keydown.parent = this.selection.parent();\n\t\t\t\t\tthis.keydown.current = this.selection.current();\n\t\t\t\t\tthis.keydown.block = this.selection.block();\n\n\t\t\t        // detect tags\n\t\t\t\t\tthis.keydown.pre = this.utils.isTag(this.keydown.current, 'pre');\n\t\t\t\t\tthis.keydown.blockquote = this.utils.isTag(this.keydown.current, 'blockquote');\n\t\t\t\t\tthis.keydown.figcaption = this.utils.isTag(this.keydown.current, 'figcaption');\n\t\t\t\t\tthis.keydown.figure = this.utils.isTag(this.keydown.current, 'figure');\n\n\t\t\t\t\t// callback\n\t\t\t\t\tvar keydownStop = this.core.callback('keydown', e);\n\t\t\t\t\tif (keydownStop === false)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// shortcuts setup\n\t\t\t\t\tthis.shortcuts.init(e, key);\n\n\t\t\t\t\t// buffer\n\t\t\t\t\tthis.keydown.checkEvents(arrow, key);\n                    this.keydown.setupBuffer(e, key);\n\n\t\t\t\t\tif (this.utils.isSelectAll() && ( key === this.keyCode.ENTER || key === this.keyCode.BACKSPACE || key === this.keyCode.DELETE))\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\tthis.code.set(this.opts.emptyHtml);\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.keydown.addArrowsEvent(arrow);\n\t\t\t\t\tthis.keydown.setupSelectAll(e, key);\n\n\t\t\t\t\t// turn off enter key\n\t\t\t\t\tif (!this.opts.enterKey && key === this.keyCode.ENTER)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\t// remove selected\n\t\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\t\tvar range = this.selection.range(sel);\n\n\t\t\t\t\t\tif (!range.collapsed)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\trange.deleteContents();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// down\n\t\t\t\t\tif (this.opts.enterKey && key === this.keyCode.DOWN)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.keydown.onArrowDown();\n\t\t\t\t\t}\n\n\t\t\t\t\t// up\n\t\t\t\t\tif (this.opts.enterKey && key === this.keyCode.UP)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.keydown.onArrowUp();\n\t\t\t\t\t}\n\n\n\t\t\t\t\t// replace to p before / after the table or into body\n\t\t\t\t\tif ((this.opts.type === 'textarea' || this.opts.type === 'div') && this.keydown.current && this.keydown.current.nodeType === 3 && $(this.keydown.parent).hasClass('redactor-in'))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.keydown.wrapToParagraph();\n\t\t\t\t\t}\n\n\t\t\t\t\t// on Shift+Space or Ctrl+Space\n\t\t\t\t\tif (!this.keyup.lastShiftKey && key === this.keyCode.SPACE && (e.ctrlKey || e.shiftKey))\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\treturn this.keydown.onShiftSpace();\n\t\t\t\t\t}\n\n\t\t\t\t\t// on Shift+Enter or Ctrl+Enter\n\t\t\t\t\tif (key === this.keyCode.ENTER && (e.ctrlKey || e.shiftKey))\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\treturn this.keydown.onShiftEnter(e);\n\t\t\t\t\t}\n\n\t\t\t\t\t// on enter\n\t\t\t\t\tif (key === this.keyCode.ENTER && !e.shiftKey && !e.ctrlKey && !e.metaKey)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.keydown.onEnter(e);\n\t\t\t\t\t}\n\n\t\t\t\t\t// tab or cmd + [\n\t\t\t\t\tif (key === this.keyCode.TAB || e.metaKey && key === 221 || e.metaKey && key === 219)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.keydown.onTab(e, key);\n\t\t\t\t\t}\n\n                    // firefox bugfix\n\t\t\t\t\tif (this.detect.isFirefox() && key === this.keyCode.BACKSPACE && this.keydown.block && this.keydown.block.tagName === 'P' && this.utils.isStartOfElement(this.keydown.block))\n\t\t\t\t\t{\n    \t\t\t\t\tvar $prev = $(this.keydown.block).prev();\n    \t\t\t\t\tif ($prev.length !== 0)\n    \t\t\t\t\t{\n        \t\t\t\t\te.preventDefault();\n\n        \t\t\t\t\t$prev.append(this.marker.get());\n        \t\t\t\t\t$prev.append($(this.keydown.block).html());\n        \t\t\t\t\t$(this.keydown.block).remove();\n\n                            this.selection.restore();\n\n        \t\t\t\t\treturn;\n    \t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// backspace & delete\n\t\t\t\t\tif (key === this.keyCode.BACKSPACE || key === this.keyCode.DELETE)\n\t\t\t\t\t{\n    \t\t\t\t\tif (this.observe.image && typeof this.observe.image !== 'undefined' && $('#redactor-image-box').length !== 0)\n    \t\t\t\t\t{\n        \t\t\t\t\te.preventDefault();\n\n        \t\t\t\t\tvar $prev = this.observe.image.closest('figure, p').prev()\n        \t\t\t\t\tthis.image.remove(false);\n                            this.observe.image = false;\n\n        \t\t\t\t\tif ($prev && $prev.length !== 0)\n        \t\t\t\t\t{\n            \t\t\t\t\tthis.caret.end($prev);\n        \t\t\t\t\t}\n        \t\t\t\t\telse\n        \t\t\t\t\t{\n            \t\t\t\t\tthis.core.editor().focus();\n        \t\t\t\t\t}\n\n        \t\t\t\t\treturn;\n    \t\t\t\t\t}\n\n\t\t\t\t\t\tthis.keydown.onBackspaceAndDeleteBefore();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (key === this.keyCode.DELETE)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $next = $(this.keydown.block).next();\n\n\t\t\t\t\t\t// delete figure\n\t\t\t\t\t\tif (this.utils.isEndOfElement(this.keydown.block) && $next.length !== 0 && $next[0].tagName === 'FIGURE')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$next.remove();\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// append list (safari bug)\n\t\t\t\t\t\tvar tagLi = (this.keydown.block && this.keydown.block.tagName === 'LI') ? this.keydown.block : false;\n\t\t\t\t\t\tif (tagLi)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar $list = $(this.keydown.block).parents('ul, ol').last();\n\t\t\t\t\t\t\tvar $nextList = $list.next();\n\n\t\t\t\t\t\t\tif (this.utils.isRedactorParent($list) && this.utils.isEndOfElement($list) && $nextList.length !== 0\n\t\t\t\t\t\t\t\t&& ($nextList[0].tagName === 'UL' || $nextList[0].tagName === 'OL'))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\t\t\t$list.append($nextList.contents());\n\t\t\t\t\t\t\t\t$nextList.remove();\n\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// append pre\n\t\t\t\t\t\tif (this.utils.isEndOfElement(this.keydown.block) && $next.length !== 0 && $next[0].tagName === 'PRE')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(this.keydown.block).append($next.text());\n\t\t\t\t\t\t\t$next.remove();\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// image delete\n\t\t\t\t\tif (key === this.keyCode.DELETE && $('#redactor-image-box').length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.image.remove();\n\t\t\t\t\t}\n\n\t\t\t\t\t// backspace\n\t\t\t\t\tif (key === this.keyCode.BACKSPACE)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.detect.isFirefox())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.line.removeOnBackspace(e);\n\t\t\t\t\t\t}\n\n                        // combine list after and before if paragraph is empty\n                        if (this.list.combineAfterAndBefore(this.keydown.block))\n                        {\n                            e.preventDefault();\n                            return;\n                        }\n\n\t\t\t\t\t\t// backspace as outdent\n\t\t\t\t\t\tvar block = this.selection.block();\n\t\t\t\t\t\tif (block && block.tagName === 'LI' && this.utils.isCollapsed() && this.utils.isStartOfElement())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.indent.decrease();\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.keydown.removeInvisibleSpace();\n\t\t\t\t\t\tthis.keydown.removeEmptyListInTable(e);\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif (key === this.keyCode.BACKSPACE || key === this.keyCode.DELETE)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.keydown.onBackspaceAndDeleteAfter(e);\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tonShiftSpace: function()\n\t\t\t\t{\n\t\t\t\t\tthis.buffer.set();\n\t\t\t\t\tthis.insert.raw('&nbsp;');\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\tonShiftEnter: function(e)\n\t\t\t\t{\n\t\t\t\t\tthis.buffer.set();\n\n\t\t\t\t\treturn (this.keydown.pre) ? this.keydown.insertNewLine(e) : this.insert.raw('<br>');\n\t\t\t\t},\n\t\t\t\tonBackspaceAndDeleteBefore: function()\n\t\t\t\t{\n\t\t\t\t\tthis.utils.saveScroll();\n\t\t\t\t},\n\t\t\t\tonBackspaceAndDeleteAfter: function(e)\n\t\t\t\t{\n\t\t\t\t\t// remove style tag\n\t\t\t\t\tsetTimeout($.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.code.syncFire = false;\n\t\t\t\t\t\tthis.keydown.removeEmptyLists();\n\n                        var filter = '';\n                        if (this.opts.keepStyleAttr.length !== 0)\n                        {\n                            filter = ',' + this.opts.keepStyleAttr.join(',');\n                        }\n\n\t\t\t\t\t\tvar $styleTags = this.core.editor().find('*[style]');\n\t\t\t\t\t\t$styleTags.not('img, figure, iframe, #redactor-image-box, #redactor-image-editter, [data-redactor-style-cache], [data-redactor-span]' + filter).removeAttr('style');\n\n\t\t\t\t\t\tthis.keydown.formatEmpty(e);\n\t\t\t\t\t\tthis.code.syncFire = true;\n\n\t\t\t\t\t}, this), 1);\n\t\t\t\t},\n\t\t\t\tonEnter: function(e)\n\t\t\t\t{\n\t\t\t\t\tvar stop = this.core.callback('enter', e);\n\t\t\t\t\tif (stop === false)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// blockquote exit\n\t\t\t\t\tif (this.keydown.blockquote && this.keydown.exitFromBlockquote(e) === true)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// pre\n\t\t\t\t\tif (this.keydown.pre)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.keydown.insertNewLine(e);\n\t\t\t\t\t}\n\t\t\t\t\t// blockquote & figcaption\n\t\t\t\t\telse if (this.keydown.blockquote || this.keydown.figcaption)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.keydown.insertBreakLine(e);\n\t\t\t\t\t}\n\t\t\t\t\t// figure\n\t\t\t\t\telse if (this.keydown.figure)\n\t\t\t\t\t{\n\t\t\t\t\t\tsetTimeout($.proxy(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.keydown.replaceToParagraph('FIGURE');\n\n\t\t\t\t\t\t}, this), 1);\n\t\t\t\t\t}\n\t\t\t\t\t// paragraphs\n\t\t\t\t\telse if (this.keydown.block)\n\t\t\t\t\t{\n\t\t\t\t\t\tsetTimeout($.proxy(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.keydown.replaceToParagraph('DIV');\n\n\t\t\t\t\t\t}, this), 1);\n\n\t\t\t\t\t\t// empty list exit\n\t\t\t\t\t\tif (this.keydown.block.tagName === 'LI')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar current = this.selection.current();\n\t\t\t\t\t\t\tvar $parent = $(current).closest('li', this.$editor[0]);\n\t\t\t\t\t\t\tvar $list = $parent.parents('ul,ol', this.$editor[0]).last();\n\n\t\t\t\t\t\t\tif ($parent.length !== 0 && this.utils.isEmpty($parent.html()) && $list.next().length === 0 && this.utils.isEmpty($list.find(\"li\").last().html()))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$list.find(\"li\").last().remove();\n\n\t\t\t\t\t\t\t\tvar node = $(this.opts.emptyHtml);\n\t\t\t\t\t\t\t\t$list.after(node);\n\t\t\t\t\t\t\t\tthis.caret.start(node);\n\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t\t// outside\n\t\t\t\t\telse if (!this.keydown.block)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.keydown.insertParagraph(e);\n\t\t\t\t\t}\n\n                    // firefox enter into inline element\n\t\t\t\t\tif (this.detect.isFirefox() && this.utils.isInline(this.keydown.parent))\n\t\t\t\t\t{\n                        this.keydown.insertBreakLine(e);\n                        return;\n                    }\n\n\n\t\t\t\t\t// remove inline tags in new-empty paragraph\n\t\t\t\t\tsetTimeout($.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tvar inline = this.selection.inline();\n\t\t\t\t\t\tif (inline && this.utils.isEmpty(inline.innerHTML))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar parent = this.selection.block();\n\t\t\t\t\t\t\t$(inline).remove();\n\t\t\t\t\t\t\t//this.caret.start(parent);\n\n                            var range = document.createRange();\n                            range.setStart(parent, 0);\n\n                            var textNode = document.createTextNode('\\u200B');\n\n                            range.insertNode(textNode);\n                            range.setStartAfter(textNode);\n                            range.collapse(true);\n\n                            var sel = window.getSelection();\n            \t\t\t\tsel.removeAllRanges();\n            \t\t\t\tsel.addRange(range);\n\t\t\t\t\t\t}\n\n\n\t\t\t\t\t}, this), 1);\n\t\t\t\t},\n\t\t\t\tcheckEvents: function(arrow, key)\n\t\t\t\t{\n\t\t\t\t\tif (!arrow && (this.core.getEvent() === 'click' || this.core.getEvent() === 'arrow'))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.addEvent(false);\n\n\t\t\t\t\t\tif (this.keydown.checkKeyEvents(key))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.buffer.set();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tcheckKeyEvents: function(key)\n\t\t\t\t{\n\t\t\t\t\tvar k = this.keyCode;\n\t\t\t\t\tvar keys = [k.BACKSPACE, k.DELETE, k.ENTER, k.ESC, k.TAB, k.CTRL, k.META, k.ALT, k.SHIFT];\n\n\t\t\t\t\treturn ($.inArray(key, keys) === -1) ? true : false;\n\n\t\t\t\t},\n\t\t\t\taddArrowsEvent: function(arrow)\n\t\t\t\t{\n\t\t\t\t\tif (!arrow)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ((this.core.getEvent() === 'click' || this.core.getEvent() === 'arrow'))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.addEvent(false);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t    this.core.addEvent('arrow');\n\t\t\t\t},\n\t\t\t\tsetupBuffer: function(e, key)\n\t\t\t\t{\n\t\t\t\t\tif (this.keydown.ctrl && key === 90 && !e.shiftKey && !e.altKey && this.opts.buffer.length) // z key\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tthis.buffer.undo();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t// redo\n\t\t\t\t\telse if (this.keydown.ctrl && key === 90 && e.shiftKey && !e.altKey && this.opts.rebuffer.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tthis.buffer.redo();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\telse if (!this.keydown.ctrl)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (key === this.keyCode.SPACE || key === this.keyCode.BACKSPACE || key === this.keyCode.DELETE || (key === this.keyCode.ENTER && !e.ctrlKey && !e.shiftKey))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.buffer.set();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\texitFromBlockquote: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (!this.utils.isEndOfElement(this.keydown.blockquote))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar tmp = this.clean.removeSpacesHard($(this.keydown.blockquote).html());\n\t\t\t\t\tif (tmp.search(/(<br\\s?\\/?>){1}$/i) !== -1)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\tvar $last = $(this.keydown.blockquote).children().last();\n\n\t\t\t\t\t\t$last.filter('br').remove();\n\t\t\t\t\t\t$(this.keydown.blockquote).children().last().filter('span').remove();\n\n\t\t\t\t\t\tvar node = $(this.opts.emptyHtml);\n\t\t\t\t\t\t$(this.keydown.blockquote).after(node);\n\t\t\t\t\t\tthis.caret.start(node);\n\n\t\t\t\t\t\treturn true;\n\n\t\t\t\t\t}\n\n\t\t\t\t\treturn;\n\t\t\t\t},\n\t\t\t\tonArrowDown: function()\n\t\t\t\t{\n\t\t\t\t\tvar tags = [this.keydown.blockquote, this.keydown.pre, this.keydown.figcaption];\n\n\t\t\t\t\tfor (var i = 0; i < tags.length; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (tags[i])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.keydown.insertAfterLastElement(tags[i]);\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonArrowUp: function()\n\t\t\t\t{\n\t\t\t\t\tvar tags = [this.keydown.blockquote, this.keydown.pre, this.keydown.figcaption];\n\n\t\t\t\t\tfor (var i = 0; i < tags.length; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (tags[i])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.keydown.insertBeforeFirstElement(tags[i]);\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tinsertAfterLastElement: function(element)\n\t\t\t\t{\n\t\t\t\t\tif (!this.utils.isEndOfElement(element))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar last = this.core.editor().contents().last();\n\t\t\t\t\tvar $next = (element.tagName === 'FIGCAPTION') ? $(this.keydown.block).parent().next() : $(this.keydown.block).next();\n\n\t\t\t\t\tif ($next.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\telse if (last.length === 0 && last[0] !== element)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.caret.start(last);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tvar node = $(this.opts.emptyHtml);\n\n\t\t\t\t\t\tif (element.tagName === 'FIGCAPTION')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t    $(element).parent().after(node);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n    \t\t\t\t\t\t$(element).after(node);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.caret.start(node);\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tinsertBeforeFirstElement: function(element)\n\t\t\t\t{\n\t\t\t\t\tif (!this.utils.isStartOfElement())\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.core.editor().contents().length > 1 && this.core.editor().contents().first()[0] !== element)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar node = $(this.opts.emptyHtml);\n\t\t\t\t\t$(element).before(node);\n\t\t\t\t\tthis.caret.start(node);\n\n\t\t\t\t},\n\t\t\t\tonTab: function(e, key)\n\t\t\t\t{\n\t\t\t\t\tif (!this.opts.tabKey)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar isList = (this.keydown.block && this.keydown.block.tagName === 'LI')\n\t\t\t\t\tif (this.utils.isEmpty(this.code.get()) || (!isList && !this.keydown.pre && this.opts.tabAsSpaces === false))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tthis.buffer.set();\n\n                    var isListStart = (isList && this.utils.isStartOfElement(this.keydown.block));\n\t\t\t\t\tvar node;\n\n\t\t\t\t\tif (this.keydown.pre && !e.shiftKey)\n\t\t\t\t\t{\n\t\t\t\t\t\tnode = (this.opts.preSpaces) ? document.createTextNode(Array(this.opts.preSpaces + 1).join('\\u00a0')) : document.createTextNode('\\t');\n\t\t\t\t\t\tthis.insert.node(node);\n\t\t\t\t\t}\n\t\t\t\t\telse if (this.opts.tabAsSpaces !== false && !isListStart)\n\t\t\t\t\t{\n\t\t\t\t\t\tnode = document.createTextNode(Array(this.opts.tabAsSpaces + 1).join('\\u00a0'));\n\t\t\t\t\t\tthis.insert.node(node);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tif (e.metaKey && key === 219)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.indent.decrease();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (e.metaKey && key === 221)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.indent.increase();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (!e.shiftKey)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.indent.increase();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.indent.decrease();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\tsetupSelectAll: function(e, key)\n\t\t\t\t{\n\t\t\t\t\tif (this.keydown.ctrl && key === 65)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.utils.enableSelectAll();\n\t\t\t\t\t}\n\t\t\t\t\telse if (key !== this.keyCode.LEFT_WIN && !this.keydown.ctrl)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.utils.disableSelectAll();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tinsertNewLine: function(e)\n\t\t\t\t{\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\tvar node = document.createTextNode('\\n');\n\n\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\tvar range = this.selection.range(sel);\n\n\t\t\t\t\trange.deleteContents();\n\t\t\t\t\trange.insertNode(node);\n\n\t\t\t\t\tthis.caret.after(node);\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\tinsertParagraph: function(e)\n\t\t\t\t{\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\tvar p = document.createElement('p');\n\t\t\t\t\t//p.innerHTML = this.opts.invisibleSpace;\n\t\t\t\t\tp.innerHTML = '<br>';\n\n\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\tvar range = this.selection.range(sel);\n\n\t\t\t\t\trange.deleteContents();\n\t\t\t\t\trange.insertNode(p);\n\n\t\t\t\t\tthis.caret.start(p);\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\tinsertBreakLine: function(e)\n\t\t\t\t{\n\t\t\t\t\treturn this.keydown.insertBreakLineProcessing(e);\n\t\t\t\t},\n\t\t\t\tinsertDblBreakLine: function(e)\n\t\t\t\t{\n\t\t\t\t\treturn this.keydown.insertBreakLineProcessing(e, true);\n\t\t\t\t},\n\t\t\t\tinsertBreakLineProcessing: function(e, dbl)\n\t\t\t\t{\n\t\t\t\t\te.stopPropagation();\n\n\t\t\t\t\tvar br1 = document.createElement('br');\n\t\t\t\t\tthis.insert.node(br1);\n\n\t\t\t\t\tif (dbl === true)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar br2 = document.createElement('br');\n\t\t\t\t\t\tthis.insert.node(br2);\n\t\t\t\t\t\tthis.caret.after(br2);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n    \t\t\t\t\tthis.caret.after(br1);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\n\t\t\t\t},\n\t\t\t\twrapToParagraph: function()\n\t\t\t\t{\n\t\t\t\t\tvar $current = $(this.keydown.current);\n\t\t\t\t\tvar\tnode = $('<p>').append($current.clone());\n\t\t\t\t\t$current.replaceWith(node);\n\n\t\t\t\t\tvar next = $(node).next();\n\t\t\t\t\tif (typeof(next[0]) !== 'undefined' && next[0].tagName === 'BR')\n\t\t\t\t\t{\n\t\t\t\t\t\tnext.remove();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.caret.end(node);\n\n\t\t\t\t},\n\t\t\t\treplaceToParagraph: function(tag)\n\t\t\t\t{\n\t\t\t\t\tvar blockElem = this.selection.block();\n\t\t\t\t\tvar $prev = $(blockElem).prev();\n\n\t\t\t\t\tvar blockHtml = blockElem.innerHTML.replace(/<br\\s?\\/?>/gi, '');\n\t\t\t\t\tif (blockElem.tagName === tag && this.utils.isEmpty(blockHtml) && !$(blockElem).hasClass('redactor-in'))\n\t\t\t\t\t{\n\t\t\t\t\t\tvar p = document.createElement('p');\n\t\t\t\t\t\t$(blockElem).replaceWith(p);\n\n                        this.keydown.setCaretToParagraph(p);\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\telse if (blockElem.tagName === 'P')\n\t\t\t\t\t{\n\t\t\t\t\t\t$(blockElem).removeAttr('class').removeAttr('style');\n\n\t\t\t\t\t\t// fix #227\n\t\t\t\t\t\tif (this.detect.isIe() && this.utils.isEmpty(blockHtml) && this.utils.isInline(this.keydown.parent))\n                        {\n                            $(blockElem).on('input', $.proxy(function()\n                            {\n                                var parent = this.selection.parent();\n                                if (this.utils.isInline(parent))\n                                {\n                                    var html = $(parent).html();\n                                    $(blockElem).html(html);\n                                    this.caret.end(blockElem);\n                                }\n\n                                $(blockElem).off('keyup');\n\n                            }, this));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\telse if ($prev.hasClass(this.opts.videoContainerClass))\n\t\t\t\t\t{\n    \t\t\t\t\t$prev.removeAttr('class');\n\n    \t\t\t\t\tvar p = document.createElement('p');\n\t\t\t\t\t\t$prev.replaceWith(p);\n\n\t\t\t\t\t\tthis.keydown.setCaretToParagraph(p);\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsetCaretToParagraph: function(p)\n\t\t\t\t{\n                    var range = document.createRange();\n                    range.setStart(p, 0);\n\n                    var textNode = document.createTextNode('\\u200B');\n\n                    range.insertNode(textNode);\n                    range.setStartAfter(textNode);\n                    range.collapse(true);\n\n                    var sel = window.getSelection();\n    \t\t\t\tsel.removeAllRanges();\n    \t\t\t\tsel.addRange(range);\n\t\t\t\t},\n\t\t\t\tremoveInvisibleSpace: function()\n\t\t\t\t{\n\t\t\t\t\tvar $current = $(this.keydown.current);\n\t\t\t\t\tif ($current.text().search(/^\\u200B$/g) === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t$current.remove();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tremoveEmptyListInTable: function(e)\n\t\t\t\t{\n\t\t\t\t\tvar $current = $(this.keydown.current);\n\t\t\t\t\tvar $parent = $(this.keydown.parent);\n\t\t\t\t\tvar td = $current.closest('td', this.$editor[0]);\n\n\t\t\t\t\tif (td.length !== 0 && $current.closest('li', this.$editor[0]) && $parent.children('li').length === 1)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!this.utils.isEmpty($current.text()))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\t$current.remove();\n\t\t\t\t\t\t$parent.remove();\n\n\t\t\t\t\t\tthis.caret.start(td);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tremoveEmptyLists: function()\n\t\t\t\t{\n\t\t\t\t\tvar removeIt = function()\n\t\t\t\t\t{\n\t\t\t\t\t\tvar html = $.trim(this.innerHTML).replace(/\\/t\\/n/g, '');\n\t\t\t\t\t\tif (html === '')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.core.editor().find('li').each(removeIt);\n\t\t\t\t\tthis.core.editor().find('ul, ol').each(removeIt);\n\t\t\t\t},\n\t\t\t\tformatEmpty: function(e)\n\t\t\t\t{\n\t\t\t\t\tvar html = $.trim(this.core.editor().html());\n\n\t\t\t\t\tif (!this.utils.isEmpty(html))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\tif (this.opts.type === 'inline' || this.opts.type === 'pre')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().html(this.marker.html());\n\t\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().html(this.opts.emptyHtml);\n\t\t\t\t\t\tthis.focus.start();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =keyup\n\t\tkeyup: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tinit: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (this.rtePaste)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar key = e.which;\n\t\t\t\t\tthis.keyup.block = this.selection.block();\n\t\t\t\t\tthis.keyup.current = this.selection.current();\n\t\t\t\t\tthis.keyup.parent = this.selection.parent();\n\t\t\t\t\tthis.keyup.lastShiftKey = e.shiftKey;\n\n\n\t\t\t\t\t// callback\n\t\t\t\t\tvar stop = this.core.callback('keyup', e);\n\t\t\t\t\tif (stop === false)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n                    // replace a prev figure to paragraph if caret is before image\n                    if (key === this.keyCode.ENTER)\n                    {\n                        if (this.keyup.block && this.keyup.block.tagName === 'FIGURE')\n                        {\n                            var $prev = $(this.keyup.block).prev();\n                            if ($prev.length !== 0 && $prev[0].tagName === 'FIGURE')\n                            {\n                                var $newTag = this.utils.replaceToTag($prev, 'p');\n                                this.caret.start($newTag);\n                                return;\n                            }\n                        }\n                    }\n\n\t\t\t\t\t// replace figure to paragraph\n\t\t\t\t\tif (key === this.keyCode.BACKSPACE || key === this.keyCode.DELETE)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.utils.isSelectAll())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.focus.start();\n                            this.toolbar.setUnfixed();\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// if caret before figure - delete image\n\t\t\t\t\t\tif (this.keyup.block && this.keydown.block && this.keyup.block.tagName === 'FIGURE' && this.utils.isStartOfElement(this.keydown.block))\n\t\t\t\t\t\t{\n    \t\t\t\t\t\te.preventDefault();\n\n                            this.selection.save();\n                            $(this.keyup.block).find('figcaption').remove();\n    \t\t\t\t\t\t$(this.keyup.block).find('img').first().remove();\n    \t\t\t\t\t\tthis.utils.replaceToTag(this.keyup.block, 'p');\n\n    \t\t\t\t\t\tvar $marker = this.marker.find();\n    \t\t\t\t\t\t$('html, body').animate({ scrollTop: $marker.position().top + 20 }, 500);\n\n    \t\t\t\t\t\tthis.selection.restore();\n    \t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\n\t\t\t\t\t\t// if paragraph does contain only image replace to figure\n\t\t\t\t\t\tif (this.keyup.block && this.keyup.block.tagName === 'P')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar isContainImage = $(this.keyup.block).find('img').length;\n\t\t\t\t\t\t\tvar text = $(this.keyup.block).text().replace(/\\u200B/g, '');\n\t\t\t\t\t\t\tif (text === '' && isContainImage !== 0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.utils.replaceToTag(this.keyup.block, 'figure');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// if figure does not contain image - replace to paragraph\n\t\t\t\t\t\tif (this.keyup.block && this.keyup.block.tagName === 'FIGURE' && $(this.keyup.block).find('img').length === 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.selection.save();\n\t\t\t\t\t\t\tthis.utils.replaceToTag(this.keyup.block, 'p');\n\t\t\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// linkify\n\t\t\t\t\tif (this.linkify.isKey(key))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.linkify.format();\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t};\n\t\t},\n\n\t\t// =lang\n\t\tlang: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tload: function()\n\t\t\t\t{\n\t\t\t\t\tthis.opts.curLang = this.opts.langs[this.opts.lang];\n\t\t\t\t},\n\t\t\t\tget: function(name)\n\t\t\t\t{\n\t\t\t\t\treturn (typeof this.opts.curLang[name] !== 'undefined') ? this.opts.curLang[name] : '';\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =line\n\t\tline: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tinsert: function()\n\t\t\t\t{\n\t\t\t\t\tthis.buffer.set();\n\n\t\t\t\t\t// insert\n\t\t\t\t\tthis.insert.html(this.line.getLineHtml());\n\n\t\t\t\t\t// find\n\t\t\t\t\tvar $hr = this.core.editor().find('#redactor-hr-tmp-id');\n\t\t\t\t\t$hr.removeAttr('id');\n\n\t\t\t\t\tthis.core.callback('insertedLine', $hr);\n\n\t\t\t\t\treturn $hr;\n\t\t\t\t},\n\t\t\t\tgetLineHtml: function()\n\t\t\t\t{\n\t\t\t\t\tvar html = '<hr id=\"redactor-hr-tmp-id\" />';\n\t\t\t\t\tif (!this.detect.isFirefox() && this.utils.isEmpty())\n\t\t\t\t\t{\n\t\t\t\t\t\thtml += '<p>' + this.opts.emptyHtml + '</p>';\n\t\t\t\t\t}\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\t// ff only\n\t\t\t\tremoveOnBackspace: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (!this.utils.isCollapsed())\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $block = $(this.selection.block());\n\t\t\t\t\tif ($block.length === 0 || !this.utils.isStartOfElement($block))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// if hr is previous element\n\t\t\t\t\tvar $prev = $block.prev();\n\t\t\t\t\tif ($prev && $prev.length !== 0 && $prev[0].tagName === 'HR')\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t$prev.remove();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =link\n\t\tlink: function()\n\t\t{\n\t\t\treturn {\n\n\t\t\t\t// public\n\t\t\t\tget: function()\n\t\t\t\t{\n\t\t\t\t\treturn $(this.selection.inlines('a'));\n\t\t\t\t},\n\t\t\t\tis: function()\n\t\t\t\t{\n\t\t\t\t\tvar nodes = this.selection.nodes() ;\n\t\t\t\t\tvar $link = $(this.selection.current()).closest('a', this.core.editor()[0]);\n\n\t\t\t\t\treturn ($link.length === 0 || nodes.length > 1) ? false : $link;\n\t\t\t\t},\n\t\t\t\tunlink: function(e)\n\t\t\t\t{\n\t\t\t\t\t// if call from clickable element\n\t\t\t\t\tif (typeof e !== 'undefined' && e.preventDefault)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t}\n\n\t\t\t\t\t// buffer\n\t\t\t\t\tthis.buffer.set();\n\n\t\t\t\t\tvar links = this.selection.inlines('a');\n\t\t\t\t\tif (links.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $links = this.link.replaceLinksToText(links);\n\n\t\t\t\t\tthis.observe.closeAllTooltip();\n\t\t\t\t\tthis.core.callback('deletedLink', $links);\n\n\t\t\t\t},\n\t\t\t\tinsert: function(link, cleaned)\n\t\t\t\t{\n\t\t\t\t\tvar $el = this.link.is();\n\n\t\t\t\t\tif (cleaned !== true)\n\t\t\t\t\t{\n\t\t\t\t\t\tlink = this.link.buildLinkFromObject($el, link);\n\t\t\t\t\t\tif (link === false)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// buffer\n\t\t\t\t\tthis.buffer.set();\n\n\t\t\t\t\t// callback\n\t\t\t\t\tlink = this.core.callback('beforeInsertingLink', link);\n\n\t\t\t\t\tif ($el === false)\n\t\t\t\t\t{\n\t\t\t\t\t\t// insert\n\t\t\t\t\t\t$el = $('<a />');\n\t\t\t\t\t\t$el = this.link.update($el, link);\n\t\t\t\t\t\t$el = $(this.insert.node($el));\n\n\t\t\t\t\t\tvar $parent = $el.parent();\n\t\t\t\t\t\tif (this.utils.isRedactorParent($parent) === false)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$el.wrap('<p>');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// remove unlink wrapper\n\t\t\t\t\t\tif ($parent.hasClass('redactor-unlink'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$parent.replaceWith(function(){\n\t\t\t\t\t\t\t\treturn $(this).contents();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.caret.after($el);\n\t\t\t\t\t\tthis.core.callback('insertedLink', $el);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t// update\n\t\t\t\t\t\t$el = this.link.update($el, link);\n\t\t\t\t\t\tthis.caret.after($el);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn $el;\n\n\t\t\t\t},\n\t\t\t\tupdate: function($el, link)\n\t\t\t\t{\n\t\t\t\t\t$el.text(link.text);\n\t\t\t\t\t$el.attr('href', link.url);\n\n\t\t\t\t\tthis.link.target($el, link.target);\n\n\t\t\t\t\treturn $el;\n\n\t\t\t\t},\n\t\t\t\ttarget: function($el, target)\n\t\t\t\t{\n\t\t\t\t\treturn (target) ? $el.attr('target', '_blank') : $el.removeAttr('target');\n\t\t\t\t},\n\t\t\t\tshow: function(e)\n\t\t\t\t{\n\t\t\t\t\t// if call from clickable element\n\t\t\t\t\tif (typeof e !== 'undefined' && e.preventDefault)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t}\n\n\t\t\t\t\t// close tooltip\n\t\t\t\t\tthis.observe.closeAllTooltip();\n\n\t\t\t\t\t// is link\n\t\t\t\t\tvar $el = this.link.is();\n\n\t\t\t\t\t// build modal\n\t\t\t\t\tthis.link.buildModal($el);\n\n\t\t\t\t\t// build link\n\t\t\t\t\tvar link = this.link.buildLinkFromElement($el);\n\n\t\t\t\t\t// if link cut & paste inside editor browser added self host to a link\n\t\t\t\t\tlink.url = this.link.removeSelfHostFromUrl(link.url);\n\n                    // new tab target\n\t\t\t\t\tif (this.opts.linkNewTab && !$el)\n\t\t\t\t\t{\n    \t\t\t\t\tlink.target = true;\n\t\t\t\t\t}\n\n\t\t\t\t\t// set modal values\n\t\t\t\t\tthis.link.setModalValues(link);\n\n\t\t\t\t\t// show modal\n\t\t\t\t\tthis.modal.show();\n\n\t\t\t\t\t// focus\n\t\t\t\t\tif (this.detect.isDesktop())\n\t\t\t\t\t{\n\t\t\t\t\t\t$('#redactor-link-url').focus();\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\t// private\n\t\t\t\tsetModalValues: function(link)\n\t\t\t\t{\n\t\t\t\t\t$('#redactor-link-blank').prop('checked', link.target);\n\t\t\t\t\t$('#redactor-link-url').val(link.url);\n\t\t\t\t\t$('#redactor-link-url-text').val(link.text);\n\t\t\t\t},\n\t\t\t\tbuildModal: function($el)\n\t\t\t\t{\n\t\t\t\t\tthis.modal.load('link', this.lang.get(($el === false) ? 'link-insert' : 'link-edit'), 600);\n\n\t\t\t\t\t// button insert\n\t\t\t\t\tvar $btn = this.modal.getActionButton();\n\t\t\t\t\t$btn.text(this.lang.get(($el === false) ? 'insert' : 'save')).on('click', $.proxy(this.link.callback, this));\n\n\t\t\t\t},\n\t\t\t\tcallback: function()\n\t\t\t\t{\n\t\t\t\t\t// build link\n\t\t\t\t\tvar link = this.link.buildLinkFromModal();\n\t\t\t\t\tif (link === false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// close\n\t\t\t\t\tthis.modal.close();\n\n\t\t\t\t\t// insert or update\n\t\t\t\t\tthis.link.insert(link, true);\n\t\t\t\t},\n\t\t\t\tcleanUrl: function(url)\n\t\t\t\t{\n\t\t\t\t\treturn (typeof url === 'undefined') ? '' : $.trim(url.replace(/[^\\W\\w\\D\\d+&\\'@#/%?=~_|!:,.;\\(\\)]/gi, ''));\n\t\t\t\t},\n\t\t\t\tcleanText: function(text)\n\t\t\t\t{\n\t\t\t\t\treturn (typeof text === 'undefined') ? '' :$.trim(text.replace(/(<([^>]+)>)/gi, ''));\n\t\t\t\t},\n\t\t\t\tgetText: function(link)\n\t\t\t\t{\n\t\t\t\t\treturn (link.text === '' && link.url !== '') ? this.link.truncateUrl(link.url.replace(/<|>/g, '')) : link.text;\n\t\t\t\t},\n\t\t\t\tisUrl: function(url)\n\t\t\t\t{\n\t\t\t\t\tvar pattern = '((xn--)?[\\\\W\\\\w\\\\D\\\\d]+(-[\\\\W\\\\w\\\\D\\\\d]+)*\\\\.)+[\\\\W\\\\w]{2,}';\n\n\t\t\t\t\tvar re1 = new RegExp('^(http|ftp|https)://' + pattern, 'i');\n\t\t\t\t\tvar re2 = new RegExp('^' + pattern, 'i');\n\t\t\t\t\tvar re3 = new RegExp('\\.(html|php)$', 'i');\n\t\t\t\t\tvar re4 = new RegExp('^/', 'i');\n\t\t\t\t\tvar re5 = new RegExp('^tel:(.*?)', 'i');\n\n\t\t\t\t\t// add protocol\n\t\t\t\t\tif (url.search(re1) === -1 && url.search(re2) !== -1 && url.search(re3) === -1 && url.substring(0, 1) !== '/')\n\t\t\t\t\t{\n\t\t\t\t\t\turl = 'http://' + url;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (url.search(re1) !== -1 || url.search(re3) !== -1 || url.search(re4) !== -1 || url.search(re5) !== -1)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn url;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\tisMailto: function(url)\n\t\t\t\t{\n\t\t\t\t\treturn (url.search('@') !== -1 && /(http|ftp|https):\\/\\//i.test(url) === false);\n\t\t\t\t},\n\t\t\t\tisEmpty: function(link)\n\t\t\t\t{\n\t\t\t\t\treturn (link.url === '' || (link.text === '' && link.url === ''));\n\t\t\t\t},\n\t\t\t\ttruncateUrl: function(url)\n\t\t\t\t{\n\t\t\t\t\treturn (url.length > this.opts.linkSize) ? url.substring(0, this.opts.linkSize) + '...' : url;\n\t\t\t\t},\n\t\t\t\tparse: function(link)\n\t\t\t\t{\n\t\t\t\t\t// mailto\n\t\t\t\t\tif (this.link.isMailto(link.url))\n\t\t\t\t\t{\n\t\t\t\t\t\tlink.url = 'mailto:' + link.url.replace('mailto:', '');\n\t\t\t\t\t}\n\t\t\t\t\t// url\n\t\t\t\t\telse if (link.url.search('#') !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tlink.url = this.link.isUrl(link.url);\n\t\t\t\t\t}\n\n\t\t\t\t\t// empty url or text or isn't url\n\t\t\t\t\treturn (this.link.isEmpty(link) || link.url === false) ? false : link;\n\n\t\t\t\t},\n\t\t\t\tbuildLinkFromModal: function()\n\t\t\t\t{\n\t\t\t\t\tvar link = {};\n\n\t\t\t\t\t// url\n\t\t\t\t\tlink.url = this.link.cleanUrl($('#redactor-link-url').val());\n\n\t\t\t\t\t// text\n\t\t\t\t\tlink.text = this.link.cleanText($('#redactor-link-url-text').val());\n\t\t\t\t\tlink.text = this.link.getText(link);\n\n\t\t\t\t\t// target\n\t\t\t\t\tlink.target = ($('#redactor-link-blank').prop('checked')) ? true : false;\n\n\t\t\t\t\t// parse\n\t\t\t\t\treturn this.link.parse(link);\n\n\t\t\t\t},\n\t\t\t\tbuildLinkFromObject: function($el, link)\n\t\t\t\t{\n\t\t\t\t\t// url\n\t\t\t\t\tlink.url = this.link.cleanUrl(link.url);\n\n\t\t\t\t\t// text\n\t\t\t\t\tlink.text = (typeof link.text === 'undefined' && this.selection.is()) ? this.selection.text() : this.link.cleanText(link.text);\n\t\t\t\t\tlink.text = this.link.getText(link);\n\n\t\t\t\t\t// target\n\t\t\t\t\tlink.target = ($el === false) ? link.target : this.link.buildTarget($el);\n\n\t\t\t\t\t// parse\n\t\t\t\t\treturn this.link.parse(link);\n\n\t\t\t\t},\n\t\t\t\tbuildLinkFromElement: function($el)\n\t\t\t\t{\n\t\t\t\t\tvar link = {\n\t\t\t\t\t\turl: '',\n\t\t\t\t\t\ttext: (this.selection.is()) ? this.selection.text() : '',\n\t\t\t\t\t\ttarget: false\n\t\t\t\t\t};\n\n\t\t\t\t\tif ($el !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\tlink.url = $el.attr('href');\n\t\t\t\t\t\tlink.text = $el.text();\n\t\t\t\t\t\tlink.target = this.link.buildTarget($el);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn link;\n\t\t\t\t},\n\t\t\t\tbuildTarget: function($el)\n\t\t\t\t{\n\t\t\t\t\treturn (typeof $el.attr('target') !== 'undefined' && $el.attr('target') === '_blank') ? true : false;\n\t\t\t\t},\n\t\t\t\tremoveSelfHostFromUrl: function(url)\n\t\t\t\t{\n\t\t\t\t\tvar href = self.location.href.replace('#', '').replace(/\\/$/i, '');\n\t\t\t\t\treturn url.replace(/^\\/\\#/, '#').replace(href, '').replace('mailto:', '');\n\t\t\t\t},\n\t\t\t\treplaceLinksToText: function(links)\n\t\t\t\t{\n\t\t\t\t\tvar $first;\n\t\t\t\t\tvar $links = $.each(links, function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $el = $(s);\n\t\t\t\t\t\tvar $unlinked = $('<span class=\"redactor-unlink\" />').append($el.contents());\n\t\t\t\t\t\t$el.replaceWith($unlinked);\n\n\t\t\t\t\t\tif (i === 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$first = $unlinked;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn $el;\n\t\t\t\t\t});\n\n\t\t\t\t\t// set caret after unlinked node\n\t\t\t\t\tif (links.length === 1 && this.selection.isCollapsed())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.caret.after($first);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn $links;\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =linkify\n\t\tlinkify: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tisKey: function(key)\n\t\t\t\t{\n\t\t\t\t\treturn key === this.keyCode.ENTER || key === this.keyCode.SPACE;\n\t\t\t\t},\n\t\t\t\tisLink: function(node)\n\t\t\t\t{\n\t\t\t\t\treturn (node.nodeValue.match(this.opts.regexps.linkyoutube) || node.nodeValue.match(this.opts.regexps.linkvimeo) || node.nodeValue.match(this.opts.regexps.linkimage) || node.nodeValue.match(this.opts.regexps.url));\n\t\t\t\t},\n\t\t\t\tisFiltered: function(i, node)\n\t\t\t\t{\n\t\t\t\t\treturn node.nodeType === 3 && $.trim(node.nodeValue) !== \"\" && !$(node).parent().is(\"pre\") && (this.linkify.isLink(node));\n\t\t\t\t},\n\t\t\t\thandler: function(i, node)\n\t\t\t\t{\n\t\t\t\t\tvar $el = $(node);\n\t\t\t\t\tvar text = $el.text();\n\t\t\t\t\tvar html = text;\n\n\t\t\t\t\tif (html.match(this.opts.regexps.linkyoutube) || html.match(this.opts.regexps.linkvimeo))\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = this.linkify.convertVideoLinks(html);\n\t\t\t\t\t}\n\t\t\t\t\telse if (html.match(this.opts.regexps.linkimage))\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = this.linkify.convertImages(html);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = this.linkify.convertLinks(html);\n\t\t\t\t\t}\n\n\t\t\t\t\t$el.before(text.replace(text, html)).remove();\n\t\t\t\t},\n\t\t\t\tformat: function()\n\t\t\t\t{\n\t\t\t\t\tif (!this.opts.linkify || this.utils.isCurrentOrParent('pre'))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.core.editor().find(\":not(iframe,img,a,pre,code,.redactor-unlink)\").addBack().contents().filter($.proxy(this.linkify.isFiltered, this)).each($.proxy(this.linkify.handler, this));\n\n\t\t\t\t\t// collect\n\t\t\t\t\tvar $objects = this.core.editor().find('.redactor-linkify-object').each($.proxy(function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $el = $(s);\n\t\t\t\t\t\t$el.removeClass('redactor-linkify-object');\n\t\t\t\t\t\tif ($el.attr('class') === '')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$el.removeAttr('class');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (s.tagName === 'DIV') // video container\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.linkify.breakBlockTag($el, 'video');\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (s.tagName === 'IMG') // image\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.linkify.breakBlockTag($el, 'image');\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (s.tagName === 'A')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.core.callback('insertedLink', $el);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn $el;\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\t// callback\n\t\t\t\t\tsetTimeout($.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.code.sync();\n\t\t\t\t\t\tthis.core.callback('linkify', $objects);\n\n\t\t\t\t\t}, this), 100);\n\n\t\t\t\t},\n\t\t\t\tbreakBlockTag: function($el, type)\n\t\t\t\t{\n\t\t\t\t\tvar breaked = this.utils.breakBlockTag();\n\t\t\t\t\tif (breaked === false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $newBlock = $el;\n\t\t\t\t\tif (type === 'image')\n\t\t\t\t\t{\n\t\t\t\t\t\t$newBlock = $('<figure />').append($el);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (breaked.type === 'start')\n\t\t\t\t\t{\n\t\t\t\t\t\tbreaked.$block.before($newBlock);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tbreaked.$block.after($newBlock);\n\t\t\t\t\t}\n\n\n\t\t\t\t\tif (type === 'image')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.caret.after($newBlock);\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tconvertVideoLinks: function(html)\n\t\t\t\t{\n\t\t\t\t\tvar iframeStart = '<div class=\"' + this.opts.videoContainerClass + ' redactor-linkify-object\"><iframe class=\"redactor-linkify-object\" width=\"500\" height=\"281\" src=\"';\n\t\t\t\t\tvar iframeEnd = '\" frameborder=\"0\" allowfullscreen></iframe></div>';\n\n\t\t\t\t\tif (html.match(this.opts.regexps.linkyoutube))\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(this.opts.regexps.linkyoutube, iframeStart + '//www.youtube.com/embed/$1' + iframeEnd);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (html.match(this.opts.regexps.linkvimeo))\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(this.opts.regexps.linkvimeo, iframeStart + '//player.vimeo.com/video/$2' + iframeEnd);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tconvertImages: function(html)\n\t\t\t\t{\n\t\t\t\t\tvar matches = html.match(this.opts.regexps.linkimage);\n\t\t\t\t\tif (!matches)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn html;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn html.replace(html, '<img src=\"' + matches + '\" class=\"redactor-linkify-object\" />');\n\t\t\t\t},\n\t\t\t\tconvertLinks: function(html)\n\t\t\t\t{\n\t\t\t\t\tvar matches = html.match(this.opts.regexps.url);\n\t\t\t\t\tif (!matches)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn html;\n\t\t\t\t\t}\n\n\t\t\t\t\tmatches = $.grep(matches, function(v, k) { return $.inArray(v, matches) === k; });\n\n\t\t\t\t\tvar length = matches.length;\n\n\t\t\t\t\tfor (var i = 0; i < length; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar href = matches[i], text = href;\n\t\t\t\t\t\tvar linkProtocol = (href.match(/(https?|ftp):\\/\\//i) !== null) ? '' : 'http://';\n\n\t\t\t\t\t\tif (text.length > this.opts.linkSize)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext = text.substring(0, this.opts.linkSize) + '...';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (text.search('%') === -1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext = decodeURIComponent(text);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar regexB = \"\\\\b\";\n\n\t\t\t\t\t\tif ($.inArray(href.slice(-1), [\"/\", \"&\", \"=\"]) !== -1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tregexB = \"\";\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// escaping url\n\t\t\t\t\t\tvar regexp = new RegExp('(' + href.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, \"\\\\$&\") + regexB + ')', 'g');\n\n\t\t\t\t\t\t// target\n\t\t\t\t\t\tvar target = '';\n\t\t\t\t\t\tif (this.opts.pasteLinkTarget !== false)\n                        {\n    \t\t\t\t\t    target = ' target=\"' + this.opts.pasteLinkTarget + '\"';\n                        }\n\n\t\t\t\t\t\thtml = html.replace(regexp, '<a href=\"' + linkProtocol + $.trim(href) + '\"' + target + ' class=\"redactor-linkify-object\">' + $.trim(text) + '</a>');\n\t\t\t\t\t}\n\n\t\t\t\t\treturn html;\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =list\n\t\tlist: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\ttoggle: function(cmd)\n\t\t\t\t{\n\t\t\t\t\tif (this.utils.inBlocks(['table', 'td', 'th', 'tr']))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar tag = (cmd === 'orderedlist' || cmd === 'ol') ? 'OL' : 'UL';\n\t\t\t\t\tcmd = (tag === 'OL') ? 'orderedlist' : 'unorderedlist'\n\n\t\t\t\t\tvar $list = $(this.selection.current()).parentsUntil('.redactor-in', 'ul, ol').first();\n\n\t\t\t\t\tthis.placeholder.hide();\n\t\t\t\t\tthis.buffer.set();\n\n\n\t\t\t\t\tif ($list.length !== 0 && $list[0].tagName === tag && this.utils.isRedactorParent($list))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.selection.save();\n\n\t\t\t\t\t\t// remove list\n\t\t\t\t\t\t$list.find('ul, ol').each(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar parent = $(this).closest('li');\n\t\t\t\t\t\t\t$(this).find('li').each(function()\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$(parent).after(this);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t$list.find('ul, ol').remove();\n\t\t\t\t\t\t$list.find('li').each(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn $(this).replaceWith(function()\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn $('<p />').append($(this).contents());\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\n\n\t\t\t\t\t\t$list.replaceWith(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn $(this).contents();\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\n\t\t\t\t\tthis.selection.save();\n\n\t\t\t\t\tif ($list.length !== 0 && $list[0].tagName !== tag)\n\t\t\t\t\t{\n                        $list.each($.proxy(function(i,s)\n                        {\n                            this.utils.replaceToTag(s, tag);\n\n                        }, this));\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t    document.execCommand('insert' + cmd);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.selection.restore();\n\n\t\t\t\t\tvar $insertedList = this.list.get();\n\t\t\t\t\tif (!$insertedList)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!this.selection.block())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdocument.execCommand('formatblock', false, 'p');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// clear span\n\t\t\t\t\t$insertedList.find('span').replaceWith(function()\n\t\t\t\t\t{\n\t\t\t\t\t\treturn $(this).contents();\n\t\t\t\t\t});\n\n\t\t\t\t\t// remove style\n\t\t\t\t\t$insertedList.find(this.opts.inlineTags.join(',')).each(function()\n\t\t\t\t\t{\n\t\t\t\t\t\t$(this).removeAttr('style');\n\t\t\t\t\t});\n\n\t\t\t\t\t// remove block-element list wrapper\n\t\t\t\t\tvar $listParent = $insertedList.parent();\n\t\t\t\t\tif (this.utils.isRedactorParent($listParent) && $listParent[0].tagName !== 'LI' && this.utils.isBlock($listParent))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.selection.save();\n\n\t\t\t\t\t\t$listParent.replaceWith($listParent.contents());\n\n\t\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tget: function()\n\t\t\t\t{\n\t\t\t\t\tvar current = this.selection.current();\n\t\t\t\t\tvar $list = $(current).closest('ul, ol', this.core.editor()[0]);\n\n\t\t\t\t\treturn ($list.length === 0) ? false : $list;\n\t\t\t\t},\n\t\t\t\tcombineAfterAndBefore: function(block)\n\t\t\t\t{\n    \t\t\t\tvar $prev = $(block).prev();\n    \t\t\t\tvar $next = $(block).next();\n                    var isEmptyBlock = (block && block.tagName === 'P' && (block.innerHTML === '<br>' || block.innerHTML === ''));\n                    var isBlockWrapped = ($prev.closest('ol, ul', this.core.editor()[0]).length === 1 && $next.closest('ol, ul', this.core.editor()[0]).length === 1);\n\n                    if (isEmptyBlock && isBlockWrapped)\n                    {\n                        $prev.children('li').last().append(this.marker.get());\n                        $prev.append($next.contents());\n                        this.selection.restore();\n\n                        return true;\n                    }\n\n                    return false;\n\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =marker\n\t\tmarker: function()\n\t\t{\n\t\t\treturn {\n\n\t\t\t\t// public\n\t\t\t\tget: function(num)\n\t\t\t\t{\n\t\t\t\t\tnum = (typeof num === 'undefined') ? 1 : num;\n\n\t\t\t\t\tvar marker = document.createElement('span');\n\n\t\t\t\t\tmarker.id = 'selection-marker-' + num;\n\t\t\t\t\tmarker.className = 'redactor-selection-marker';\n\t\t\t\t\tmarker.innerHTML = this.opts.invisibleSpace;\n\n\t\t\t\t\treturn marker;\n\t\t\t\t},\n\t\t\t\thtml: function(num)\n\t\t\t\t{\n\t\t\t\t\treturn this.utils.getOuterHtml(this.marker.get(num));\n\t\t\t\t},\n\t\t\t\tfind: function(num)\n\t\t\t\t{\n\t\t\t\t\tnum = (typeof num === 'undefined') ? 1 : num;\n\n\t\t\t\t\treturn this.core.editor().find('span#selection-marker-' + num);\n\t\t\t\t},\n\t\t\t\tinsert: function()\n\t\t\t\t{\n\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\tvar range = this.selection.range(sel);\n\n\t\t\t\t\tthis.marker.insertNode(range, this.marker.get(1), true);\n\t\t\t\t\tif (range && range.collapsed === false)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.marker.insertNode(range, this.marker.get(2), false);\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tremove: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().find('.redactor-selection-marker').each(this.marker.iterateRemove);\n\t\t\t\t},\n\n\t\t\t\t// private\n\t\t\t\tinsertNode: function(range, node, collapse)\n\t\t\t\t{\n\t\t\t\t\tvar parent = this.selection.parent();\n\t\t\t\t\tif (range === null || $(parent).closest('.redactor-in').length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\trange = range.cloneRange();\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\trange.collapse(collapse);\n\t\t\t\t\t\trange.insertNode(node);\n\t\t\t\t\t}\n\t\t\t\t\tcatch (e)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.focus.start();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\titerateRemove: function(i, el)\n\t\t\t\t{\n\t\t\t\t\tvar $el = $(el);\n\t\t\t\t\tvar text = $el.text().replace(/\\u200B/g, '');\n\n\t\t\t\t\treturn (text === '') ? $el.remove() : $el.replaceWith(function() { return $(this).contents(); });\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =modal\n\t\tmodal: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tcallbacks: {},\n\t\t\t\ttemplates: function()\n\t\t\t\t{\n\t\t\t\t\tthis.opts.modal = {\n\t\t\t\t\t\t'image-edit': String()\n\t\t\t\t\t\t+ '<div class=\"redactor-modal-tab redactor-group\" data-title=\"General\">'\n\t\t\t\t\t\t\t+ '<div id=\"redactor-image-preview\" class=\"redactor-modal-tab-side\">'\n\t\t\t\t\t\t\t+ '</div>'\n\t\t\t\t\t\t\t+ '<div class=\"redactor-modal-tab-area\">'\n\t\t\t\t\t\t\t\t+ '<section>'\n\t\t\t\t\t\t\t\t\t+ '<label>' + this.lang.get('title') + '</label>'\n\t\t\t\t\t\t\t\t\t+ '<input type=\"text\" id=\"redactor-image-title\" />'\n\t\t\t\t\t\t\t\t+ '</section>'\n\t\t\t\t\t\t\t\t+ '<section>'\n\t\t\t\t\t\t\t\t\t+ '<label>' + this.lang.get('caption') + '</label>'\n\t\t\t\t\t\t\t\t\t+ '<input type=\"text\" id=\"redactor-image-caption\" aria-label=\"' + this.lang.get('caption') + '\" />'\n\t\t\t\t\t\t\t\t+ '</section>'\n\t\t\t\t\t\t\t\t+ '<section>'\n\t\t\t\t\t\t\t\t\t+ '<label>' + this.lang.get('link') + '</label>'\n\t\t\t\t\t\t\t\t\t+ '<input type=\"text\" id=\"redactor-image-link\" aria-label=\"' + this.lang.get('link') + '\" />'\n\t\t\t\t\t\t\t\t+ '</section>'\n\t\t\t\t\t\t\t\t+ '<section>'\n        \t\t\t\t\t\t\t+ '<label class=\"redactor-image-position-option\">' + this.lang.get('image-position') + '</label>'\n        \t\t\t\t\t\t\t+ '<select class=\"redactor-image-position-option\" id=\"redactor-image-align\" aria-label=\"' + this.lang.get('image-position') + '\">'\n        \t\t\t\t\t\t\t\t+ '<option value=\"none\">' + this.lang.get('none') + '</option>'\n        \t\t\t\t\t\t\t\t+ '<option value=\"left\">' + this.lang.get('left') + '</option>'\n        \t\t\t\t\t\t\t\t+ '<option value=\"center\">' + this.lang.get('center') + '</option>'\n        \t\t\t\t\t\t\t\t+ '<option value=\"right\">' + this.lang.get('right') + '</option>'\n        \t\t\t\t\t\t\t+ '</select>'\n\t\t\t\t\t\t\t\t+ '</section>'\n\t\t\t\t\t\t\t\t+ '<section>'\n\t\t\t\t\t\t\t\t\t+ '<label class=\"checkbox\"><input type=\"checkbox\" id=\"redactor-image-link-blank\" aria-label=\"' + this.lang.get('link-in-new-tab') + '\"> ' + this.lang.get('link-in-new-tab') + '</label>'\n\t\t\t\t\t\t\t\t+ '</section>'\n\t\t\t\t\t\t\t\t+ '<section>'\n\t\t\t\t\t\t\t\t\t+ '<button id=\"redactor-modal-button-action\">' + this.lang.get('insert') + '</button>'\n\t\t\t\t\t\t\t\t\t+ '<button id=\"redactor-modal-button-cancel\">' + this.lang.get('cancel') + '</button>'\n\t\t\t\t\t\t\t\t\t+ '<button id=\"redactor-modal-button-delete\" class=\"redactor-modal-button-offset\">' + this.lang.get('delete') + '</button>'\n\t\t\t\t\t\t\t\t+ '</section>'\n\t\t\t\t\t\t\t+ '</div>'\n\t\t\t\t\t\t+ '</div>',\n\n\t\t\t\t\t\t'image': String()\n\t\t\t\t\t\t+ '<div class=\"redactor-modal-tab\" data-title=\"Upload\">'\n\t\t\t\t\t\t\t+ '<section>'\n\t\t\t\t\t\t\t\t+ '<div id=\"redactor-modal-image-droparea\"></div>'\n\t \t\t\t\t\t\t+ '</section>'\n \t\t\t\t\t\t+ '</div>',\n\n\t\t\t\t\t\t'file': String()\n\t\t\t\t\t\t+ '<div class=\"redactor-modal-tab\" data-title=\"Upload\">'\n\t\t\t\t\t\t\t+ '<section>'\n\t\t\t\t\t\t\t\t+ '<label>' + this.lang.get('filename') + ' <span class=\"desc\">(' + this.lang.get('optional') + ')</span></label>'\n\t\t\t\t\t\t\t\t+ '<input type=\"text\" id=\"redactor-filename\" aria-label=\"' + this.lang.get('filename') + '\" /><br><br>'\n\t\t\t\t\t\t\t+ '</section>'\n\t\t\t\t\t\t\t+ '<section>'\n\t\t\t\t\t\t\t\t+ '<div id=\"redactor-modal-file-upload\"></div>'\n\t\t\t\t\t\t\t+ '</section>'\n\t\t\t\t\t\t+ '</div>',\n\n\t\t\t\t\t\t'link': String()\n\t\t\t\t\t\t+ '<div class=\"redactor-modal-tab\" data-title=\"General\">'\n\t\t\t\t\t\t\t+ '<section>'\n\t\t\t\t\t\t\t\t+ '<label>URL</label>'\n\t\t\t\t\t\t\t\t+ '<input type=\"url\" id=\"redactor-link-url\" aria-label=\"URL\" />'\n\t\t\t\t\t\t\t+ '</section>'\n\t\t\t\t\t\t\t+ '<section>'\n\t\t\t\t\t\t\t\t+ '<label>' + this.lang.get('text') + '</label>'\n\t\t\t\t\t\t\t\t+ '<input type=\"text\" id=\"redactor-link-url-text\" aria-label=\"' + this.lang.get('text') + '\" />'\n\t\t\t\t\t\t\t+ '</section>'\n\t\t\t\t\t\t\t+ '<section>'\n\t\t\t\t\t\t\t\t+ '<label class=\"checkbox\"><input type=\"checkbox\" id=\"redactor-link-blank\"> ' + this.lang.get('link-in-new-tab') + '</label>'\n\t\t\t\t\t\t\t+ '</section>'\n\t\t\t\t\t\t\t+ '<section>'\n\t\t\t\t\t\t\t\t+ '<button id=\"redactor-modal-button-action\">' + this.lang.get('insert') + '</button>'\n\t\t\t\t\t\t\t\t+ '<button id=\"redactor-modal-button-cancel\">' + this.lang.get('cancel') + '</button>'\n\t\t\t\t\t\t\t+ '</section>'\n\t\t\t\t\t\t+ '</div>'\n\t\t\t\t\t};\n\n\t\t\t\t\t$.extend(this.opts, this.opts.modal);\n\n\t\t\t\t},\n\t\t\t\taddCallback: function(name, callback)\n\t\t\t\t{\n\t\t\t\t\tthis.modal.callbacks[name] = callback;\n\t\t\t\t},\n\t\t\t\taddTemplate: function(name, template)\n\t\t\t\t{\n\t\t\t\t\tthis.opts.modal[name] = template;\n\t\t\t\t},\n\t\t\t\tgetTemplate: function(name)\n\t\t\t\t{\n\t\t\t\t\treturn this.opts.modal[name];\n\t\t\t\t},\n\t\t\t\tgetModal: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.$modalBody;\n\t\t\t\t},\n\t\t\t\tgetActionButton: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.$modalBody.find('#redactor-modal-button-action');\n\t\t\t\t},\n\t\t\t\tgetCancelButton: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.$modalBody.find('#redactor-modal-button-cancel');\n\t\t\t\t},\n\t\t\t\tgetDeleteButton: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.$modalBody.find('#redactor-modal-button-delete');\n\t\t\t\t},\n\t\t\t\tload: function(templateName, title, width)\n\t\t\t\t{\n\t\t\t\t\tif (typeof this.$modalBox !== 'undefined' && this.$modalBox.hasClass('open'))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.modal.templateName = templateName;\n\t\t\t\t\tthis.modal.width = width;\n\n\t\t\t\t\tthis.modal.build();\n\t\t\t\t\tthis.modal.enableEvents();\n\t\t\t\t\tthis.modal.setTitle(title);\n\t\t\t\t\tthis.modal.setDraggable();\n\t\t\t\t\tthis.modal.setContent();\n\n\t\t\t\t\t// callbacks\n\t\t\t\t\tif (typeof this.modal.callbacks[templateName] !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.modal.callbacks[templateName].call(this);\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tshow: function()\n\t\t\t\t{\n\n\t\t\t\t\tif (!this.detect.isDesktop())\n\t\t\t\t\t{\n\t\t\t\t\t\tdocument.activeElement.blur();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.selection.save();\n\t\t\t\t\tthis.modal.buildTabber();\n\n\t\t\t\t\tif (this.detect.isMobile())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.modal.width = '96%';\n\t\t\t\t\t}\n\n\t\t\t\t\t// resize\n\t\t\t\t\tsetTimeout($.proxy(this.modal.buildWidth, this), 0);\n\t\t\t\t\t$(window).on('resize.redactor-modal', $.proxy(this.modal.buildWidth, this));\n\n\n\t\t\t\t\tthis.$modalOverlay.redactorAnimation('fadeIn', {\n\t\t\t\t\t\tduration: 0.25\n\t\t\t\t\t});\n\n\t\t\t\t\t/* BEGIN HACK */\n\t\t\t\t\t// make sure that the modal is at the end of the DOM\n\t\t\t\t\tthis.$modalBox.appendTo(document.body);\n\t\t\t\t\t/* END HACK */\n\n\t\t\t\t\tthis.$modalBox.addClass('open').show();\n\t\t\t\t\tthis.$modal.redactorAnimation('fadeIn', {\n\t\t\t\t\t\t\ttiming: 'cubic-bezier(0.175, 0.885, 0.320, 1.105)'\n\t\t\t\t\t\t},\n\t\t\t\t\t\t$.proxy(function()\n\t\t\t\t\t\t{\n\n\t\t\t\t\t\t\tthis.utils.saveScroll();\n\t\t\t\t\t\t\tthis.utils.disableBodyScroll();\n\n\t\t\t\t\t\t\t// modal shown callback\n\t\t\t\t\t\t\tthis.core.callback('modalOpened', this.modal.templateName, this.$modal);\n\n\t\t\t\t\t\t\t// fix bootstrap modal focus\n\t\t\t\t\t\t\t$(document).off('focusin.modal');\n\n\t\t\t\t\t\t\t// enter\n\t\t\t\t\t\t\tvar $elements = this.$modal.find('input[type=text],input[type=url],input[type=email]');\n\t\t\t\t\t\t\t$elements.on('keydown.redactor-modal', $.proxy(this.modal.setEnter, this));\n\n\t\t\t\t\t\t}, this)\n\t\t\t\t\t);\n\n\t\t\t\t},\n\t\t\t\tbuildWidth: function()\n\t\t\t\t{\n\t\t\t\t\tvar windowHeight = $(window).height();\n\t\t\t\t\tvar windowWidth = $(window).width();\n\n\t\t\t\t\tvar number = (typeof this.modal.width === 'number');\n\n\t\t\t\t\tif (!number && this.modal.width.match(/%$/))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$modal.css({ 'width': this.modal.width, 'margin-bottom': '16px' });\n\t\t\t\t\t}\n\t\t\t\t\telse if (parseInt(this.modal.width) > windowWidth)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$modal.css({ 'width': '96%', 'margin-bottom': '2%' });\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tif (number)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.modal.width += 'px';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.$modal.css({ 'width': this.modal.width, 'margin-bottom': '16px' });\n\t\t\t\t\t}\n\n\t\t\t\t\t// margin top\n\t\t\t\t\tvar height = this.$modal.outerHeight();\n\t\t\t\t\tvar top = (windowHeight/2 - height/2) + 'px';\n\n\t\t\t\t\tif (this.detect.isMobile())\n\t\t\t\t\t{\n\t\t\t\t\t\ttop = '2%';\n\t\t\t\t\t}\n\t\t\t\t\telse if (height > windowHeight)\n\t\t\t\t\t{\n\t\t\t\t\t\ttop = '16px';\n\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.$modal.css('margin-top', top);\n\t\t\t\t},\n\t\t\t\tbuildTabber: function()\n\t\t\t\t{\n\t\t\t\t\tthis.modal.tabs = this.$modal.find('.redactor-modal-tab');\n\n\t\t\t\t\tif (this.modal.tabs.length < 2)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.modal.$tabsBox = $('<div id=\"redactor-modal-tabber\" />');\n\t\t\t\t\t$.each(this.modal.tabs, $.proxy(function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar a = $('<a href=\"#\" rel=\"' + i + '\" />').text($(s).attr('data-title'));\n\n\t\t\t\t\t\ta.on('click', $.proxy(this.modal.showTab, this));\n\n\t\t\t\t\t\tif (i === 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ta.addClass('active');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.modal.$tabsBox.append(a);\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\tthis.$modalBody.prepend(this.modal.$tabsBox);\n\n\t\t\t\t},\n\t\t\t\tshowTab: function(e)\n\t\t\t\t{\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\tvar $el = $(e.target);\n\t\t\t\t\tvar index = $el.attr('rel');\n\n\t\t\t\t\tthis.modal.tabs.hide();\n\t\t\t\t\tthis.modal.tabs.eq(index).show();\n\n\t\t\t\t\t$('#redactor-modal-tabber').find('a').removeClass('active');\n\t\t\t\t\t$el.addClass('active');\n\n\t\t\t\t\treturn false;\n\n\t\t\t\t},\n\t\t\t\tsetTitle: function(title)\n\t\t\t\t{\n\t\t\t\t\tthis.$modalHeader.html(title);\n\t\t\t\t},\n\t\t\t\tsetContent: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$modalBody.html(this.modal.getTemplate(this.modal.templateName));\n\n\t\t\t\t\tthis.modal.getCancelButton().on('mousedown', $.proxy(this.modal.close, this));\n\t\t\t\t},\n\t\t\t\tsetDraggable: function()\n\t\t\t\t{\n\t\t\t\t\tif (typeof $.fn.draggable === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.$modal.draggable({ handle: this.$modalHeader });\n\t\t\t\t\tthis.$modalHeader.css('cursor', 'move');\n\t\t\t\t},\n\t\t\t\tsetEnter: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (e.which !== 13)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tthis.modal.getActionButton().click();\n\t\t\t\t},\n\t\t\t\tbuild: function()\n\t\t\t\t{\n\t\t\t\t\tthis.modal.buildOverlay();\n\n\t\t\t\t\tthis.$modalBox = $('<div id=\"redactor-modal-box\"/>').hide();\n\t\t\t\t\tthis.$modal = $('<div id=\"redactor-modal\" role=\"dialog\" />');\n\t\t\t\t\tthis.$modalHeader = $('<div id=\"redactor-modal-header\" />');\n\t\t\t\t\tthis.$modalClose = $('<button type=\"button\" id=\"redactor-modal-close\" aria-label=\"' + this.lang.get('close') + '\" />').html('&times;');\n\t\t\t\t\tthis.$modalBody = $('<div id=\"redactor-modal-body\" />');\n\n\t\t\t\t\tthis.$modal.append(this.$modalHeader);\n\t\t\t\t\tthis.$modal.append(this.$modalBody);\n\t\t\t\t\tthis.$modal.append(this.$modalClose);\n\t\t\t\t\tthis.$modalBox.append(this.$modal);\n\t\t\t\t\tthis.$modalBox.appendTo(document.body);\n\n\t\t\t\t},\n\t\t\t\tbuildOverlay: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$modalOverlay = $('<div id=\"redactor-modal-overlay\">').hide();\n\t\t\t\t\t$('body').prepend(this.$modalOverlay);\n\t\t\t\t},\n\t\t\t\tenableEvents: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$modalClose.on('mousedown.redactor-modal', $.proxy(this.modal.close, this));\n\t\t\t\t\t$(document).on('keyup.redactor-modal', $.proxy(this.modal.closeHandler, this));\n\t\t\t\t\tthis.core.editor().on('keyup.redactor-modal', $.proxy(this.modal.closeHandler, this));\n\t\t\t\t\tthis.$modalBox.on('click.redactor-modal', $.proxy(this.modal.close, this));\n\t\t\t\t},\n\t\t\t\tdisableEvents: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$modalClose.off('mousedown.redactor-modal');\n\t\t\t\t\t$(document).off('keyup.redactor-modal');\n\t\t\t\t\tthis.core.editor().off('keyup.redactor-modal');\n\t\t\t\t\tthis.$modalBox.off('click§.redactor-modal');\n\t\t\t\t\t$(window).off('resize.redactor-modal');\n\t\t\t\t},\n\t\t\t\tcloseHandler: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (e.which !== this.keyCode.ESC)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.modal.close(false);\n\t\t\t\t},\n\t\t\t\tclose: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (e)\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($(e.target).attr('id') !== 'redactor-modal-button-cancel' && e.target !== this.$modalClose[0] && e.target !== this.$modalBox[0])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!this.$modalBox)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// restore selection\n\t\t\t\t\tthis.selection.restore();\n\n\t\t\t\t\tthis.modal.disableEvents();\n\t\t\t\t\tthis.utils.enableBodyScroll();\n\t\t\t\t\tthis.utils.restoreScroll();\n\n\t\t\t\t\tthis.$modalOverlay.redactorAnimation('fadeOut', { duration: 0.4 }, $.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$modalOverlay.remove();\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\tthis.$modal.redactorAnimation('fadeOut', {\n\n\t\t\t\t\t\tduration: 0.3,\n\t\t\t\t\t\ttiming: 'cubic-bezier(0.175, 0.885, 0.320, 1.175)'\n\n\t\t\t\t\t}, $.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tif (typeof this.$modalBox !== 'undefined')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.$modalBox.remove();\n\t\t\t\t\t\t\tthis.$modalBox = undefined;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$(document.body).css('overflow', this.modal.bodyOveflow);\n\t\t\t\t\t\tthis.core.callback('modalClosed', this.modal.templateName);\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =observe\n\t\tobserve: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tload: function()\n\t\t\t\t{\n\t\t\t\t\tif (typeof this.opts.destroyed !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.observe.links();\n\t\t\t\t\tthis.observe.images();\n\n\t\t\t\t},\n\t\t\t\tisCurrent: function($el, $current)\n\t\t\t\t{\n\t\t\t\t\tif (typeof $current === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\t$current = $(this.selection.current());\n\t\t\t\t\t}\n\n\t\t\t\t\treturn $current.is($el) || $current.parents($el).length > 0;\n\t\t\t\t},\n\t\t\t\ttoolbar: function()\n\t\t\t\t{\n    \t\t\t\tthis.observe.buttons();\n\t    \t\t\tthis.observe.dropdowns();\n\t\t\t\t},\n\t\t\t\tbuttons: function(e, btnName)\n\t\t\t\t{\n\t\t\t\t\tvar current = this.selection.current();\n\t\t\t\t\tvar parent = this.selection.parent();\n\n\t\t\t\t\tif (e !== false) this.button.setInactiveAll();\n\t\t\t\t\telse             this.button.setInactiveAll(btnName);\n\n\n\t\t\t\t\tif (e === false && btnName !== 'html')\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($.inArray(btnName, this.opts.activeButtons) !== -1) this.button.toggleActive(btnName);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!this.utils.isRedactorParent(current))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// disable line\n\t\t\t\t\tif (this.core.editor().css('display') !== 'none')\n\t\t\t\t\t{\n\t    \t\t\t\tif (this.utils.isCurrentOrParentHeader() || this.utils.isCurrentOrParent(['table', 'pre', 'blockquote', 'li'])) this.button.disable('horizontalrule');\n    \t\t\t\t\telse this.button.enable('horizontalrule');\n\t\t\t\t\t}\n\n\t\t\t\t\t$.each(this.opts.activeButtonsStates, $.proxy(function(key, value)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar parentEl = $(parent).closest(key, this.$editor[0]);\n\t\t\t\t\t\tvar currentEl = $(current).closest(key, this.$editor[0]);\n\n\t\t\t\t\t\tif (parentEl.length !== 0 && !this.utils.isRedactorParent(parentEl))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!this.utils.isRedactorParent(currentEl))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (parentEl.length !== 0 || currentEl.closest(key, this.$editor[0]).length !== 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.button.setActive(value);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t},\n\t\t\t\tdropdowns: function()\n\t\t\t\t{\n    \t\t\t\tvar finded = $('<div />').html(this.selection.html()).find('a').length;\n\t\t\t\t\tvar $current = $(this.selection.current());\n\t\t\t\t\tvar isRedactor = this.utils.isRedactorParent($current);\n\n\t\t\t\t\t$.each(this.opts.observe.dropdowns, $.proxy(function(key, value)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar observe = value.observe,\n\t\t\t\t\t\t\telement = observe.element,\n\t\t\t\t\t\t\t$item   = value.item,\n\t\t\t\t\t\t\tinValues = typeof observe['in'] !== 'undefined' ? observe['in'] : false,\n\t\t\t\t\t\t\toutValues = typeof observe.out !== 'undefined' ? observe.out : false;\n\n\t\t\t\t\t\tif (($current.closest(element).length > 0 && isRedactor) || (element === 'a' && finded !== 0))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.observe.setDropdownProperties($item, inValues, outValues);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.observe.setDropdownProperties($item, outValues, inValues);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\tsetDropdownProperties: function($item, addProperties, deleteProperties)\n\t\t\t\t{\n\t\t\t\t\tif (deleteProperties && typeof deleteProperties.attr !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.observe.setDropdownAttr($item, deleteProperties.attr, true);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (typeof addProperties.attr !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.observe.setDropdownAttr($item, addProperties.attr);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (typeof addProperties.title !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\t$item.find('span').text(addProperties.title);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsetDropdownAttr: function($item, properties, isDelete)\n\t\t\t\t{\n\t\t\t\t\t$.each(properties, function(key, value)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (key === 'class')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (!isDelete)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$item.addClass(value);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$item.removeClass(value);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (!isDelete)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$item.attr(key, value);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$item.removeAttr(key);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\taddDropdown: function($item, btnName, btnObject)\n\t\t\t\t{\n\t\t\t\t\tif (typeof btnObject.observe === \"undefined\")\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tbtnObject.item = $item;\n\n\t\t\t\t\tthis.opts.observe.dropdowns.push(btnObject);\n\t\t\t\t},\n\t\t\t\timages: function()\n\t\t\t\t{\n                    if (this.opts.imageEditable)\n                    {\n                        this.core.editor().addClass('redactor-layer-img-edit');\n    \t\t\t\t\tthis.core.editor().find('img').each($.proxy(function(i, img)\n    \t\t\t\t\t{\n    \t\t\t\t\t\tvar $img = $(img);\n\n    \t\t\t\t\t\t// IE fix (when we clicked on an image and then press backspace IE does goes to image's url)\n    \t\t\t\t\t\t$img.closest('a', this.$editor[0]).on('click', function(e) { e.preventDefault(); });\n\n    \t\t\t\t\t\tthis.image.setEditable($img);\n\n\n    \t\t\t\t\t}, this));\n                    }\n\t\t\t\t},\n\t\t\t\tlinks: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.linkTooltip)\n\t\t\t\t\t{\n    \t\t\t\t\tthis.core.editor().find('a').each($.proxy(function(i, s)\n    \t\t\t\t\t{\n        \t\t\t\t\tvar $link = $(s);\n        \t\t\t\t\tif ($link.data('cached') !== true)\n        \t\t\t\t\t{\n            \t\t\t\t\t$link.data('cached', true);\n            \t\t\t\t\t$link.on('touchstart.redactor.' + this.uuid + ' click.redactor.' + this.uuid, $.proxy(this.observe.showTooltip, this));\n        \t\t\t\t\t}\n\n    \t\t\t\t\t}, this));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tgetTooltipPosition: function($link)\n\t\t\t\t{\n\t\t\t\t\treturn $link.offset();\n\t\t\t\t},\n\t\t\t\tshowTooltip: function(e)\n\t\t\t\t{\n\t\t\t\t\tvar $el = $(e.target);\n\n\t\t\t\t\tif ($el[0].tagName === 'IMG')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($el[0].tagName !== 'A')\n\t\t\t\t\t{\n\t\t\t\t\t\t$el = $el.closest('a', this.$editor[0]);\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($el[0].tagName !== 'A')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $link = $el;\n\n\t\t\t\t\tvar pos = this.observe.getTooltipPosition($link);\n\t\t\t\t\tvar tooltip = $('<span class=\"redactor-link-tooltip\"></span>');\n\n\t\t\t\t\tvar href = $link.attr('href');\n\t\t\t\t\tif (href === undefined)\n\t\t\t\t\t{\n\t\t\t\t\t\thref = '';\n\t\t\t\t\t}\n\n\t\t\t\t\tif (href.length > 24)\n\t\t\t\t\t{\n\t\t\t\t\t\thref = href.substring(0, 24) + '...';\n\t\t\t\t\t}\n\n\t\t\t\t\tvar aLink = $('<a href=\"' + $link.attr('href') + '\" target=\"_blank\" />').html(href).addClass('redactor-link-tooltip-action');\n\t\t\t\t\tvar aEdit = $('<a href=\"#\" />').html(this.lang.get('edit')).on('click', $.proxy(this.link.show, this)).addClass('redactor-link-tooltip-action');\n\t\t\t\t\tvar aUnlink = $('<a href=\"#\" />').html(this.lang.get('unlink')).on('click', $.proxy(this.link.unlink, this)).addClass('redactor-link-tooltip-action');\n\n\t\t\t\t\ttooltip.append(aLink).append(' | ').append(aEdit).append(' | ').append(aUnlink);\n\n\t\t\t\t\tvar lineHeight = parseInt($link.css('line-height'), 10);\n                    var lineClicked = Math.ceil((e.pageY - pos.top)/lineHeight);\n                    var top = pos.top + lineClicked * lineHeight;\n\n\t\t\t\t\ttooltip.css({\n\t\t\t\t\t\ttop: top + 'px',\n\t\t\t\t\t\tleft: pos.left + 'px'\n\t\t\t\t\t});\n\n\t\t\t\t\t$('.redactor-link-tooltip').remove();\n\t\t\t\t\t$('body').append(tooltip);\n\n\t\t\t\t\tthis.core.editor().on('touchstart.redactor.' + this.uuid + ' click.redactor.' + this.uuid, $.proxy(this.observe.closeTooltip, this));\n\t\t\t\t\t$(document).on('touchstart.redactor.' + this.uuid + ' click.redactor.' + this.uuid, $.proxy(this.observe.closeTooltip, this));\n\t\t\t\t},\n\t\t\t\tcloseAllTooltip: function()\n\t\t\t\t{\n\t\t\t\t\t$('.redactor-link-tooltip').remove();\n\t\t\t\t},\n\t\t\t\tcloseTooltip: function(e)\n\t\t\t\t{\n\t\t\t\t\te = e.originalEvent || e;\n\n\t\t\t\t\tvar target = e.target;\n\t\t\t\t\tvar $parent = $(target).closest('a', this.$editor[0]);\n\t\t\t\t\tif ($parent.length !== 0 && $parent[0].tagName === 'A' && target.tagName !== 'A')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\telse if ((target.tagName === 'A' && this.utils.isRedactorParent(target)) || $(target).hasClass('redactor-link-tooltip-action'))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.observe.closeAllTooltip();\n\n\t\t\t\t\tthis.core.editor().off('touchstart.redactor.' + this.uuid + ' click.redactor.' + this.uuid, $.proxy(this.observe.closeTooltip, this));\n\t\t\t\t\t$(document).off('touchstart.redactor.' + this.uuid + ' click.redactor.' + this.uuid, $.proxy(this.observe.closeTooltip, this));\n\t\t\t\t}\n\n\t\t\t};\n\t\t},\n\n\t\t// =offset\n\t\toffset: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tget: function(node)\n\t\t\t\t{\n\t\t\t\t\tvar cloned = this.offset.clone(node);\n\t\t\t\t\tif (cloned === false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn 0;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar div = document.createElement('div');\n\t\t\t\t\tdiv.appendChild(cloned.cloneContents());\n\t\t\t\t\tdiv.innerHTML = div.innerHTML.replace(/<img(.*?[^>])>$/gi, 'i');\n\n\t\t\t        var text = $.trim($(div).text()).replace(/[\\t\\n\\r\\n]/g, '').replace(/\\u200B/g, '');\n\n\t\t\t\t\treturn text.length;\n\n\t\t\t\t},\n\t\t\t\tclone: function(node)\n\t\t\t\t{\n\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\tvar range = this.selection.range(sel);\n\n\t\t\t\t\tif (range === null && typeof node === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = (typeof node === 'undefined') ? this.$editor : node;\n\t\t\t\t\tif (node === false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = node[0] || node;\n\n\t\t\t\t\tvar cloned = range.cloneRange();\n\t\t\t\t\tcloned.selectNodeContents(node);\n\t\t\t\t\tcloned.setEnd(range.endContainer, range.endOffset);\n\n\t\t\t\t\treturn cloned;\n\t\t\t\t},\n\t\t\t\tset: function(start, end)\n\t\t\t\t{\n\t\t\t\t\tend = (typeof end === 'undefined') ? start : end;\n\n\t\t\t\t\tif (!this.focus.is())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.focus.start();\n\t\t\t\t\t}\n\n\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\tvar range = this.selection.range(sel);\n\t\t\t\t\tvar node, offset = 0;\n\t\t\t\t\tvar walker = document.createTreeWalker(this.$editor[0], NodeFilter.SHOW_TEXT, null, null);\n\n\t\t\t\t\twhile ((node = walker.nextNode()) !== null)\n\t\t\t\t\t{\n\t\t\t\t\t\toffset += node.nodeValue.length;\n\t\t\t\t\t\tif (offset > start)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\trange.setStart(node, node.nodeValue.length + start - offset);\n\t\t\t\t\t\t\tstart = Infinity;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (offset >= end)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\trange.setEnd(node, node.nodeValue.length + end - offset);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\trange.collapse(false);\n\t\t\t\t\tthis.selection.update(sel, range);\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =paragraphize\n\t\tparagraphize: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tload: function(html)\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.paragraphize === false || this.opts.type === 'inline' || this.opts.type === 'pre')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn html;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (html === '' || html === '<p></p>')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.opts.emptyHtml;\n\t\t\t\t\t}\n\n\t\t\t\t\thtml = html + \"\\n\";\n\n\t\t\t\t\tthis.paragraphize.safes = [];\n\t\t\t\t\tthis.paragraphize.z = 0;\n\n\t\t\t\t\t// before\n\t\t\t\t\thtml = html.replace(/(<br\\s?\\/?>){1,}\\n?<\\/blockquote>/gi, '</blockquote>');\n\t\t\t\t\thtml = html.replace(/<\\/pre>/gi, \"</pre>\\n\\n\");\n\t\t\t\t\thtml = html.replace(/<p>\\s<br><\\/p>/gi, '<p></p>');\n\n\t\t\t\t\thtml = this.paragraphize.getSafes(html);\n\n\t\t\t\t\thtml = html.replace('<br>', \"\\n\");\n\t\t\t\t\thtml = this.paragraphize.convert(html);\n\n\t\t\t\t\thtml = this.paragraphize.clear(html);\n\t\t\t\t\thtml = this.paragraphize.restoreSafes(html);\n\n\t\t\t\t\t// after\n\t\t\t\t\thtml = html.replace(new RegExp('<br\\\\s?/?>\\n?<(' + this.opts.paragraphizeBlocks.join('|') + ')(.*?[^>])>', 'gi'), '<p><br /></p>\\n<$1$2>');\n\n\t\t\t\t\treturn $.trim(html);\n\t\t\t\t},\n\t\t\t\tgetSafes: function(html)\n\t\t\t\t{\n\t\t\t\t\tvar $div = $('<div />').append(html);\n\n\t\t\t\t\t// remove paragraphs in blockquotes\n\t\t\t\t\t$div.find('blockquote p').replaceWith(function()\n\t\t\t\t\t{\n\t\t\t\t\t\treturn $(this).append('<br />').contents();\n\t\t\t\t\t});\n\n                    $div.find(this.opts.paragraphizeBlocks.join(', ')).each($.proxy(function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.paragraphize.z++;\n\t\t\t\t\t\tthis.paragraphize.safes[this.paragraphize.z] = s.outerHTML;\n\n\t\t\t\t\t\treturn $(s).replaceWith(\"\\n#####replace\" + this.paragraphize.z + \"#####\\n\\n\");\n\n\n\t\t\t\t\t}, this));\n\n                    // deal with redactor selection markers\n                    $div.find('span.redactor-selection-marker').each($.proxy(function(i,s)\n                    {\n                        this.paragraphize.z++;\n                        this.paragraphize.safes[this.paragraphize.z] = s.outerHTML;\n\n                        return $(s).replaceWith(\"\\n#####replace\" + this.paragraphize.z + \"#####\\n\\n\");\n                    }, this));\n\n\t\t\t\t\treturn $div.html();\n\t\t\t\t},\n\t\t\t\trestoreSafes: function(html)\n\t\t\t\t{\n\t\t\t\t\t$.each(this.paragraphize.safes, function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\ts = (typeof s !== 'undefined') ? s.replace(/\\$/g, '&#36;') : s;\n\t\t\t\t\t\thtml = html.replace('#####replace' + i + '#####', s);\n\n\t\t\t\t\t});\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tconvert: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = html.replace(/\\r\\n/g, \"xparagraphmarkerz\");\n\t\t\t\t\thtml = html.replace(/\\n/g, \"xparagraphmarkerz\");\n\t\t\t\t\thtml = html.replace(/\\r/g, \"xparagraphmarkerz\");\n\n\t\t\t\t\tvar re1 = /\\s+/g;\n\t\t\t\t\thtml = html.replace(re1, \" \");\n\t\t\t\t\thtml = $.trim(html);\n\n\t\t\t\t\tvar re2 = /xparagraphmarkerzxparagraphmarkerz/gi;\n\t\t\t\t\thtml = html.replace(re2, \"</p><p>\");\n\n\t\t\t\t\tvar re3 = /xparagraphmarkerz/gi;\n\t\t\t\t\thtml = html.replace(re3, \"<br>\");\n\n\t\t\t\t\thtml = '<p>' + html + '</p>';\n\n\t\t\t\t\thtml = html.replace(\"<p></p>\", \"\");\n\t\t\t\t\thtml = html.replace(\"\\r\\n\\r\\n\", \"\");\n\t\t\t\t\thtml = html.replace(/<\\/p><p>/g, \"</p>\\r\\n\\r\\n<p>\");\n\t\t\t\t\thtml = html.replace(new RegExp(\"<br\\\\s?/?></p>\", \"g\"), \"</p>\");\n\t\t\t\t\thtml = html.replace(new RegExp(\"<p><br\\\\s?/?>\", \"g\"), \"<p>\");\n\t\t\t\t\thtml = html.replace(new RegExp(\"<p><br\\\\s?/?>\", \"g\"), \"<p>\");\n\t\t\t\t\thtml = html.replace(new RegExp(\"<br\\\\s?/?></p>\", \"g\"), \"</p>\");\n\t\t\t\t\thtml = html.replace(/<p>&nbsp;<\\/p>/gi, \"\");\n\t\t\t\t\thtml = html.replace(/<p>\\s?<br>&nbsp;<\\/p>/gi, '');\n\t\t\t\t\thtml = html.replace(/<p>\\s?<br>/gi, '<p>');\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tclear: function(html)\n\t\t\t\t{\n\n\t\t\t\t\thtml = html.replace(/<p>(.*?)#####replace(.*?)#####\\s?<\\/p>/gi, '<p>$1</p>#####replace$2#####');\n\t\t\t\t\thtml = html.replace(/(<br\\s?\\/?>){2,}<\\/p>/gi, '</p>');\n\n\t\t\t\t\thtml = html.replace(new RegExp('</blockquote></p>', 'gi'), '</blockquote>');\n\t\t\t\t\thtml = html.replace(new RegExp('<p></blockquote>', 'gi'), '</blockquote>');\n\t\t\t\t\thtml = html.replace(new RegExp('<p><blockquote>', 'gi'), '<blockquote>');\n\t\t\t\t\thtml = html.replace(new RegExp('<blockquote></p>', 'gi'), '<blockquote>');\n\n\t\t\t\t\thtml = html.replace(new RegExp('<p><p ', 'gi'), '<p ');\n\t\t\t\t\thtml = html.replace(new RegExp('<p><p>', 'gi'), '<p>');\n\t\t\t\t\thtml = html.replace(new RegExp('</p></p>', 'gi'), '</p>');\n\t\t\t\t\thtml = html.replace(new RegExp('<p>\\\\s?</p>', 'gi'), '');\n\t\t\t\t\thtml = html.replace(new RegExp(\"\\n</p>\", 'gi'), '</p>');\n\t\t\t\t\thtml = html.replace(new RegExp('<p>\\t?\\t?\\n?<p>', 'gi'), '<p>');\n\t\t\t\t\thtml = html.replace(new RegExp('<p>\\t*</p>', 'gi'), '');\n\n\t\t\t\t\treturn html;\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =paste\n\t\tpaste: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tinit: function(e)\n\t\t\t\t{\n\t\t\t\t\tthis.rtePaste = true;\n\t\t\t\t\tvar pre = (this.opts.type === 'pre' || this.utils.isCurrentOrParent('pre')) ? true : false;\n\n\t\t\t\t\t// clipboard event\n\t\t\t\t\tif (this.detect.isDesktop())\n\t\t\t\t\t{\n\n    \t\t\t\t\tif (!this.paste.pre && this.opts.clipboardImageUpload && this.opts.imageUpload && this.paste.detectClipboardUpload(e))\n    \t\t\t\t\t{\n    \t\t\t\t\t\tif (this.detect.isIe())\n    \t\t\t\t\t\t{\n    \t\t\t\t\t\t\tsetTimeout($.proxy(this.paste.clipboardUpload, this), 100);\n    \t\t\t\t\t\t}\n\n    \t\t\t\t\t\treturn;\n    \t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.utils.saveScroll();\n\t\t\t\t\tthis.selection.save();\n\t\t\t\t\tthis.paste.createPasteBox(pre);\n\n\t\t\t\t\t$(window).on('scroll.redactor-freeze', $.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\t$(window).scrollTop(this.saveBodyScroll);\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\tsetTimeout($.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tvar html = this.paste.getPasteBoxCode(pre);\n\n\t\t\t\t\t\t// buffer\n\t\t\t\t\t\tthis.buffer.set();\n\t\t\t\t\t\tthis.selection.restore();\n\n\t\t\t\t\t\tthis.utils.restoreScroll();\n\n\t\t\t\t\t\t// paste info\n\t\t\t\t\t\tvar data = this.clean.getCurrentType(html);\n\n\t\t\t\t\t\t// clean\n\t\t\t\t\t\thtml = this.clean.onPaste(html, data);\n\n\t\t\t\t\t\t// callback\n\t\t\t\t\t\tvar returned = this.core.callback('paste', html);\n\t\t\t\t\t\thtml = (typeof returned === 'undefined') ? html : returned;\n\n\t\t\t\t\t\tthis.paste.insert(html, data);\n\t\t\t\t\t\tthis.rtePaste = false;\n\n\t\t\t\t\t\t// clean pre breaklines\n\t\t\t\t\t\tif (pre)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.clean.cleanPre();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$(window).off('scroll.redactor-freeze');\n\n\t\t\t\t\t}, this), 1);\n\n\t\t\t\t},\n\t\t\t\tgetPasteBoxCode: function(pre)\n\t\t\t\t{\n\t\t\t\t\tvar html = (pre) ? this.$pasteBox.val() : this.$pasteBox.html();\n\t\t\t\t\tthis.$pasteBox.remove();\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tcreatePasteBox: function(pre)\n\t\t\t\t{\n\t\t\t\t\tvar css = { position: 'fixed', width: '1px', top: 0, left: '-9999px' };\n\n\t\t\t\t\tthis.$pasteBox = (pre) ? $('<textarea>').css(css) : $('<div>').attr('contenteditable', 'true').css(css);\n\t\t\t\t\tthis.paste.appendPasteBox();\n\t\t\t\t\tthis.$pasteBox.focus();\n\t\t\t\t},\n\t\t\t\tappendPasteBox: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.detect.isIe())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.box().append(this.$pasteBox);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t// bootstrap modal\n\t\t\t\t\t\tvar $visibleModals = $('.modal-body:visible');\n\t\t\t\t\t\tif ($visibleModals.length > 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$visibleModals.append(this.$pasteBox);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$('body').prepend(this.$pasteBox);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tdetectClipboardUpload: function(e)\n\t\t\t\t{\n\t\t\t\t\te = e.originalEvent || e;\n\n\t\t\t\t\tvar clipboard = e.clipboardData;\n\t\t\t\t\tif (this.detect.isIe() || this.detect.isFirefox())\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// prevent safari fake url\n\t\t\t\t\tvar types = clipboard.types;\n\t\t\t\t\tif (types.indexOf('public.tiff') !== -1)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!clipboard.items || !clipboard.items.length)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar file = clipboard.items[0].getAsFile();\n\t\t\t\t\tif (file === null)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar reader = new FileReader();\n\t\t\t\t\treader.readAsDataURL(file);\n\t\t\t\t\treader.onload = $.proxy(this.paste.insertFromClipboard, this);\n\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t\tclipboardUpload: function()\n\t\t\t\t{\n\t\t\t\t\tvar imgs = this.$editor.find('img');\n\t\t\t\t\t$.each(imgs, $.proxy(function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (s.src.search(/^data\\:image/i) === -1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar formData = !!window.FormData ? new FormData() : null;\n\t\t\t\t\t\tif (!window.FormData)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.upload.direct = true;\n\t\t\t\t\t\tthis.upload.type = 'image';\n\t\t\t\t\t\tthis.upload.url = this.opts.imageUpload;\n\t\t\t\t\t\tthis.upload.callback = $.proxy(function(data)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (this.detect.isIe())\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$(s).wrap($('<figure />'));\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvar $parent = $(s).parent();\n\t\t\t\t\t\t\t\tthis.utils.replaceToTag($parent, 'figure');\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\ts.src = data.url;\n\t\t\t\t\t\t\tthis.core.callback('imageUpload', $(s), data);\n\n\t\t\t\t\t\t}, this);\n\n\t\t\t\t\t\tvar blob = this.utils.dataURItoBlob(s.src);\n\n\t\t\t\t\t\tformData.append('clipboard', 1);\n\t\t\t\t\t\tformData.append(this.opts.imageUploadParam, blob);\n\n\t\t\t\t\t\tthis.progress.show();\n\t\t\t\t\t\tthis.upload.send(formData, false);\n\t\t\t\t\t\tthis.code.sync();\n\t\t\t\t\t\tthis.rtePaste = false;\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\tinsertFromClipboard: function(e)\n\t\t\t\t{\n\t\t\t\t\tvar formData = !!window.FormData ? new FormData() : null;\n\t\t\t\t\tif (!window.FormData)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.upload.direct = true;\n\t\t\t\t\tthis.upload.type = 'image';\n\t\t\t\t\tthis.upload.url = this.opts.imageUpload;\n\t\t\t\t\tthis.upload.callback = this.image.insert;\n\n\t\t\t\t\tvar blob = this.utils.dataURItoBlob(e.target.result);\n\n\t\t\t\t\tformData.append('clipboard', 1);\n\t\t\t\t\tformData.append(this.opts.imageUploadParam, blob);\n\n\t\t\t\t\tthis.progress.show();\n\t\t\t\t\tthis.upload.send(formData, e);\n\t\t\t\t\tthis.rtePaste = false;\n\t\t\t\t},\n\t\t\t\tinsert: function(html, data)\n\t\t\t\t{\n\t\t\t\t\tif (data.pre)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.insert.raw(html);\n\t\t\t\t\t}\n\t\t\t\t\telse if (data.text)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.insert.text(html);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.insert.html(html, data);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Firefox Clipboard Observe\n\t\t\t\t\tif (this.detect.isFirefox() && this.opts.clipboardImageUpload)\n\t\t\t\t\t{\n\t\t\t\t\t\tsetTimeout($.proxy(this.paste.clipboardUpload, this), 100);\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =placeholder\n\t\tplaceholder: function()\n\t\t{\n\t\t\treturn {\n\n\t\t\t\t// public\n\t\t\t\tenable: function()\n\t\t\t\t{\n\t\t\t\t\tsetTimeout($.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\treturn (this.placeholder.isEditorEmpty()) ? this.placeholder.show() : this.placeholder.hide();\n\n\t\t\t\t\t}, this), 5);\n\t\t\t\t},\n\t\t\t\tshow: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().addClass('redactor-placeholder');\n\t\t\t\t},\n\t\t\t\tupdate: function(text)\n\t\t\t\t{\n\t\t\t\t\tthis.opts.placeholder = text;\n\t\t\t\t\tthis.core.editor().attr('placeholder', text);\n\t\t\t\t},\n\t\t\t\thide: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().removeClass('redactor-placeholder');\n\t\t\t\t},\n\t\t\t\tis: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.core.editor().hasClass('redactor-placeholder');\n\t\t\t\t},\n\n\n\t\t\t\t// private\n\t\t\t\tinit: function()\n\t\t\t\t{\n\t\t\t\t\tif (!this.placeholder.enabled())\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!this.utils.isEditorRelative())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.utils.setEditorRelative();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.placeholder.build();\n\t\t\t\t\tthis.placeholder.buildPosition();\n\t\t\t\t\tthis.placeholder.enable();\n\t\t\t\t\tthis.placeholder.enableEvents();\n\n\t\t\t\t},\n\t\t\t\tenabled: function()\n\t\t\t\t{\n\t\t\t\t\treturn (this.opts.placeholder) ? this.core.element().attr('placeholder', this.opts.placeholder) : this.placeholder.isAttr();\n\t\t\t\t},\n\t\t\t\tenableEvents: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().on('keydown.redactor-placeholder.' + this.uuid, $.proxy(this.placeholder.enable, this));\n\t\t\t\t},\n\t\t\t\tdisableEvents: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().off('.redactor-placeholder.' + this.uuid);\n\t\t\t\t},\n\t\t\t\tbuild: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().attr('placeholder', this.core.element().attr('placeholder'));\n\t\t\t\t},\n\t\t\t\tbuildPosition: function()\n\t\t\t\t{\n\t\t\t\t\tvar $style = $('<style />');\n\t\t\t\t\t$style.addClass('redactor-placeholder-style-tag');\n\t\t\t\t\t$style.html('#' + this.core.id() + '.redactor-placeholder::after ' + this.placeholder.getPosition());\n\n\t\t\t\t\t$('head').append($style);\n\t\t\t\t},\n\t\t\t\tgetPosition: function()\n\t\t\t\t{\n\t\t\t\t\treturn '{ top: ' + this.core.editor().css('padding-top') + '; left: ' + this.core.editor().css('padding-left') + '; }';\n\t\t\t\t},\n\t\t\t\tisEditorEmpty: function()\n\t\t\t\t{\n\t\t\t\t\tvar html = $.trim(this.core.editor().html()).replace(/[\\t\\n]/g, '');\n\t\t\t\t\tvar states = ['', '<p>​</p>', '<p>​<br></p>', this.opts.emptyHtmlRendered];\n\n\t\t\t\t\treturn ($.inArray(html, states) !== -1);\n\t\t\t\t},\n\t\t\t\tisAttr: function()\n\t\t\t\t{\n\t\t\t\t\treturn (typeof this.core.element().attr('placeholder') !== 'undefined' && this.core.element().attr('placeholder') !== '');\n\t\t\t\t},\n\t\t\t\tdestroy: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().removeAttr('placeholder');\n\n\t\t\t\t\tthis.placeholder.hide();\n\t\t\t\t\tthis.placeholder.disableEvents();\n\n\t\t\t\t\t$('.redactor-placeholder-style-tag').remove();\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =progress\n\t\tprogress: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\t$box: null,\n\t\t\t\t$bar: null,\n\t\t\t\ttarget: document.body,  // or id selector\n\n\t\t\t\t// public\n\t\t\t\tshow: function()\n\t\t\t\t{\n\t\t\t\t\tif (!this.progress.is())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.progress.build();\n\t\t\t\t\t\tthis.progress.$box.redactorAnimation('fadeIn');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.progress.$box.show();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\thide: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.progress.is())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.progress.$box.redactorAnimation('fadeOut', { duration: 0.35 }, $.proxy(this.progress.destroy, this));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tupdate: function(value)\n\t\t\t\t{\n\t\t\t\t\tthis.progress.show();\n\t\t\t\t\tthis.progress.$bar.css('width', value + '%');\n\t\t\t\t},\n\t\t\t\tis: function()\n\t\t\t\t{\n\t\t\t\t\treturn (this.progress.$box === null) ? false : true;\n\t\t\t\t},\n\n\t\t\t\t// private\n\t\t\t\tbuild: function()\n\t\t\t\t{\n\t\t\t\t\tthis.progress.$bar = $('<span />');\n\t\t\t\t\tthis.progress.$box = $('<div id=\"redactor-progress\" />');\n\n\t\t\t\t\tthis.progress.$box.append(this.progress.$bar);\n\t\t\t\t\t$(this.progress.target).append(this.progress.$box);\n\t\t\t\t},\n\t\t\t\tdestroy: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.progress.is())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.progress.$box.remove();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.progress.$box = null;\n\t\t\t\t\tthis.progress.$bar = null;\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =selection\n\t\tselection: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tget: function()\n\t\t\t\t{\n\t\t\t\t\tif (window.getSelection)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn window.getSelection();\n\t\t\t\t\t}\n\t\t\t\t\telse if (document.selection && document.selection.type !== \"Control\")\n\t\t\t\t\t{\n\t\t\t\t\t\treturn document.selection;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn null;\n\t\t\t\t},\n\t\t\t\trange: function(sel)\n\t\t\t\t{\n\t\t\t\t\tif (typeof sel === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tsel = this.selection.get();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (sel.getRangeAt && sel.rangeCount)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn sel.getRangeAt(0);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn null;\n\t\t\t\t},\n\t\t\t\tis: function()\n\t\t\t\t{\n\t\t\t\t\treturn (this.selection.isCollapsed()) ? false : true;\n\t\t\t\t},\n\t\t\t\tisRedactor: function()\n\t\t\t\t{\n\t\t\t\t\tvar range = this.selection.range();\n\n\t\t\t\t\tif (range !== null)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar el = range.startContainer.parentNode;\n\n\t\t\t\t\t\tif ($(el).hasClass('redactor-in') || $(el).parents('.redactor-in').length !== 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\tisCollapsed: function()\n\t\t\t\t{\n\t\t\t\t\tvar sel = this.selection.get();\n\n\t\t\t\t\treturn (sel === null) ? false : sel.isCollapsed;\n\t\t\t\t},\n\t\t\t\tupdate: function(sel, range)\n\t\t\t\t{\n\t\t\t\t\tif (range === null)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tsel.removeAllRanges();\n\t\t\t\t\tsel.addRange(range);\n\t\t\t\t},\n\t\t\t\tcurrent: function()\n\t\t\t\t{\n\t\t\t\t\tvar sel = this.selection.get();\n\n\t\t\t\t\treturn (sel === null) ? false : sel.anchorNode;\n\t\t\t\t},\n\t\t\t\tparent: function()\n\t\t\t\t{\n\t\t\t\t\tvar current = this.selection.current();\n\n\t\t\t\t\treturn (current === null) ? false : current.parentNode;\n\t\t\t\t},\n\t\t\t\tblock: function(node)\n\t\t\t\t{\n\t\t\t\t\tnode = node || this.selection.current();\n\n\t\t\t\t\twhile (node)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.utils.isBlockTag(node.tagName))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn ($(node).hasClass('redactor-in')) ? false : node;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\tinline: function(node)\n\t\t\t\t{\n\t\t\t\t\tnode = node || this.selection.current();\n\n\t\t\t\t\twhile (node)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.utils.isInlineTag(node.tagName))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn ($(node).hasClass('redactor-in')) ? false : node;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\telement: function(node)\n\t\t\t\t{\n\t\t\t\t\tif (!node)\n\t\t\t\t\t{\n\t\t\t\t\t\tnode = this.selection.current();\n\t\t\t\t\t}\n\n\t\t\t\t\twhile (node)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (node.nodeType === 1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif ($(node).hasClass('redactor-in'))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn node;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\tprev: function()\n\t\t\t\t{\n\t\t\t\t\tvar current = this.selection.current();\n\n\t\t\t\t\treturn (current === null) ? false : this.selection.current().previousSibling;\n\t\t\t\t},\n\t\t\t\tnext: function()\n\t\t\t\t{\n\t\t\t\t\tvar current = this.selection.current();\n\n\t\t\t\t\treturn (current === null) ? false : this.selection.current().nextSibling;\n\t\t\t\t},\n\t\t\t\tblocks: function(tag)\n\t\t\t\t{\n\t\t\t\t\tvar blocks = [];\n\t\t\t\t\tvar nodes = this.selection.nodes(tag);\n\n\t\t\t\t\t$.each(nodes, $.proxy(function(i,node)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.utils.isBlock(node))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tblocks.push(node);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\tvar block = this.selection.block();\n\t\t\t\t\tif (blocks.length === 0 && block === false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn [];\n\t\t\t\t\t}\n\t\t\t\t\telse if (blocks.length === 0 && block !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn [block];\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\treturn blocks;\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tinlines: function(tag)\n\t\t\t\t{\n\t\t\t\t\tvar inlines = [];\n\t\t\t\t\tvar nodes = this.selection.nodes(tag);\n\n\t\t\t\t\t$.each(nodes, $.proxy(function(i,node)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.utils.isInline(node))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tinlines.push(node);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\tvar inline = this.selection.inline();\n\t\t\t\t\tif (inlines.length === 0 && inline === false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn [];\n\t\t\t\t\t}\n\t\t\t\t\telse if (inlines.length === 0 && inline !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn [inline];\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\treturn inlines;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tnodes: function(tag)\n\t\t\t\t{\n                    var filter = (typeof tag === 'undefined') ? [] : (($.isArray(tag)) ? tag : [tag]);\n\n\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\tvar range = this.selection.range(sel);\n                    var nodes = [];\n                    var resultNodes = [];\n\n\t\t\t\t\tif (this.utils.isCollapsed())\n\t\t\t\t\t{\n\t\t\t\t\t\tnodes = [this.selection.current()];\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tvar node = range.startContainer;\n\t\t\t\t\t\tvar endNode = range.endContainer;\n\n\t\t\t\t\t\t// single node\n\t\t\t\t\t\tif (node === endNode)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn [this.selection.parent()];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// iterate\n\t\t\t\t\t\twhile (node && node !== endNode)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tnodes.push(node = this.selection.nextNode(node));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// partially selected nodes\n\t\t\t\t\t\tnode = range.startContainer;\n\t\t\t\t\t\twhile (node && node !== range.commonAncestorContainer)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tnodes.unshift(node);\n\t\t\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// remove service nodes\n\t\t\t\t\t$.each(nodes, function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (s)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar tagName = (s.nodeType !== 1) ? false : s.tagName.toLowerCase();\n\n\t\t\t\t\t\t\tif ($(s).hasClass('redactor-script-tag') || $(s).hasClass('redactor-selection-marker'))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if (tagName && filter.length !== 0 && $.inArray(tagName, filter) === -1)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tresultNodes.push(s);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\treturn (resultNodes.length === 0) ? [] : resultNodes;\n\t\t\t\t},\n\t\t\t\tnextNode: function(node)\n\t\t\t\t{\n\t\t\t\t\tif (node.hasChildNodes())\n\t\t\t\t\t{\n\t\t\t\t\t\treturn node.firstChild;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\twhile (node && !node.nextSibling)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!node)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn node.nextSibling;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsave: function()\n\t\t\t\t{\n \t\t\t\t\tthis.marker.insert();\n\t\t\t\t\tthis.savedSel = this.core.editor().html();\n\t\t\t\t},\n\t\t\t\trestore: function(removeMarkers)\n\t\t\t\t{\n                    var node1 = this.marker.find(1);\n\t\t\t\t\tvar node2 = this.marker.find(2);\n\n\t\t\t\t\tif (this.detect.isFirefox())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().focus();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (node1.length !== 0 && node2.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.caret.set(node1, node2);\n\t\t\t\t\t}\n\t\t\t\t\telse if (node1.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.caret.start(node1);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().focus();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (removeMarkers !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.marker.remove();\n\t\t\t\t\t\tthis.savedSel = false;\n\t\t\t\t\t}\n\t\t\t\t},\n                saveInstant: function()\n                {\n                    var el = this.core.editor()[0];\n                    var doc = el.ownerDocument, win = doc.defaultView;\n                    var sel = win.getSelection();\n\n                    if (!sel.getRangeAt || !sel.rangeCount)\n                    {\n                        return;\n                    }\n\n                    var range = sel.getRangeAt(0);\n                    var selectionRange = range.cloneRange();\n\n                    selectionRange.selectNodeContents(el);\n                    selectionRange.setEnd(range.startContainer, range.startOffset);\n\n                    var start = selectionRange.toString().length;\n\n                    this.saved = {\n                        start: start,\n                        end: start + range.toString().length,\n                        node: range.startContainer\n                    };\n\n                    return this.saved;\n                },\n                restoreInstant: function(saved)\n                {\n                    if (typeof saved === 'undefined' && !this.saved)\n                    {\n                        return;\n                    }\n\n                    this.saved = (typeof saved !== 'undefined') ? saved : this.saved;\n\n                    var $node = this.core.editor().find(this.saved.node);\n                    if ($node.length !== 0 && $node.text().trim().replace(/\\u200B/g, '').length === 0)\n                    {\n                       try {\n                            var range = document.createRange();\n                            range.setStart($node[0], 0);\n\n                            var sel = window.getSelection();\n                            sel.removeAllRanges();\n                            sel.addRange(range);\n                        }\n                        catch(e) {}\n\n                        return;\n                    }\n\n                    var el = this.core.editor()[0];\n                    var doc = el.ownerDocument, win = doc.defaultView;\n                    var charIndex = 0, range = doc.createRange();\n\n                    range.setStart(el, 0);\n                    range.collapse(true);\n\n                    var nodeStack = [el], node, foundStart = false, stop = false;\n                    while (!stop && (node = nodeStack.pop()))\n                    {\n                        if (node.nodeType == 3)\n                        {\n                            var nextCharIndex = charIndex + node.length;\n                            if (!foundStart && this.saved.start >= charIndex && this.saved.start <= nextCharIndex)\n                            {\n                                range.setStart(node, this.saved.start - charIndex);\n                                foundStart = true;\n                            }\n\n                            if (foundStart && this.saved.end >= charIndex && this.saved.end <= nextCharIndex)\n                            {\n                                range.setEnd(node, this.saved.end - charIndex);\n                                stop = true;\n                            }\n                            charIndex = nextCharIndex;\n                        }\n                        else\n                        {\n                            var i = node.childNodes.length;\n                            while (i--)\n                            {\n                                nodeStack.push(node.childNodes[i]);\n                            }\n                        }\n                    }\n\n                    var sel = win.getSelection();\n                    sel.removeAllRanges();\n                    sel.addRange(range);\n                },\n\t\t\t\tnode: function(node)\n\t\t\t\t{\n\t\t\t\t\t$(node).prepend(this.marker.get(1));\n\t\t\t\t\t$(node).append(this.marker.get(2));\n\n\t\t\t\t\tthis.selection.restore();\n\t\t\t\t},\n\t\t\t\tall: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().focus();\n\n\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\tvar range = this.selection.range(sel);\n\n\t\t\t\t\trange.selectNodeContents(this.core.editor()[0]);\n\n\t\t\t\t\tthis.selection.update(sel, range);\n\t\t\t\t},\n\t\t\t\tremove: function()\n\t\t\t\t{\n\t\t\t\t\tthis.selection.get().removeAllRanges();\n\t\t\t\t},\n\t\t\t\treplace: function(html)\n\t\t\t\t{\n\t\t\t\t\tthis.insert.html(html);\n\t\t\t\t},\n\t\t\t\ttext: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.selection.get().toString();\n\t\t\t\t},\n\t\t\t\thtml: function()\n\t\t\t\t{\n\t\t\t\t\tvar html = '';\n\t\t\t\t\tvar sel = this.selection.get();\n\n\t\t\t\t\tif (sel.rangeCount)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar container = document.createElement('div');\n\t\t\t\t\t\tvar len = sel.rangeCount;\n\t\t\t\t\t\tfor (var i = 0; i < len; ++i)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcontainer.appendChild(sel.getRangeAt(i).cloneContents());\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\thtml = this.clean.onGet(container.innerHTML);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\textractEndOfNode: function(node)\n\t\t\t\t{\n\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\tvar range = this.selection.range(sel);\n\n\t\t\t        var clonedRange = range.cloneRange();\n\t\t\t        clonedRange.selectNodeContents(node);\n\t\t\t        clonedRange.setStart(range.endContainer, range.endOffset);\n\n\t\t\t        return clonedRange.extractContents();\n\t\t\t\t},\n\n\t\t\t\t// #backward\n\t\t\t\tremoveMarkers: function()\n\t\t\t\t{\n\t\t\t\t\tthis.marker.remove();\n\t\t\t\t},\n\t\t\t\tmarker: function(num)\n\t\t\t\t{\n\t\t\t\t\treturn this.marker.get(num);\n\t\t\t\t},\n\t\t\t\tmarkerHtml: function(num)\n\t\t\t\t{\n\t\t\t\t\treturn this.marker.html(num);\n\t\t\t\t}\n\n\t\t\t};\n\t\t},\n\n\t\t// =shortcuts\n\t\tshortcuts: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\t// based on https://github.com/jeresig/jquery.hotkeys\n\t\t\t\thotkeysSpecialKeys: {\n\t\t\t\t\t8: \"backspace\", 9: \"tab\", 10: \"return\", 13: \"return\", 16: \"shift\", 17: \"ctrl\", 18: \"alt\", 19: \"pause\",\n\t\t\t\t\t20: \"capslock\", 27: \"esc\", 32: \"space\", 33: \"pageup\", 34: \"pagedown\", 35: \"end\", 36: \"home\",\n\t\t\t\t\t37: \"left\", 38: \"up\", 39: \"right\", 40: \"down\", 45: \"insert\", 46: \"del\", 59: \";\", 61: \"=\",\n\t\t\t\t\t96: \"0\", 97: \"1\", 98: \"2\", 99: \"3\", 100: \"4\", 101: \"5\", 102: \"6\", 103: \"7\",\n\t\t\t\t\t104: \"8\", 105: \"9\", 106: \"*\", 107: \"+\", 109: \"-\", 110: \".\", 111 : \"/\",\n\t\t\t\t\t112: \"f1\", 113: \"f2\", 114: \"f3\", 115: \"f4\", 116: \"f5\", 117: \"f6\", 118: \"f7\", 119: \"f8\",\n\t\t\t\t\t120: \"f9\", 121: \"f10\", 122: \"f11\", 123: \"f12\", 144: \"numlock\", 145: \"scroll\", 173: \"-\", 186: \";\", 187: \"=\",\n\t\t\t\t\t188: \",\", 189: \"-\", 190: \".\", 191: \"/\", 192: \"`\", 219: \"[\", 220: \"\\\\\", 221: \"]\", 222: \"'\"\n\t\t\t\t},\n\t\t\t\thotkeysShiftNums: {\n\t\t\t\t\t\"`\": \"~\", \"1\": \"!\", \"2\": \"@\", \"3\": \"#\", \"4\": \"$\", \"5\": \"%\", \"6\": \"^\", \"7\": \"&\",\n\t\t\t\t\t\"8\": \"*\", \"9\": \"(\", \"0\": \")\", \"-\": \"_\", \"=\": \"+\", \";\": \": \", \"'\": \"\\\"\", \",\": \"<\",\n\t\t\t\t\t\".\": \">\",  \"/\": \"?\",  \"\\\\\": \"|\"\n\t\t\t\t},\n\t\t\t\tinit: function(e, key)\n\t\t\t\t{\n\t\t\t\t\t// disable browser's hot keys for bold and italic if shortcuts off\n\t\t\t\t\tif (this.opts.shortcuts === false)\n\t\t\t\t\t{\n\t\t\t\t\t\tif ((e.ctrlKey || e.metaKey) && (key === 66 || key === 73))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t// build\n\t\t\t\t\t\t$.each(this.opts.shortcuts, $.proxy(function(str, command)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.shortcuts.build(e, str, command);\n\n\t\t\t\t\t\t}, this));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tbuild: function(e, str, command)\n\t\t\t\t{\n\t\t\t\t\tvar handler = $.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.shortcuts.buildHandler(command);\n\n\t\t\t\t\t}, this);\n\n\t\t\t\t\tvar keys = str.split(',');\n\t\t\t\t\tvar len = keys.length;\n\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (typeof keys[i] === 'string')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.shortcuts.handler(e, $.trim(keys[i]), handler);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tbuildHandler: function(command)\n\t\t\t\t{\n\t\t\t\t\tvar func;\n\t\t\t\t\tif (command.func.search(/\\./) !== '-1')\n\t\t\t\t\t{\n\t\t\t\t\t\tfunc = command.func.split('.');\n\t\t\t\t\t\tif (typeof this[func[0]] !== 'undefined')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis[func[0]][func[1]].apply(this, command.params);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis[command.func].apply(this, command.params);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\thandler: function(e, keys, origHandler)\n\t\t\t\t{\n\t\t\t\t\tkeys = keys.toLowerCase().split(\" \");\n\n\t\t\t\t\tvar special = this.shortcuts.hotkeysSpecialKeys[e.keyCode];\n\t\t\t\t\tvar character = String.fromCharCode(e.which).toLowerCase();\n\t\t\t\t\tvar modif = \"\", possible = {};\n\n\t\t\t\t\t$.each([ \"alt\", \"ctrl\", \"meta\", \"shift\"], function(index, specialKey)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (e[specialKey + 'Key'] && special !== specialKey)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmodif += specialKey + '+';\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\n\t\t\t\t\tif (special)\n\t\t\t\t\t{\n\t\t\t\t\t\tpossible[modif + special] = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (character)\n\t\t\t\t\t{\n\t\t\t\t\t\tpossible[modif + character] = true;\n\t\t\t\t\t\tpossible[modif + this.shortcuts.hotkeysShiftNums[character]] = true;\n\n\t\t\t\t\t\t// \"$\" can be triggered as \"Shift+4\" or \"Shift+$\" or just \"$\"\n\t\t\t\t\t\tif (modif === \"shift+\")\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tpossible[this.shortcuts.hotkeysShiftNums[character]] = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tvar len = keys.length;\n\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (possible[keys[i]])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\treturn origHandler.apply(this, arguments);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =storage\n\t\tstorage: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tdata: [],\n\t\t\t\tadd: function(data)\n\t\t\t\t{\n\t\t\t\t\t// type, node, url, id\n\t\t\t\t\tdata.status = true;\n\t\t\t\t\tdata.url = decodeURI(data.url);\n\n\t\t\t\t\tthis.storage.data[data.url] = data;\n\t\t\t\t},\n\t\t\t\tstatus: function(url, status)\n\t\t\t\t{\n\t\t\t\t\tthis.storage.data[decodeURI(url)].status = status;\n\t\t\t\t},\n\t\t\t\tobserve: function()\n\t\t\t\t{\n\t\t\t\t\tvar _this = this;\n\n\t\t\t\t\tvar $images = this.core.editor().find('[data-image]');\n\t\t\t\t\t$images.each(function(i, s)\n\t\t\t\t\t{\n\t\t\t\t\t\t_this.storage.add({ type: 'image', node: s, url: s.src, id: $(s).attr('data-image') });\n\t\t\t\t\t});\n\n\t\t\t\t\tvar $files = this.core.editor().find('[data-file]');\n\t\t\t\t\t$files.each(function(i, s)\n\t\t\t\t\t{\n\t\t\t\t\t\t_this.storage.add({ type: 'file', node: s, url: s.href, id: $(s).attr('data-file') });\n\t\t\t\t\t});\n\n\t\t\t\t\tvar $s3 = this.core.editor().find('[data-s3]');\n\t\t\t\t\t$s3.each(function(i, s)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar url = (s.tagName === 'IMG') ? s.src : s.href;\n\t\t\t\t\t\t_this.storage.add({ type: 's3', node: s, url: url, id: $(s).attr('data-s3') });\n\t\t\t\t\t});\n\n\t\t\t\t},\n\t\t\t\tchanges: function()\n\t\t\t\t{\n\t\t\t\t\tfor (var key in this.storage.data)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar data = this.storage.data[key];\n\t\t\t\t\t\tvar attr = (data.node.tagName === 'IMG') ? 'src' : 'href';\n\t\t\t\t\t\tvar $el = this.core.editor().find('[data-' + data.type + '][' + attr + '=\"' + data.url + '\"]');\n\n\t\t\t\t\t\tif ($el.length === 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.storage.status(data.url, false);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.storage.status(data.url, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\n\t\t\t\t\treturn this.storage.data;\n\t\t\t\t}\n\n\t\t\t};\n\t\t},\n\n\t\t// =toolbar\n\t\ttoolbar: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tbuild: function()\n\t\t\t\t{\n\t\t\t\t\tthis.button.hideButtons();\n\t\t\t\t\tthis.button.hideButtonsOnMobile();\n\n\t\t\t\t\tthis.$toolbar = this.toolbar.createContainer();\n\n\t\t\t\t\tthis.toolbar.append();\n\t\t\t\t\tthis.button.$toolbar = this.$toolbar;\n\t\t\t\t\tthis.button.setFormatting();\n\t\t\t\t\tthis.button.load(this.$toolbar);\n\n\t\t\t\t\tthis.toolbar.setOverflow();\n\t\t\t\t\tthis.toolbar.setFixed();\n\n\t\t\t\t},\n\t\t\t\tcreateContainer: function()\n\t\t\t\t{\n\t\t\t\t\treturn $('<ul>').addClass('redactor-toolbar').attr({ 'id': 'redactor-toolbar-' + this.uuid, 'role': 'toolbar' });\n\t\t\t\t},\n\t\t\t\tappend: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.toolbarExternal)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$toolbar.addClass('redactor-toolbar-external');\n\t\t\t\t\t\t$(this.opts.toolbarExternal).html(this.$toolbar);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.opts.type === 'textarea')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.$box.prepend(this.$toolbar);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.$element.before(this.$toolbar);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsetOverflow: function()\n\t\t\t\t{\n    \t\t\t\tif (this.opts.toolbarOverflow)\n\t\t\t\t\t{\n    \t\t\t\t\tthis.$toolbar.addClass('redactor-toolbar-overflow');\n    \t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsetFixed: function()\n\t\t\t\t{\n\t\t\t\t\tif (!this.opts.toolbarFixed || this.opts.toolbarExternal)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.opts.toolbarFixedTarget !== document)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $el = $(this.opts.toolbarFixedTarget);\n\t\t\t\t\t\tthis.toolbar.toolbarOffsetTop = ($el.length === 0) ? 0 : this.core.box().offset().top - $el.offset().top;\n\t\t\t\t\t}\n\n\t\t\t\t\t// bootstrap modal fix\n\t\t\t\t\tvar late = (this.core.box().closest('.modal-body').length !== 0) ? 1000 : 0;\n\n\t\t\t\t\tsetTimeout($.proxy(function()\n\t\t\t\t\t{\n    \t\t\t\t\tvar self = this;\n\t\t\t\t\t\tthis.toolbar.observeScroll(false);\n\t\t\t\t\t\tif (this.detect.isDesktop())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(this.opts.toolbarFixedTarget).on('scroll.redactor.' + this.uuid, function()\n\t\t\t\t\t\t\t{\n                                if (self.core.editor().height() < 100 || self.placeholder.isEditorEmpty())\n            \t\t\t\t\t{\n                \t\t\t\t\treturn;\n            \t\t\t\t\t}\n\n    \t\t\t\t\t\t\tself.toolbar.observeScroll();\n                            });\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(this.opts.toolbarFixedTarget).on('scroll.redactor.' + this.uuid, function()\n\t\t\t\t\t\t\t{\n                                if (self.core.editor().height() < 100 || self.placeholder.isEditorEmpty())\n            \t\t\t\t\t{\n                \t\t\t\t\treturn;\n            \t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tself.core.toolbar().hide();\n\t\t\t\t\t\t\t\tclearTimeout($.data(this, \"scrollCheck\"));\n\t\t\t\t\t\t\t\t$.data(this, \"scrollCheck\", setTimeout(function()\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tself.core.toolbar().show();\n\t\t\t\t\t\t\t\t\tself.toolbar.observeScroll();\n\t\t\t\t\t\t\t\t}, 250) );\n\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}, this), late);\n\n\t\t\t\t},\n\t\t\t\tsetUnfixed: function()\n\t\t\t\t{\n    \t\t\t\tthis.toolbar.observeScrollDisable();\n\t\t\t\t},\n\t\t\t\tgetBoxTop: function()\n\t\t\t\t{\n\t\t\t\t\treturn (this.opts.toolbarFixedTarget === document) ? this.core.box().offset().top : this.toolbar.toolbarOffsetTop;\n\t\t\t\t},\n\t\t\t\tobserveScroll: function(start)\n\t\t\t\t{\n\t\t\t\t\t// tolerance 0 if redactor in the hidden layer\n\t\t\t\t\tvar tolerance = 0;\n\n\t\t\t\t\tif (start !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\ttolerance = (this.opts.toolbarFixedTarget === document) ? 20 : 0;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar scrollTop = $(this.opts.toolbarFixedTarget).scrollTop();\n\t\t\t\t\tvar boxTop = this.toolbar.getBoxTop();\n\n                    if (scrollTop === boxTop)\n                    {\n                        return;\n                    }\n\n\t\t\t\t\tif ((scrollTop + this.opts.toolbarFixedTopOffset + tolerance) > boxTop)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.toolbar.observeScrollEnable(scrollTop, boxTop);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.toolbar.observeScrollDisable();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tobserveScrollResize: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$toolbar.css({\n\n\t\t\t\t\t\twidth: this.core.box().innerWidth(),\n\t\t\t\t\t\tleft: this.core.box().offset().left\n\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tobserveScrollEnable: function(scrollTop, boxTop)\n\t\t\t\t{\n\t\t\t\t\tif (typeof this.fullscreen !== 'undefined' && this.fullscreen.isOpened === false)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.toolbar.observeScrollDisable();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar end = boxTop + this.core.box().outerHeight() - 32;\n\t\t\t\t\tvar width = this.core.box().innerWidth();\n\n\t\t\t\t\tvar position = (this.detect.isDesktop()) ? 'fixed' : 'absolute';\n\t\t\t\t\tvar top = (this.detect.isDesktop()) ? this.opts.toolbarFixedTopOffset : ($(this.opts.toolbarFixedTarget).scrollTop() - boxTop + this.opts.toolbarFixedTopOffset);\n\t\t\t\t\tvar left = (this.detect.isDesktop()) ? this.core.box().offset().left : 0;\n\n\t\t\t\t\tif (this.opts.toolbarFixedTarget !== document)\n\t\t\t\t\t{\n\t\t\t\t\t\t position = 'absolute';\n\t\t\t\t\t\t top = this.opts.toolbarFixedTopOffset + $(this.opts.toolbarFixedTarget).scrollTop() - boxTop;\n\t\t\t\t\t\t left = 0;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.$toolbar.addClass('toolbar-fixed-box');\n\n\t\t\t\t\tthis.$toolbar.css({\n\t\t\t\t\t\tposition: position,\n\t\t\t\t\t\twidth: width,\n\t\t\t\t\t\ttop: top,\n\t\t\t\t\t\tleft: left\n\t\t\t\t\t});\n\n\n\t\t\t\t\tif (scrollTop > end)\n\t\t\t\t\t{\n\t\t\t\t\t\t$('.redactor-dropdown-' + this.uuid + ':visible').hide();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.toolbar.setDropdownsFixed();\n\n\t\t\t\t\tthis.$toolbar.css('visibility', (scrollTop < end) ? 'visible' : 'hidden');\n\t\t\t\t\t$(window).on('resize.redactor-toolbar.' + this.uuid, $.proxy(this.toolbar.observeScrollResize, this));\n\t\t\t\t},\n\t\t\t\tobserveScrollDisable: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$toolbar.css({\n\t\t\t\t\t\tposition: 'relative',\n\t\t\t\t\t\twidth: 'auto',\n\t\t\t\t\t\ttop: 0,\n\t\t\t\t\t\tleft: 0,\n\t\t\t\t\t\tvisibility: 'visible'\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.toolbar.unsetDropdownsFixed();\n\t\t\t\t\tthis.$toolbar.removeClass('toolbar-fixed-box');\n\t\t\t\t\t$(window).off('resize.redactor-toolbar.' + this.uuid);\n\t\t\t\t},\n\t\t\t\tsetDropdownsFixed: function()\n\t\t\t\t{\n\t\t\t\t\tvar position = (this.opts.toolbarFixedTarget === document && this.detect.isDesktop()) ? 'fixed' : 'absolute';\n\t\t\t\t\tthis.toolbar.setDropdownPosition(position);\n\t\t\t\t},\n\t\t\t\tunsetDropdownsFixed: function()\n\t\t\t\t{\n\t\t\t\t\tthis.toolbar.setDropdownPosition('absolute');\n\t\t\t\t},\n\t\t\t\tsetDropdownPosition: function(position)\n\t\t\t\t{\n\t\t\t\t\tvar self = this;\n\t\t\t\t\t$('.redactor-dropdown-' + this.uuid).each(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $el = $(this);\n\t\t\t\t\t\tvar $button = self.button.get($el.attr('rel'));\n\t\t\t\t\t\tvar top = (position === 'fixed') ? self.opts.toolbarFixedTopOffset : $button.offset().top;\n\n\t\t\t\t\t\t$el.css({ position: position, top: ($button.innerHeight() + top) + 'px' });\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =upload\n\t\tupload: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tinit: function(id, url, callback)\n\t\t\t\t{\n\t\t\t\t\tthis.upload.direct = false;\n\t\t\t\t\tthis.upload.callback = callback;\n\t\t\t\t\tthis.upload.url = url;\n\t\t\t\t\tthis.upload.$el = $(id);\n\t\t\t\t\tthis.upload.$droparea = $('<div id=\"redactor-droparea\" />');\n\n\t\t\t\t\tthis.upload.$placeholdler = $('<div id=\"redactor-droparea-placeholder\" />').text(this.lang.get('upload-label'));\n\t\t\t\t\tthis.upload.$input = $('<input type=\"file\" name=\"file\" multiple />');\n\n\t\t\t\t\tthis.upload.$placeholdler.append(this.upload.$input);\n\t\t\t\t\tthis.upload.$droparea.append(this.upload.$placeholdler);\n\t\t\t\t\tthis.upload.$el.append(this.upload.$droparea);\n\n\t\t\t\t\tthis.upload.$droparea.off('redactor.upload');\n\t\t\t\t\tthis.upload.$input.off('redactor.upload');\n\n\t\t\t\t\tthis.upload.$droparea.on('dragover.redactor.upload', $.proxy(this.upload.onDrag, this));\n\t\t\t\t\tthis.upload.$droparea.on('dragleave.redactor.upload', $.proxy(this.upload.onDragLeave, this));\n\n\t\t\t\t\t// change\n\t\t\t\t\tthis.upload.$input.on('change.redactor.upload', $.proxy(function(e)\n\t\t\t\t\t{\n                        e = e.originalEvent || e;\n                        var len = this.upload.$input[0].files.length;\n\n                        for (var i = 0; i < len; i++)\n                        {\n                            var index = (len - 1) - i;\n                            this.upload.traverseFile(this.upload.$input[0].files[index], e);\n                        }\n\t\t\t\t\t}, this));\n\n\t\t\t\t\t// drop\n\t\t\t\t\tthis.upload.$droparea.on('drop.redactor.upload', $.proxy(function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\tthis.upload.$droparea.removeClass('drag-hover').addClass('drag-drop');\n\t\t\t\t\t\tthis.upload.onDrop(e);\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\tdirectUpload: function(file, e)\n\t\t\t\t{\n\t\t\t\t\tthis.upload.direct = true;\n\t\t\t\t\tthis.upload.traverseFile(file, e);\n\t\t\t\t},\n\t\t\t\tonDrop: function(e)\n\t\t\t\t{\n\t\t\t\t\te = e.originalEvent || e;\n\t\t\t\t\tvar files = e.dataTransfer.files;\n\n\t\t\t\t\tif (this.opts.multipleImageUpload)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar len = files.length;\n\t\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.upload.traverseFile(files[i], e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.upload.traverseFile(files[0], e);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\ttraverseFile: function(file, e)\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.s3)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.upload.setConfig(file);\n\t\t\t\t\t\tthis.uploads3.send(file, e);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar formData = !!window.FormData ? new FormData() : null;\n\t\t\t\t\tif (window.FormData)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.upload.setConfig(file);\n\n\t\t\t\t\t\tvar name = (this.upload.type === 'image') ? this.opts.imageUploadParam : this.opts.fileUploadParam;\n\t\t\t\t\t\tformData.append(name, file);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.progress.show();\n\t\t\t\t\tvar stop = this.core.callback('uploadStart', e, formData);\n\t\t\t\t\tif (stop !== false)\n\t\t\t\t\t{\n\t\t\t\t    \tthis.upload.send(formData, e);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsetConfig: function(file)\n\t\t\t\t{\n\t\t\t\t\tthis.upload.getType(file);\n\n\t\t\t\t\tif (this.upload.direct)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.upload.url = (this.upload.type === 'image') ? this.opts.imageUpload : this.opts.fileUpload;\n\t\t\t\t\t\tthis.upload.callback = (this.upload.type === 'image') ? this.image.insert : this.file.insert;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tgetType: function(file)\n\t\t\t\t{\n\t\t\t\t\tthis.upload.type = (this.opts.imageTypes.indexOf(file.type) === -1) ? 'file' : 'image';\n\n\t\t\t\t\tif (this.opts.imageUpload === null && this.opts.fileUpload !== null)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.upload.type = 'file';\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tgetHiddenFields: function(obj, fd)\n\t\t\t\t{\n\t\t\t\t\tif (obj === false || typeof obj !== 'object')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn fd;\n\t\t\t\t\t}\n\n\t\t\t\t\t$.each(obj, $.proxy(function(k, v)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (v !== null && v.toString().indexOf('#') === 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tv = $(v).val();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfd.append(k, v);\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\treturn fd;\n\n\t\t\t\t},\n\t\t\t\tsend: function(formData, e)\n\t\t\t\t{\n\t\t\t\t\t// append hidden fields\n\t\t\t\t\tif (this.upload.type === 'image')\n\t\t\t\t\t{\n\t\t\t\t\t\tformData = this.utils.appendFields(this.opts.imageUploadFields, formData);\n\t\t\t\t\t\tformData = this.utils.appendForms(this.opts.imageUploadForms, formData);\n\t\t\t\t\t\tformData = this.upload.getHiddenFields(this.upload.imageFields, formData);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tformData = this.utils.appendFields(this.opts.fileUploadFields, formData);\n\t\t\t\t\t\tformData = this.utils.appendForms(this.opts.fileUploadForms, formData);\n\t\t\t\t\t\tformData = this.upload.getHiddenFields(this.upload.fileFields, formData);\n\t\t\t\t\t}\n\n\t\t\t\t\tvar xhr = new XMLHttpRequest();\n\t\t\t\t\txhr.open('POST', this.upload.url);\n\t\t\t\t\txhr.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\n\n\t\t\t\t\t// complete\n\t\t\t\t\txhr.onreadystatechange = $.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t    if (xhr.readyState === 4)\n\t\t\t\t\t    {\n\t\t\t\t\t        var data = xhr.responseText;\n\n\t\t\t\t\t\t\tdata = data.replace(/^\\[/, '');\n\t\t\t\t\t\t\tdata = data.replace(/\\]$/, '');\n\n\t\t\t\t\t\t\tvar json;\n\t\t\t\t\t\t\ttry\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tjson = (typeof data === 'string' ? JSON.parse(data) : data);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcatch(err)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tjson = { error: true };\n\t\t\t\t\t\t\t}\n\n\n\t\t\t\t\t\t\tthis.progress.hide();\n\n\t\t\t\t\t\t\tif (!this.upload.direct)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.upload.$droparea.removeClass('drag-drop');\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.upload.callback(json, this.upload.direct, e);\n\t\t\t\t\t    }\n\t\t\t\t\t}, this);\n\n                    // before send\n                    var stop = this.core.callback('uploadBeforeSend', xhr);\n                    if (stop !== false)\n                    {\n\t\t\t\t\t    xhr.send(formData);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonDrag: function(e)\n\t\t\t\t{\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tthis.upload.$droparea.addClass('drag-hover');\n\t\t\t\t},\n\t\t\t\tonDragLeave: function(e)\n\t\t\t\t{\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tthis.upload.$droparea.removeClass('drag-hover');\n\t\t\t\t},\n\t\t\t\tclearImageFields: function()\n\t\t\t\t{\n\t\t\t\t\tthis.upload.imageFields = {};\n\t\t\t\t},\n\t\t\t\taddImageFields: function(name, value)\n\t\t\t\t{\n\t\t\t\t\tthis.upload.imageFields[name] = value;\n\t\t\t\t},\n\t\t\t\tremoveImageFields: function(name)\n\t\t\t\t{\n\t\t\t\t\tdelete this.upload.imageFields[name];\n\t\t\t\t},\n\t\t\t\tclearFileFields: function()\n\t\t\t\t{\n\t\t\t\t\tthis.upload.fileFields = {};\n\t\t\t\t},\n\t\t\t\taddFileFields: function(name, value)\n\t\t\t\t{\n\t\t\t\t\tthis.upload.fileFields[name] = value;\n\t\t\t\t},\n\t\t\t\tremoveFileFields: function(name)\n\t\t\t\t{\n\t\t\t\t\tdelete this.upload.fileFields[name];\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =s3\n\t\tuploads3: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tsend: function(file, e)\n\t\t\t\t{\n\t\t\t\t\tthis.uploads3.executeOnSignedUrl(file, $.proxy(function(signedURL)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.uploads3.sendToS3(file, signedURL, e);\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\texecuteOnSignedUrl: function(file, callback)\n\t\t\t\t{\n\t\t\t\t\tvar xhr = new XMLHttpRequest();\n\t\t\t\t\tvar mark = (this.opts.s3.search(/\\?/) === -1) ? '?' : '&';\n\n\t\t\t\t\txhr.open('GET', this.opts.s3 + mark + 'name=' + file.name + '&type=' + file.type, true);\n\n\t\t\t\t\t// hack to pass bytes through unprocessed.\n\t\t\t\t\tif (xhr.overrideMimeType)\n\t\t\t\t\t{\n\t\t\t\t\t\txhr.overrideMimeType('text/plain; charset=x-user-defined');\n\t\t\t\t\t}\n\n\t\t\t\t\tvar that = this;\n\t\t\t\t\txhr.onreadystatechange = function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.readyState === 4 && this.status === 200)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthat.progress.show();\n\t\t\t\t\t\t\tcallback(decodeURIComponent(this.responseText));\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\txhr.send();\n\t\t\t\t},\n\t\t\t\tcreateCORSRequest: function(method, url)\n\t\t\t\t{\n\t\t\t\t\tvar xhr = new XMLHttpRequest();\n\t\t\t\t\tif (\"withCredentials\" in xhr)\n\t\t\t\t\t{\n\t\t\t\t\t\txhr.open(method, url, true);\n\t\t\t\t\t}\n\t\t\t\t\telse if (typeof XDomainRequest !== \"undefined\")\n\t\t\t\t\t{\n\t\t\t\t\t\txhr = new XDomainRequest();\n\t\t\t\t\t\txhr.open(method, url);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\txhr = null;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn xhr;\n\t\t\t\t},\n\n                sendToS3: function(file, url, e)\n                {\n                    var xhr = this.uploads3.createCORSRequest('PUT', url);\n                    if (!xhr)\n                    {\n                        return;\n                    }\n\n                    xhr.onload = $.proxy(function()\n                    {\n                        var json;\n                        this.progress.hide();\n\n                        if (xhr.status !== 200)\n                        {\n                            // error\n                            json = { error: true };\n                            this.upload.callback(json, this.upload.direct, xhr);\n\n                            return;\n                        }\n\n                        var s3file = url.split('?');\n                        if (!s3file[0])\n                        {\n                            // url parsing is fail\n                            return false;\n                        }\n\n\n                        if (!this.upload.direct)\n                        {\n                            this.upload.$droparea.removeClass('drag-drop');\n                        }\n\n                        json = { url: s3file[0], id: s3file[0], s3: true };\n                        if (this.upload.type === 'file')\n                        {\n                            var arr = s3file[0].split('/');\n                            json.name = arr[arr.length-1];\n                        }\n\n                        this.upload.callback(json, this.upload.direct, e);\n\n\n                    }, this);\n\n                    xhr.onerror = function() {};\n                    xhr.upload.onprogress = function(e) {};\n\n                    xhr.setRequestHeader('Content-Type', file.type);\n                    xhr.setRequestHeader('x-amz-acl', 'public-read');\n\n                    xhr.send(file);\n\n                }\n\t\t\t};\n\t\t},\n\n\t\t// =utils\n\t\tutils: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tisEmpty: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = (typeof html === 'undefined') ? this.core.editor().html() : html;\n\n\t\t\t\t\thtml = html.replace(/[\\u200B-\\u200D\\uFEFF]/g, '');\n\t\t\t\t\thtml = html.replace(/&nbsp;/gi, '');\n\t\t\t\t\thtml = html.replace(/<\\/?br\\s?\\/?>/g, '');\n\t\t\t\t\thtml = html.replace(/\\s/g, '');\n\t\t\t\t\thtml = html.replace(/^<p>[^\\W\\w\\D\\d]*?<\\/p>$/i, '');\n\t\t\t\t\thtml = html.replace(/<iframe(.*?[^>])>$/i, 'iframe');\n\t\t\t\t\thtml = html.replace(/<source(.*?[^>])>$/i, 'source');\n\n\t\t\t\t\t// remove empty tags\n\t\t\t\t\thtml = html.replace(/<[^\\/>][^>]*><\\/[^>]+>/gi, '');\n\t\t\t\t\thtml = html.replace(/<[^\\/>][^>]*><\\/[^>]+>/gi, '');\n\n\t\t\t\t\thtml = $.trim(html);\n\n\t\t\t\t\treturn html === '';\n\t\t\t\t},\n\t\t\t\tisElement: function(obj)\n\t\t\t\t{\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// Using W3 DOM2 (works for FF, Opera and Chrome)\n\t\t\t\t\t\treturn obj instanceof HTMLElement;\n\t\t\t\t\t}\n\t\t\t\t\tcatch(e)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn (typeof obj === \"object\") && (obj.nodeType === 1) && (typeof obj.style === \"object\") && (typeof obj.ownerDocument === \"object\");\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tstrpos: function(haystack, needle, offset)\n\t\t\t\t{\n\t\t\t\t\tvar i = haystack.indexOf(needle, offset);\n\t\t\t\t\treturn i >= 0 ? i : false;\n\t\t\t\t},\n\t\t\t\tdataURItoBlob: function(dataURI)\n\t\t\t\t{\n\t\t\t\t\tvar byteString;\n\t\t\t\t\tif (dataURI.split(',')[0].indexOf('base64') >= 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tbyteString = atob(dataURI.split(',')[1]);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tbyteString = unescape(dataURI.split(',')[1]);\n\t\t\t\t\t}\n\n\t\t\t\t\tvar mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];\n\n\t\t\t\t\tvar ia = new Uint8Array(byteString.length);\n\t\t\t\t\tfor (var i = 0; i < byteString.length; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tia[i] = byteString.charCodeAt(i);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn new Blob([ia], { type:mimeString });\n\t\t\t\t},\n\t\t\t\tgetOuterHtml: function(el)\n\t\t\t\t{\n\t\t\t\t\treturn $('<div>').append($(el).eq(0).clone()).html();\n\t\t\t\t},\n\t\t\t\tcloneAttributes: function(from, to)\n\t\t\t\t{\n\t\t\t\t\tfrom = from[0] || from;\n\t\t\t\t\tto = $(to);\n\n\t\t\t\t\tvar attrs = from.attributes;\n\t\t\t\t\tvar len = attrs.length;\n\t\t\t\t\twhile (len--)\n\t\t\t\t\t{\n\t\t\t\t\t    var attr = attrs[len];\n\t\t\t\t\t    to.attr(attr.name, attr.value);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn to;\n\t\t\t\t},\n\t\t\t\tbreakBlockTag: function()\n\t\t\t\t{\n\t\t\t\t\tvar block = this.selection.block();\n\t\t\t\t\tif (!block)\n\t\t\t\t\t{\n    \t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar isEmpty = this.utils.isEmpty(block.innerHTML);\n\n\t\t\t\t\tvar tag = block.tagName.toLowerCase();\n\t\t\t\t\tif (tag === 'pre' || tag === 'li' || tag === 'td' || tag === 'th')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\n\t\t\t\t\tif (!isEmpty && this.utils.isStartOfElement(block))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn { $block: $(block), $next: $(block).next(), type: 'start' };\n\t\t\t\t\t}\n\t\t\t\t\telse if (!isEmpty && this.utils.isEndOfElement(block))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn { $block: $(block), $next: $(block).next(), type: 'end' };\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tvar endOfNode = this.selection.extractEndOfNode(block);\n\t\t\t\t\t\tvar $nextPart = $('<' + tag + ' />').append(endOfNode);\n\n\t\t\t\t\t\t$nextPart = this.utils.cloneAttributes(block, $nextPart);\n\t\t\t\t\t\t$(block).after($nextPart);\n\n\t\t\t\t\t\treturn { $block: $(block), $next: $nextPart, type: 'break' };\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t// tag detection\n\t\t\t\tinBlocks: function(tags)\n\t\t\t\t{\n\t\t\t\t\ttags = ($.isArray(tags)) ? tags : [tags];\n\n\t\t\t\t\tvar blocks = this.selection.blocks();\n\t\t\t\t\tvar len = blocks.length;\n\t\t\t\t\tvar contains = false;\n\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (blocks[i] !== false)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar tag = blocks[i].tagName.toLowerCase();\n\n\t\t\t\t\t\t\tif ($.inArray(tag, tags) !== -1)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tcontains = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn contains;\n\n\t\t\t\t},\n\t\t\t\tinInlines: function(tags)\n\t\t\t\t{\n\t\t\t\t\ttags = ($.isArray(tags)) ? tags : [tags];\n\n\t\t\t\t\tvar inlines = this.selection.inlines();\n\t\t\t\t\tvar len = inlines.length;\n\t\t\t\t\tvar contains = false;\n\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar tag = inlines[i].tagName.toLowerCase();\n\n\t\t\t\t\t\tif ($.inArray(tag, tags) !== -1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcontains = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn contains;\n\n\t\t\t\t},\n\t\t\t\tisTag: function(current, tag)\n\t\t\t\t{\n\t\t\t\t\tvar element = $(current).closest(tag, this.core.editor()[0]);\n\t\t\t\t\tif (element.length === 1)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn element[0];\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\tisBlock: function(block)\n\t\t\t\t{\n\t\t\t\t\tif (block === null)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tblock = block[0] || block;\n\n\t\t\t\t\treturn block && this.utils.isBlockTag(block.tagName);\n\t\t\t\t},\n\t\t\t\tisBlockTag: function(tag)\n\t\t\t\t{\n\t\t\t\t\treturn (typeof tag === 'undefined') ? false : this.reIsBlock.test(tag);\n\t\t\t\t},\n\t\t\t\tisInline: function(inline)\n\t\t\t\t{\n\t\t\t\t\tinline = inline[0] || inline;\n\n\t\t\t\t\treturn inline && this.utils.isInlineTag(inline.tagName);\n\t\t\t\t},\n\t\t\t\tisInlineTag: function(tag)\n\t\t\t\t{\n\t\t\t\t\treturn (typeof tag === 'undefined') ? false : this.reIsInline.test(tag);\n\t\t\t\t},\n\t\t\t\t// parents detection\n\t\t\t\tisRedactorParent: function(el)\n\t\t\t\t{\n\t\t\t\t\tif (!el)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($(el).parents('.redactor-in').length === 0 || $(el).hasClass('redactor-in'))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn el;\n\t\t\t\t},\n\t\t\t\tisCurrentOrParentHeader: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.utils.isCurrentOrParent(['H1', 'H2', 'H3', 'H4', 'H5', 'H6']);\n\t\t\t\t},\n\t\t\t\tisCurrentOrParent: function(tagName)\n\t\t\t\t{\n\t\t\t\t\tvar parent = this.selection.parent();\n\t\t\t\t\tvar current = this.selection.current();\n\n\t\t\t\t\tif ($.isArray(tagName))\n\t\t\t\t\t{\n\t\t\t\t\t\tvar matched = 0;\n\t\t\t\t\t\t$.each(tagName, $.proxy(function(i, s)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (this.utils.isCurrentOrParentOne(current, parent, s))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tmatched++;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, this));\n\n\t\t\t\t\t\treturn (matched === 0) ? false : true;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.utils.isCurrentOrParentOne(current, parent, tagName);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tisCurrentOrParentOne: function(current, parent, tagName)\n\t\t\t\t{\n\t\t\t\t\ttagName = tagName.toUpperCase();\n\n\t\t\t\t\treturn parent && parent.tagName === tagName ? parent : current && current.tagName === tagName ? current : false;\n\t\t\t\t},\n\t\t\t\tisEditorRelative: function()\n\t\t\t\t{\n\t\t\t\t\tvar position = this.core.editor().css('position');\n\t\t\t\t\tvar arr = ['absolute', 'fixed', 'relative'];\n\n\t\t\t\t\treturn ($.inArray(arr, position) !== -1);\n\t\t\t\t},\n\t\t\t\tsetEditorRelative: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().addClass('redactor-relative');\n\t\t\t\t},\n\t\t\t\t// scroll\n\t\t\t\tgetScrollTarget: function()\n\t\t\t\t{\n    \t\t\t\tvar $scrollTarget = $(this.opts.scrollTarget);\n\n    \t\t\t\treturn ($scrollTarget.length !== 0) ? $scrollTarget : $(document);\n\t\t\t\t},\n\t\t\t\tfreezeScroll: function()\n\t\t\t\t{\n\t\t\t\t\tthis.freezeScrollTop = this.utils.getScrollTarget().scrollTop();\n\t\t\t\t\tthis.utils.getScrollTarget().scrollTop(this.freezeScrollTop);\n\t\t\t\t},\n\t\t\t\tunfreezeScroll: function()\n\t\t\t\t{\n\t\t\t\t\tif (typeof this.freezeScrollTop === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.utils.getScrollTarget().scrollTop(this.freezeScrollTop);\n\t\t\t\t},\n\t\t\t\tsaveScroll: function()\n\t\t\t\t{\n\t\t\t\t\tthis.tmpScrollTop = this.utils.getScrollTarget().scrollTop();\n\t\t\t\t},\n\t\t\t\trestoreScroll: function()\n\t\t\t\t{\n\t\t\t\t\tif (typeof this.tmpScrollTop === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.utils.getScrollTarget().scrollTop(this.tmpScrollTop);\n\t\t\t\t},\n\t\t\t\tisStartOfElement: function(element)\n\t\t\t\t{\n\t\t\t\t\tif (typeof element === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\telement = this.selection.block();\n\t\t\t\t\t\tif (!element)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn (this.offset.get(element) === 0) ? true : false;\n\t\t\t\t},\n\t\t\t\tisEndOfElement: function(element)\n\t\t\t\t{\n\t\t\t\t\tif (typeof element === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\telement = this.selection.block();\n\t\t\t\t\t\tif (!element)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tvar text = $.trim($(element).text()).replace(/[\\t\\n\\r\\n]/g, '').replace(/\\u200B/g, '');\n\t\t\t\t\tvar offset = this.offset.get(element);\n\n\t\t\t\t\treturn (offset === text.length) ? true : false;\n\t\t\t\t},\n\t\t\t\tremoveEmptyAttr: function(el, attr)\n\t\t\t\t{\n\t\t\t\t\tvar $el = $(el);\n\t\t\t\t\tif (typeof $el.attr(attr) === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($el.attr(attr) === '')\n\t\t\t\t\t{\n\t\t\t\t\t\t$el.removeAttr(attr);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\treplaceToTag: function(node, tag)\n\t\t\t\t{\n\t\t\t\t\tvar replacement;\n\t\t\t\t\t$(node).replaceWith(function()\n\t\t\t\t\t{\n\t\t\t\t\t\treplacement = $('<' + tag + ' />').append($(this).contents());\n\n\t\t\t\t\t\tfor (var i = 0; i < this.attributes.length; i++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treplacement.attr(this.attributes[i].name, this.attributes[i].value);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn replacement;\n\t\t\t\t\t});\n\n\t\t\t\t\treturn replacement;\n\t\t\t\t},\n\t\t\t\t// select all\n\t\t\t\tisSelectAll: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.selectAll;\n\t\t\t\t},\n\t\t\t\tenableSelectAll: function()\n\t\t\t\t{\n\t\t\t\t\tthis.selectAll = true;\n\t\t\t\t},\n\t\t\t\tdisableSelectAll: function()\n\t\t\t\t{\n\t\t\t\t\tthis.selectAll = false;\n\t\t\t\t},\n\t\t\t\tdisableBodyScroll: function()\n\t\t\t\t{\n\t\t\t\t\tvar $body = $('html');\n\t\t\t\t\tvar windowWidth = window.innerWidth;\n\t\t\t\t\tif (!windowWidth)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar documentElementRect = document.documentElement.getBoundingClientRect();\n\t\t\t\t\t\twindowWidth = documentElementRect.right - Math.abs(documentElementRect.left);\n\t\t\t\t\t}\n\n\t\t\t\t\tvar isOverflowing = document.body.clientWidth < windowWidth;\n\t\t\t\t\tvar scrollbarWidth = this.utils.measureScrollbar();\n\n\t\t\t\t\t$body.css('overflow', 'hidden');\n\t\t\t\t\tif (isOverflowing)\n\t\t\t\t\t{\n\t\t\t\t\t\t$body.css('padding-right', scrollbarWidth);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tmeasureScrollbar: function()\n\t\t\t\t{\n\t\t\t\t\tvar $body = $('body');\n\t\t\t\t\tvar scrollDiv = document.createElement('div');\n\t\t\t\t\tscrollDiv.className = 'redactor-scrollbar-measure';\n\n\t\t\t\t\t$body.append(scrollDiv);\n\t\t\t\t\tvar scrollbarWidth = scrollDiv.offsetWidth - scrollDiv.clientWidth;\n\t\t\t\t\t$body[0].removeChild(scrollDiv);\n\t\t\t\t\treturn scrollbarWidth;\n\t\t\t\t},\n\t\t\t\tenableBodyScroll: function()\n\t\t\t\t{\n\t\t\t\t\t$('html').css({ 'overflow': '', 'padding-right': '' });\n\t\t\t\t\t$('body').remove('redactor-scrollbar-measure');\n\t\t\t\t},\n\t\t\t\tappendFields: function(appendFields, data)\n\t\t\t\t{\n\t\t\t\t\tif (!appendFields)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn data;\n\t\t\t\t\t}\n\t\t\t\t\telse if (typeof appendFields === 'object')\n\t\t\t\t\t{\n    \t\t\t\t\t$.each(appendFields, function(k, v)\n    \t\t\t\t\t{\n    \t\t\t\t\t\tif (v !== null && v.toString().indexOf('#') === 0)\n    \t\t\t\t\t\t{\n        \t\t\t\t\t\tv = $(v).val();\n                            }\n\n    \t\t\t\t\t\tdata.append(k, v);\n\n    \t\t\t\t\t});\n\n    \t\t\t\t\treturn data;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $fields = $(appendFields);\n\t\t\t\t\tif ($fields.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn data;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tvar str = '';\n\t\t\t\t\t\t$fields.each(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdata.append($(this).attr('name'), $(this).val());\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn data;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tappendForms: function(appendForms, data)\n\t\t\t\t{\n\t\t\t\t\tif (!appendForms)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn data;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $forms = $(appendForms);\n\t\t\t\t\tif ($forms.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn data;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tvar formData = $forms.serializeArray();\n\n\t\t\t\t\t\t$.each(formData, function(z,f)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdata.append(f.name, f.value);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn data;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tisRgb: function(str)\n\t\t\t\t{\n                    return (str.search(/^rgb/i) === 0);\n\t\t\t\t},\n\t\t\t\trgb2hex: function(rgb)\n\t\t\t\t{\n                    rgb = rgb.match(/^rgba?[\\s+]?\\([\\s+]?(\\d+)[\\s+]?,[\\s+]?(\\d+)[\\s+]?,[\\s+]?(\\d+)[\\s+]?/i);\n\n                    return (rgb && rgb.length === 4) ? \"#\" +\n                    (\"0\" + parseInt(rgb[1],10).toString(16)).slice(-2) +\n                    (\"0\" + parseInt(rgb[2],10).toString(16)).slice(-2) +\n                    (\"0\" + parseInt(rgb[3],10).toString(16)).slice(-2) : '';\n                },\n\n\t\t\t\t// #backward\n\t\t\t\tisCollapsed: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.selection.isCollapsed();\n\t\t\t\t},\n\t\t\t\tisMobile: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.detect.isMobile();\n\t\t\t\t},\n\t\t\t\tisDesktop: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.detect.isDesktop();\n\t\t\t\t},\n\t\t\t\tisPad: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.detect.isIpad();\n\t\t\t\t}\n\n\t\t\t};\n\t\t},\n\n\t\t// #backward\n\t\tbrowser: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\twebkit: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.detect.isWebkit();\n\t\t\t\t},\n\t\t\t\tff: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.detect.isFirefox();\n\t\t\t\t},\n\t\t\t\tie: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.detect.isIe();\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t};\n\n\t$(window).on('load.tools.redactor', function()\n\t{\n\t\t$('[data-tools=\"redactor\"]').redactor();\n\t});\n\n\t// constructor\n\tRedactor.prototype.init.prototype = Redactor.prototype;\n\n})(jQuery);\n\n(function($)\n{\n\t$.fn.redactorAnimation = function(animation, options, callback)\n\t{\n\t\treturn this.each(function()\n\t\t{\n\t\t\tnew redactorAnimation(this, animation, options, callback);\n\t\t});\n\t};\n\n\tfunction redactorAnimation(element, animation, options, callback)\n\t{\n\t\t// default\n\t\tvar opts = {\n\t\t\tduration: 0.5,\n\t\t\titerate: 1,\n\t\t\tdelay: 0,\n\t\t\tprefix: 'redactor-',\n\t\t\ttiming: 'linear'\n\t\t};\n\n\t\tthis.animation = animation;\n\t\tthis.slide = (this.animation === 'slideDown' || this.animation === 'slideUp');\n\t\tthis.$element = $(element);\n\t\tthis.prefixes = ['', '-moz-', '-o-animation-', '-webkit-'];\n\t\tthis.queue = [];\n\n\t\t// options or callback\n\t\tif (typeof options === 'function')\n\t\t{\n\t\t\tcallback = options;\n\t\t\tthis.opts = opts;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.opts = $.extend(opts, options);\n\t\t}\n\n\t\t// slide\n\t\tif (this.slide)\n\t\t{\n\t\t\tthis.$element.height(this.$element.height());\n\t\t}\n\n\t\t// init\n\t\tthis.init(callback);\n\n\t}\n\n\tredactorAnimation.prototype = {\n\n\t\tinit: function(callback)\n\t\t{\n\t\t\tthis.queue.push(this.animation);\n\n\t\t\tthis.clean();\n\n\t\t\tif (this.animation === 'show')\n\t\t\t{\n\t\t\t\tthis.opts.timing = 'linear';\n\t\t\t\tthis.$element.removeClass('hide').show();\n\n\t\t\t\tif (typeof callback === 'function')\n\t\t\t\t{\n\t\t\t\t\tcallback(this);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (this.animation === 'hide')\n\t\t\t{\n\t\t\t\tthis.opts.timing = 'linear';\n\t\t\t\tthis.$element.hide();\n\n\t\t\t\tif (typeof callback === 'function')\n\t\t\t\t{\n\t\t\t\t\tcallback(this);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.animate(callback);\n\t\t\t}\n\n\t\t},\n\t\tanimate: function(callback)\n\t\t{\n\t\t\tthis.$element.addClass('redactor-animated').css('display', '').removeClass('hide');\n\t\t\tthis.$element.addClass(this.opts.prefix + this.queue[0]);\n\n\t\t\tthis.set(this.opts.duration + 's', this.opts.delay + 's', this.opts.iterate, this.opts.timing);\n\n\t\t\tvar _callback = (this.queue.length > 1) ? null : callback;\n\t\t\tthis.complete('AnimationEnd', $.proxy(function()\n\t\t\t{\n\t\t\t\tif (this.$element.hasClass(this.opts.prefix + this.queue[0]))\n\t\t\t\t{\n\t\t\t\t\tthis.clean();\n\t\t\t\t\tthis.queue.shift();\n\n\t\t\t\t\tif (this.queue.length)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.animate(callback);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t}, this), _callback);\n\t\t},\n\t\tset: function(duration, delay, iterate, timing)\n\t\t{\n\t\t\tvar len = this.prefixes.length;\n\n\t\t\twhile (len--)\n\t\t\t{\n\t\t\t\tthis.$element.css(this.prefixes[len] + 'animation-duration', duration);\n\t\t\t\tthis.$element.css(this.prefixes[len] + 'animation-delay', delay);\n\t\t\t\tthis.$element.css(this.prefixes[len] + 'animation-iteration-count', iterate);\n\t\t\t\tthis.$element.css(this.prefixes[len] + 'animation-timing-function', timing);\n\t\t\t}\n\n\t\t},\n\t\tclean: function()\n\t\t{\n\t\t\tthis.$element.removeClass('redactor-animated');\n\t\t\tthis.$element.removeClass(this.opts.prefix + this.queue[0]);\n\n\t\t\tthis.set('', '', '', '');\n\n\t\t},\n\t\tcomplete: function(type, make, callback)\n\t\t{\n\t\t\tthis.$element.one(type.toLowerCase() + ' webkit' + type + ' o' + type + ' MS' + type, $.proxy(function()\n\t\t\t{\n\t\t\t\tif (typeof make === 'function')\n\t\t\t\t{\n\t\t\t\t\tmake();\n\t\t\t\t}\n\n\t\t\t\tif (typeof callback === 'function')\n\t\t\t\t{\n\t\t\t\t\tcallback(this);\n\t\t\t\t}\n\n\t\t\t\t// hide\n\t\t\t\tvar effects = ['fadeOut', 'slideUp', 'zoomOut', 'slideOutUp', 'slideOutRight', 'slideOutLeft'];\n\t\t\t\tif ($.inArray(this.animation, effects) !== -1)\n\t\t\t\t{\n\t\t\t\t\tthis.$element.css('display', 'none');\n\t\t\t\t}\n\n\t\t\t\t// slide\n\t\t\t\tif (this.slide)\n\t\t\t\t{\n\t\t\t\t\tthis.$element.css('height', '');\n\t\t\t\t}\n\n\t\t\t}, this));\n\n\t\t}\n\t};\n\n})(jQuery);\n"]}